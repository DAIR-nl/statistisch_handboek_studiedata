---
title: "Gepaarde t-toets"
author: "Irene van der Staaij & Megiel Kerkhoven"
date: "1 Oktober 2019"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    theme: united
---
<style>
  .col2 {
    columns: 2 200px;
    -webkit-columns: 2 200px;
    -moz-columns: 2 200px;
  }
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r aanmaken data, include=FALSE, echo=TRUE}
set.seed(2)
volgorde <- sample(1:246, 246)
volgorde_n30 <- sample(1:30, 30)

mu <- 3.6
sigma <- 0.6
Evaluatie_score_voor_tutorgesprek <- rnorm(250, mu, sigma)

Evaluatie_score_voor_tutorgesprek <- Evaluatie_score_voor_tutorgesprek[Evaluatie_score_voor_tutorgesprek <= 5 
                                                         & Evaluatie_score_voor_tutorgesprek >= 1]
Evaluatie_score_voor_tutorgesprek <- sapply (Evaluatie_score_voor_tutorgesprek, round, 3)
Evaluatie_score_voor_tutorgesprek <- sort(Evaluatie_score_voor_tutorgesprek)
Evaluatie_score_voor_tutorgesprek <- Evaluatie_score_voor_tutorgesprek[volgorde]

mu <- 3.4
sigma <- 0.9
Evaluatie_score_na_tutorgesprek <- rnorm(300, mu, sigma)

Evaluatie_score_na_tutorgesprek <- Evaluatie_score_na_tutorgesprek[Evaluatie_score_na_tutorgesprek <= 5 
                                                       & Evaluatie_score_na_tutorgesprek >= 1]
Evaluatie_score_na_tutorgesprek <- sapply (Evaluatie_score_na_tutorgesprek, round, 3)
Evaluatie_score_na_tutorgesprek <- sort(Evaluatie_score_na_tutorgesprek)
Evaluatie_score_na_tutorgesprek <- Evaluatie_score_na_tutorgesprek[sample(-283:-1, 41)]
Evaluatie_score_na_tutorgesprek <- Evaluatie_score_na_tutorgesprek[volgorde]

mu <- 3.6
sigma <- 0.6
Evaluatie_score_voor_tutorgesprek_n30 <- rnorm(30, mu, sigma)

Evaluatie_score_voor_tutorgesprek_n30 <- Evaluatie_score_voor_tutorgesprek_n30[Evaluatie_score_voor_tutorgesprek_n30 <= 5 
                                                                 & Evaluatie_score_voor_tutorgesprek_n30 >= 1]
Evaluatie_score_voor_tutorgesprek_n30 <- sapply (Evaluatie_score_voor_tutorgesprek_n30, round, 3)
Evaluatie_score_voor_tutorgesprek_n30 <- sort(Evaluatie_score_voor_tutorgesprek_n30)
Evaluatie_score_voor_tutorgesprek_n30 <- Evaluatie_score_voor_tutorgesprek_n30[volgorde_n30]

set.seed(1) ## binnen seed 1 geen significantie
mu <- 3.5
sigma <- 0.4
Evaluatie_score_na_tutorgesprek_n30 <- rnorm(30, mu, sigma)

Evaluatie_score_na_tutorgesprek_n30 <- Evaluatie_score_na_tutorgesprek_n30[Evaluatie_score_na_tutorgesprek_n30 <= 5 
                                                               & Evaluatie_score_na_tutorgesprek_n30 >= 1]
Evaluatie_score_na_tutorgesprek_n30 <- sapply (Evaluatie_score_na_tutorgesprek_n30, round, 3)
Evaluatie_score_na_tutorgesprek_n30 <- sort(Evaluatie_score_na_tutorgesprek_n30)
Evaluatie_score_na_tutorgesprek_n30 <- Evaluatie_score_na_tutorgesprek_n30[volgorde_n30]
```

```{r opmerking, include=FALSE, eval=FALSE}
# ipv Cohen's d kan ook eta squared gebruikt worden om effectmaat te berekenen. Wordt vaak wel gedaan bij de ANOVA. 
# doorlinken naar de Wilcoxon Signed Rank Test
# plek van Mean en SD
```


## Gebruik
Bij het toetsen of het gemiddelde van twee groepen aan elkaar gelijk zijn kan de *t-toets* toegepast worden. De *gepaarde t-toets* kan toegepast worden wanneer de groepen gepaard zijn, bijvoorbeeld bij een herhaalde meting. Wanneer personen uit twee verschillende groepen, die met elkaar veel overeenkomsten vertonen, gekoppeld worden, kan ook een *gepaarde t-toets* gebruikt worden [^1].

## Voorbeeld uit het onderwijs
Ter voorbereiding op een visitatie vraagt de opleidingsdirecteur van de lerarenopleiding zich af of haar studenten, nadat ze met hun tutor hebben gesproken, de opleiding een ander cijfer geven. Ze vraagt of de studenten twee keer een vragenlijst in willen vullen, één keer voordat ze met hun tutor hebben gesproken (T~0~) en nog een keer nadat ze met hun tutor hebben gesproken (T~1~). 

H~0~: Het gemiddelde cijfer wat de studenten geven voor de opleiding is niet veranderd na een gesprek met hun tutor, µ~T0~ = µ~T1~  
H~A~: Het gemiddelde cijfer wat de studenten geven voor de opleiding is veranderd na een gesprek met hun tutor, µ~T0~ ≠ µ~T1~ 

## Assumpties: Normaliteit
De *t-toets* gaat ervan uit dat de data normaal verdeeld is.  
1. Controleer visueel of de data normaal verdeel is door het maken van een dataplot: een histogram of een boxplot.  
2. Toets daarna of de data normaal verdeeld is met de *Kolmogorov-Smirnov test* of bij een kleinere steekproef met de *Shapiro-Wilk test* [^2].  

Wanneer uit bovenstaande tests blijkt dat de data niet normaal verdeeld is, kan de *t-toets* niet gebruikt worden. Gebruik in dat geval de *Wilcoxon Signed Rank Test* [^3].

## Effectmaat
Om te bepalen of de gevonden p-waarde betekenisvol is kan een effectmaat berekend worden, er zijn meerdere effect maten te berekenen. Hier worden twee effectmaten besproken die veel voorkomen, Cohen's *d* en eta squared.   

Cohen's *d* berekent de sterkte van het effect van een onafhankelijke variabele op een afhankelijke variabele. Een indicatie om *d* te interpreteren is: *d* ≤ 0,3 is een klein effect, rond 0,5 is een gemiddeld effect en rond 0,8 is een groot effect [^4].  

Eta squared η 

## Uitvoering in R
Voor de uitvoering in R is er data ingeladen met evaluatie-scores van studenten voor en nadat zij een tutorgesprek hebben gehad. 

### Test assumpties: Normaliteit
<div class="col2">
```{r Assumptietest, collapse=TRUE}
mean(Evaluatie_score_voor_tutorgesprek)
sd(Evaluatie_score_voor_tutorgesprek)
hist(Evaluatie_score_voor_tutorgesprek)
mean(Evaluatie_score_na_tutorgesprek)
sd(Evaluatie_score_na_tutorgesprek)
hist(Evaluatie_score_na_tutorgesprek)
```
</div>

Beide histogrammen laten een belvorm zien vergelijkbaar aan een normale verdeling, veel waardes liggen rondom het gemiddelde. Het histogram `Evaluatie_score_na_tutorgesprek` lijkt licht scheef verdeeld. Voer de *Kolmogorov-Smirnov test* of de *Shapiro-Wilk test* uit om te toetsen of de histogrammen normaal verdeeld zijn.   

### {.tabset .tabset-fade .tabset.pills}
#### Kolmogorov-Smirnov (met Lilliefors correctie)
```{r library nortest, warning=FALSE}
library(nortest)
```
<div class ="col2">
``` {r Lilliefors Test, warning=FALSE}
lillie.test(Evaluatie_score_voor_tutorgesprek)
lillie.test(Evaluatie_score_na_tutorgesprek)
```
</div>

De *Kolmogorov-Smirnov test* is een non-parametrische toets, die het verschil in vorm tussen de twee verdelingen toetst. Wanneer de p-waarde kleiner is dan 0,05 is er een verschil tussen beide verdelingen.  

In dit geval is van beide groepen de p-waarde > 0,05, dus is de verdeling van de data niet significant verschillend van de normale verdeling. Er wordt aan de assumptie van normaliteit voldaan, dus de *gepaarde t-toets* kan uitgevoerd worden. 

#### Shapiro-Wilk Test
<div class ="col2">
``` {r Shapiro-Wilk Test, warning=FALSE}
shapiro.test(Evaluatie_score_voor_tutorgesprek_n30)
shapiro.test(Evaluatie_score_na_tutorgesprek_n30)
```
</div>

De *Shapiro-Wilk test* wordt vooral gebruikt bij kleine steekproeven. Ook bij deze toets geldt dat wanneer de p-waarde > 0,05 is de verdeling van de data niet significant verschillend van de normale verdeling.  

In dit voorbeeld, met een kleine *n*, hebben beide groepen een p-waarde > 0,05, dus is de verdeling van beide groepen niet significant verschillend van de normale verdeling. Er wordt aan de assumptie van normaliteit voldaan, dus de *gepaarde t-toets* kan uitgevoerd worden.  

### Gepaarde t-toets
```{r statistische toets}
t.test(Evaluatie_score_na_tutorgesprek, Evaluatie_score_voor_tutorgesprek, paired=TRUE)
```
* *t* (247) = -2,7787, *p* < 0,01  
* Vrijheidsgraden: *df* = *n* -1 = 247  
* p-waarde < 0,05, dus de H~A~ wordt aangenomen  
* 95%-betrouwbaarheidsinterval: het interval loopt tussen -0,27 en de -0,04
* Het verschil tussen beide groepen is 0,25

### Cohen's d
```{r Cohen s d}
library(effsize)
cohen.d(Evaluatie_score_voor_tutorgesprek, Evaluatie_score_na_tutorgesprek)
```
*d* = 0,36. De sterkte van het effect van de tutor op het cijfer is klein tot gemiddeld. 

## Rapportage
Een *gepaarde t-toets* is uitgevoerd om te toetsen of het gemiddelde cijfer, wat studenten geven voor de opleiding, gelijk is gebleven na een gesprek met een tutor. Het verschil tussen het gemiddelde van T~0~ (3,65) en het gemiddelde van T~1~ (3,4) is significant *t* (247) = -2,7787, *p* < 0,01. Het 95% betrouwbaarheidsinterval voor het verschil tussen het gemiddelde van beide groepen heeft een reikwijdte van -0,27 tot -0,04. Het effect is klein tot gemiddeld, *d* = 0,36.    
De resultaten ondersteunen de conclusie dat de studenten na een gesprek met de tutor de opleiding anders beoordelen dan voordat ze een gesprek hebben gehad met de tutor. 

## Referenties
[^1]: Student's t-test [Wikipedia]. (2019 August 21). Retrieved from: https://en.wikipedia.org/wiki/Student%27s_t-test
[^2]: Normaliteit. (14 jul 2014). [UvA Wiki Methodologiewinkel]. Retrieved from: https://wiki.uva.nl/methodologiewinkel/index.php/Normaliteit  
[^3]: van Geloven, N. (2013, 25 September). Wilcoxon signed rank toets [Wiki Statistiek Academisch Medisch Centrum]. Retrieved from: https://wikistatistiek.amc.nl/index.php/Wilcoxon_signed_rank_toets
[^4]: E Marshall, E Boggis - Statstutor Community Project, 2016 - statstutor.ac.uk The Statistics Tutor’s  Quick Guide to Commonly Used Statistical Tests  - Ellen Marshall, University of Sheffield 


---
title: "Gepaarde t-toets"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    theme: united
---

<style>
  .col2 {
    columns: 2 200px;
    -webkit-columns: 2 200px;
    -moz-columns: 2 200px;
  }
</style>

``` {r versiegeschiedenis, include = FALSE, eval = FALSE}
## versie 0.1     3-9-19
## versie 0.2     4-9-19
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r aanmaken data, include=FALSE, echo=TRUE}
RNGkind(sample.kind = "Rounding")
set.seed(1)

## Maak ruwe data aan
mu <- 3.6
sigma <- 0.6
Evaluatie_score_voor_tutorgesprek <- rnorm(250, mu, sigma)

Evaluatie_score_voor_tutorgesprek <- Evaluatie_score_voor_tutorgesprek[Evaluatie_score_voor_tutorgesprek <= 5 
                                                                       & Evaluatie_score_voor_tutorgesprek >= 1]

mu <- 3.4
sigma <- 0.9
Evaluatie_score_na_tutorgesprek <- rnorm(260, mu, sigma)

Evaluatie_score_na_tutorgesprek <- Evaluatie_score_na_tutorgesprek[Evaluatie_score_na_tutorgesprek <= 5 
                                                                   & Evaluatie_score_na_tutorgesprek >= 1]
## Stel volgorde en lengte van steekproef vast
volgorde <- sample(1:length(Evaluatie_score_voor_tutorgesprek), length(Evaluatie_score_voor_tutorgesprek))
volgorde_n30 <- sample(1:30, 30)
Verschil_grootte <- length(Evaluatie_score_na_tutorgesprek) - length(Evaluatie_score_voor_tutorgesprek)

## Rond evaluatiecijfers af
Evaluatie_score_voor_tutorgesprek <- sapply(Evaluatie_score_voor_tutorgesprek, round, 3)
Evaluatie_score_na_tutorgesprek <- sapply(Evaluatie_score_na_tutorgesprek, round, 3)

## Definiëer lengte in steekproef en hussel paren
Evaluatie_score_voor_tutorgesprek <- sort(Evaluatie_score_voor_tutorgesprek)
Evaluatie_score_voor_tutorgesprek <- Evaluatie_score_voor_tutorgesprek[volgorde]
Evaluatie_score_na_tutorgesprek <- sort(Evaluatie_score_na_tutorgesprek)
Evaluatie_score_na_tutorgesprek <- Evaluatie_score_na_tutorgesprek[sample(-283:-1, Verschil_grootte)]
Evaluatie_score_na_tutorgesprek <- Evaluatie_score_na_tutorgesprek[volgorde]



mu <- 3.6
sigma <- 0.6
Evaluatie_score_voor_tutorgesprek_n30 <- rnorm(30, mu, sigma)

Evaluatie_score_voor_tutorgesprek_n30 <- Evaluatie_score_voor_tutorgesprek_n30[Evaluatie_score_voor_tutorgesprek_n30 <= 5 
                                                                 & Evaluatie_score_voor_tutorgesprek_n30 >= 1]
Evaluatie_score_voor_tutorgesprek_n30 <- sapply (Evaluatie_score_voor_tutorgesprek_n30, round, 3)
Evaluatie_score_voor_tutorgesprek_n30 <- sort(Evaluatie_score_voor_tutorgesprek_n30)
Evaluatie_score_voor_tutorgesprek_n30 <- Evaluatie_score_voor_tutorgesprek_n30[volgorde_n30]

mu <- 3.5
sigma <- 0.4
Evaluatie_score_na_tutorgesprek_n30 <- rnorm(30, mu, sigma)

Evaluatie_score_na_tutorgesprek_n30 <- Evaluatie_score_na_tutorgesprek_n30[Evaluatie_score_na_tutorgesprek_n30 <= 5 
                                                               & Evaluatie_score_na_tutorgesprek_n30 >= 1]
Evaluatie_score_na_tutorgesprek_n30 <- sapply (Evaluatie_score_na_tutorgesprek_n30, round, 3)
Evaluatie_score_na_tutorgesprek_n30 <- sort(Evaluatie_score_na_tutorgesprek_n30)
Evaluatie_score_na_tutorgesprek_n30 <- Evaluatie_score_na_tutorgesprek_n30[volgorde_n30]
```

```{r opmerking, include=FALSE, eval=FALSE}
# ipv Cohen's d kan ook eta squared gebruikt worden om effectmaat te berekenen. Wordt vaak wel gedaan bij de ANOVA. 
# doorlinken naar de Wilcoxon Signed Rank Test
# plek van Mean en SD
# https://wikistatistiek.amc.nl/index.php/Matchen machten AMC
```


## 1 Toepassing
Bij het toetsen of het gemiddelde van twee groepen aan elkaar gelijk zijn kan de *t-toets* toegepast worden. De *gepaarde t-toets* kan toegepast worden wanneer de groepen gepaard zijn, bijvoorbeeld bij een herhaalde meting. Wanneer personen uit twee verschillende groepen, die met elkaar veel overeenkomsten vertonen, gekoppeld worden, kan ook een *gepaarde t-toets* gebruikt worden [^1].

## 2 Onderwijscasus
Ter voorbereiding op een visitatie vraagt de opleidingsdirecteur van de lerarenopleiding zich af wat voor cijfer haar studenten de opleiding geven. Zij vraagt zich af of het tutorgesprek hier een rol in speelt. Ze vraagt of de studenten twee keer een vragenlijst in willen vullen. Eerst voordat ze met hun tutor hebben gesproken (T~0~) en daarna nadat ze met hun tutor hebben gesproken (T~1~). 

H~0~: Het gemiddelde cijfer wat de studenten geven aan de opleiding is niet veranderd na het gesprek met hun tutor, µ~T0~ = µ~T1~  
H~A~: Het gemiddelde cijfer wat de studenten geven aan de opleiding is veranderd na het gesprek met hun tutor, µ~T0~ ≠ µ~T1~ 

## 3 Assumpties: Normaliteit
De *t-toets* gaat ervan uit dat de data normaal verdeeld is.  
1. Controleer de data visueel met een histogram, een boxplot of een Q-Q plot.  
2. Toets of de data normaal verdeeld is met de *Kolmogorov-Smirnov test* of bij een kleinere steekproef (n < 50[^2]) met de *Shapiro-Wilk test* [^3].  

Wanneer uit één van de bovenstaande tests blijkt dat de data niet normaal verdeeld is, kan de *t-toets* niet gebruikt worden. Gebruik in dat geval de *Wilcoxon Signed Rank Test* [^4].

## Effectmaat
Bereken de effectmaat om te bepalen of de gevonden p-waarde betekenisvol is. Een veel voorkomende effectmaat is Cohen's *d*.    

Cohen's *d* geeft de sterkte van het effect van een onafhankelijke variabele op een afhankelijke variabele weer. Een indicatie om *d* te interpreteren is: rond 0,3 is het een klein effect, rond 0,5 is het een gemiddeld effect en rond 0,8 is het een groot effect [^5].  

## 4 Uitvoering in R
Voor de uitvoering in R is er data ingeladen met evaluatie-scores van studenten voor en nadat zij een tutorgesprek hebben gehad. 

### Test assumpties: Normaliteit
<div class="col2">
```{r Assumptietest, collapse=TRUE}
mean(Evaluatie_score_voor_tutorgesprek)
sd(Evaluatie_score_voor_tutorgesprek)
```

Gemiddelde voor tutorgesprek (sd): 3,60 (0,56)

```{r histogram na tutorgesprek}
hist(Evaluatie_score_na_tutorgesprek)
```
```{r beschrijvende gegevens na tutor, collapse = TRUE}
mean(Evaluatie_score_na_tutorgesprek)
sd(Evaluatie_score_na_tutorgesprek)
```

Gemiddelde na tutorgesprek (sd): 3,34 (0,85)

```{r histogram voor tutorgesprek}
hist(Evaluatie_score_voor_tutorgesprek)
```

</div>


Beide histogrammen laten een belcurve zien vergelijkbaar aan een normale verdeling, veel waardes liggen rondom het gemiddelde. Het histogram `Evaluatie_score_na_tutorgesprek` lijkt licht scheef verdeeld. Voer de *Kolmogorov-Smirnov test* of de *Shapiro-Wilk test* uit om te toetsen of de data normaal verdeeld is.   

### {.toc-ignore .tabset .tabset-fade .tabset.pills}
#### Kolmogorov-Smirnov (met Lilliefors correctie)
```{r library nortest, warning=FALSE}
library(nortest)
```
<div class ="col2">
``` {r Lilliefors Test, warning=FALSE}
lillie.test(Evaluatie_score_voor_tutorgesprek)
lillie.test(Evaluatie_score_na_tutorgesprek)
```
</div>

De *Kolmogorov-Smirnov test* toetst het verschil in vorm tussen de twee verdelingen. In dit geval toetst deze test het verschil tussen een normale verdeling en de verdeling van de steekproef. De Lilliefors correctie is een correctie die wordt gebruikt als het gemiddelde niet 0 is en de standaardafwijking niet 1 is. Als de p-waarde groter is dan 0,05 is de verdeling van de data niet significant verschillend van een normale verdeling.  

In dit geval is van beide groepen de p-waarde > 0,05; er is geen significant verschil gevonden tussen de verdeling van de steekproef en de normale verdeling. Er wordt aan de assumptie van normaliteit voldaan, dus de *gepaarde t-toets* kan uitgevoerd worden. 

#### Shapiro-Wilk Test
<div class ="col2">
``` {r Shapiro-Wilk Test, warning=FALSE}
shapiro.test(Evaluatie_score_voor_tutorgesprek_n30)
shapiro.test(Evaluatie_score_na_tutorgesprek_n30)
```
</div>

De *Shapiro-Wilk test* wordt vooral gebruikt bij kleine steekproeven. Ook bij deze toets geldt dat wanneer de p-waarde > 0,05 is de verdeling van de data niet significant verschillend van de normale verdeling.  

In dit voorbeeld, met een kleine *n*, hebben beide groepen een p-waarde > 0,05. De verdeling van beide groepen is niet significant verschillend van de normale verdeling. Er wordt aan de assumptie van normaliteit voldaan. De *gepaarde t-toets* kan uitgevoerd worden.  

### Gepaarde t-toets
Gebruik `t.test()` met `paired = TRUE`. 
```{r statistische toets}
t.test(Evaluatie_score_voor_tutorgesprek, Evaluatie_score_na_tutorgesprek, paired = TRUE)
```
* *t* (247) = 13,575 *p* < 0,01  
* Vrijheidsgraden: *df* = *n* -1 = 247 
* p-waarde < 0,05, dus de H~A~ wordt aangenomen  
* 95%-betrouwbaarheidsinterval; bij het herhalen van het onderzoek zal in 95% van de gevallen de µ in het interval vallen. 95%-betrouwbaarheidsinterval: 0,22 tot 0,29
* Het verschil tussen beide groepen: *MD* = 0,26

### Effectmaat

#### Cohen's d
Gebruik `cohen.d()` met `paired = TRUE` om het effect te meten.
```{r Cohen s d}
library(effsize)
cohen.d(Evaluatie_score_voor_tutorgesprek, Evaluatie_score_na_tutorgesprek, paired = TRUE)
```
*d* = 0,09. De sterkte van het effect van de tutor op het cijfer is minimaal. 


```{r eta-squared, include = FALSE, echo = FALSE}
#ik heb geen optie gevonden die etasq uitrekent zonder anova. Gebruik je deze eigenlijk wel voor t-toets?
t <- 17.713
df <- 245
Eta2 <- (t^2) / (t^2 + 245)
Eta2
```

## 5 Rapportage
Een *gepaarde t-toets* is uitgevoerd om te toetsen of het gemiddelde cijfer gelijk is gebleven na een gesprek met hun tutor. Het verschil tussen het gemiddelde van T~0~ (*M~T0~* = 3,65, *SD~T0~* = 0,56) en het gemiddelde van T~1~ (*M~T1~* = 3,4, *SD~T1~* = 0,85) is significant, *t* (247) = -2,7787, *p* < 0,01. Opvallend aan deze data is dat het gemiddelde van T~1~ lager is dan T~0~. Het effect is minimaal, *d* = 0,09. Het 95% betrouwbaarheidsinterval voor het verschil tussen het gemiddelde van beide groepen is van -0,27 tot -0,04. 

Aan de hand van de resultaten kan geconcludeerd worden dat de studenten, na een gesprek met de tutor, de opleiding slechter beoordelen dan daarvoor.  

[^1]: Student's t-test [Wikipedia]. (2019 August 21). Verkregen van: https://en.wikipedia.org/wiki/Student%27s_t-test
[^2]: Laerd statistics. (2018). Testing for Normality using SPSS Statistics. Verkregen van: https://statistics.laerd.com/spss-tutorials/testing-for-normality-using-spss-statistics.php  
[^3]: Normaliteit. (14 jul 2014). [UvA Wiki Methodologiewinkel]. Verkregen van: https://wiki.uva.nl/methodologiewinkel/index.php/Normaliteit  
[^4]: van Geloven, N. (2013, 25 September). Wilcoxon signed rank toets [Wiki Statistiek Academisch Medisch Centrum]. Verkregen van: https://wikistatistiek.amc.nl/index.php/Wilcoxon_signed_rank_toets
[^5]: Marshall, E., & Boggis, E. (2016). The statistics tutor’s quick guide to commonly used statistical tests. *Statstutor Community Project.*


---
title: "Gepaarde t-toets"
author: "© 2019, SURF Versnellingsagenda - Statistisch Handboek Hoger Onderwijs"
date: "`r format(Sys.time(), '%d-%m-%y')`"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    theme: united
---

<style>
  .col2 {
    columns: 2 200px;
    -webkit-columns: 2 200px;
    -moz-columns: 2 200px;
  }
</style>

``` {r versiegeschiedenis, include = FALSE, eval = FALSE}
## versie 0.1     3-9-19
## versie 0.2     4-9-19
```
```{r opmerking, include=FALSE, eval=FALSE}
# ipv Cohen's d kan ook eta squared gebruikt worden om effectmaat te berekenen. Wordt vaak wel gedaan bij de ANOVA. 
# doorlinken naar de Wilcoxon Signed Rank Test
# Voorbeeld, teveel neigen naar een Likert-schaal?
# linken naar blz transformeren data 

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r aanmaken data, include=FALSE, echo=TRUE}
RNGkind(sample.kind = "Rounding")
set.seed(2)

## Maak ruwe data aan
mu <- 3.6
sigma <- 0.6
Tevredenheidscijfer_na_tutorgesprek <- rnorm(250, mu, sigma)

Tevredenheidscijfer_na_tutorgesprek <- Tevredenheidscijfer_na_tutorgesprek[Tevredenheidscijfer_na_tutorgesprek <= 5 
                                                                       & Tevredenheidscijfer_na_tutorgesprek >= 1]

mu <- 3.4
sigma <- 0.9
Tevredenheidscijfer_voor_tutorgesprek <- rnorm(260, mu, sigma)

Tevredenheidscijfer_voor_tutorgesprek <- Tevredenheidscijfer_voor_tutorgesprek[Tevredenheidscijfer_voor_tutorgesprek <= 5 
                                                                   & Tevredenheidscijfer_voor_tutorgesprek >= 1]
## Stel volgorde en lengte van steekproef vast
volgorde <- sample(1:length(Tevredenheidscijfer_na_tutorgesprek), length(Tevredenheidscijfer_na_tutorgesprek))
volgorde_n30 <- sample(1:30, 30)
Verschil_grootte <- length(Tevredenheidscijfer_voor_tutorgesprek) - length(Tevredenheidscijfer_na_tutorgesprek)

## Rond evaluatiecijfers af
Tevredenheidscijfer_na_tutorgesprek <- sapply(Tevredenheidscijfer_na_tutorgesprek, round, 3)
Tevredenheidscijfer_voor_tutorgesprek <- sapply(Tevredenheidscijfer_voor_tutorgesprek, round, 3)

## Definiëer lengte in steekproef en hussel paren
Tevredenheidscijfer_na_tutorgesprek <- sort(Tevredenheidscijfer_na_tutorgesprek)
Tevredenheidscijfer_na_tutorgesprek <- Tevredenheidscijfer_na_tutorgesprek[volgorde]
Tevredenheidscijfer_voor_tutorgesprek <- sort(Tevredenheidscijfer_voor_tutorgesprek)
Tevredenheidscijfer_voor_tutorgesprek <- Tevredenheidscijfer_voor_tutorgesprek[sample(-283:-1, Verschil_grootte)]
Tevredenheidscijfer_voor_tutorgesprek <- Tevredenheidscijfer_voor_tutorgesprek[volgorde]



mu <- 3.6
sigma <- 0.6
Tevredenheidscijfer_voor_tutorgesprek_n30 <- rnorm(30, mu, sigma)

Tevredenheidscijfer_voor_tutorgesprek_n30 <- Tevredenheidscijfer_voor_tutorgesprek_n30[Tevredenheidscijfer_voor_tutorgesprek_n30 <= 5 
                                                                 & Tevredenheidscijfer_voor_tutorgesprek_n30 >= 1]
Tevredenheidscijfer_voor_tutorgesprek_n30 <- sapply (Tevredenheidscijfer_voor_tutorgesprek_n30, round, 3)
Tevredenheidscijfer_voor_tutorgesprek_n30 <- sort(Tevredenheidscijfer_voor_tutorgesprek_n30)
Tevredenheidscijfer_voor_tutorgesprek_n30 <- Tevredenheidscijfer_voor_tutorgesprek_n30[volgorde_n30]

mu <- 3.5
sigma <- 0.4
Tevredenheidscijfer_na_tutorgesprek_n30 <- rnorm(30, mu, sigma)

Tevredenheidscijfer_na_tutorgesprek_n30 <- Tevredenheidscijfer_na_tutorgesprek_n30[Tevredenheidscijfer_na_tutorgesprek_n30 <= 5 
                                                               & Tevredenheidscijfer_na_tutorgesprek_n30 >= 1]
Tevredenheidscijfer_na_tutorgesprek_n30 <- sapply(Tevredenheidscijfer_na_tutorgesprek_n30, round, 3)
Tevredenheidscijfer_na_tutorgesprek_n30 <- sort(Tevredenheidscijfer_na_tutorgesprek_n30)
Tevredenheidscijfer_na_tutorgesprek_n30 <- Tevredenheidscijfer_na_tutorgesprek_n30[volgorde_n30]
```

## 1 Toepassing
Bij het toetsen of het gemiddelde van twee groepen aan elkaar gelijk zijn, wordt de *t-toets* gebruikt. De *gepaarde t-toets* wordt gebruikt bij een herhaalde meting van dezelfde groep [^1]. 

## 2 Onderwijscasus
Ter voorbereiding op een visitatie vraagt de opleidingsdirecteur van de lerarenopleiding zich af of het gemiddelde tentamencijfer veranderd na een gesprek met een tutorgesprek. Ze bekijkt het gemiddelde tentamencijfer van de onderwijsperiode voor het tutorgesprek (T~0~) en het gemiddelde cijfer van de onderwijsperiode erop (T~1~). 

H~0~: Het gemiddelde tentamencijfer per onderwijsperiode verandert niet na het tutorgesprek, µ~T0~ = µ~T1~  

H~A~: Het gemiddelde tentamencijfer per onderwijsperiode verandert na het tutorgesprek, µ~T0~ ≠ µ~T1~ 


## 3 Assumpties
### 3.1 Normaliteit
De *t-toets* gaat ervan uit dat de data normaal verdeeld is. Controleer deze assumptie met de volgende stappen:  
1. Controleer de data visueel met een histogram, een boxplot of een Q-Q plot.  
2. Toets of de data normaal verdeeld is met de *Kolmogorov-Smirnov test* of bij een kleinere steekproef (n < 50[^3]) met de *Shapiro-Wilk test* [^4].  
3. Als uit bovenstaande tests blijkt dat de data niet normaal verdeeld is, transformeer de data en kijk daarna of het normaal verdeeld is.  

Als er geen sprake is van normaliteit, gebruik de *Wilcoxon Signed Rank Test* [^5].

## 4 Effectmaat
Bereken de effectmaat om te bepalen of de gevonden p-waarde betekenisvol is. Een veel gebruikte effectmaat is Cohen's *d*. Cohen's *d* geeft de sterkte van het effect van een onafhankelijke variabele op een afhankelijke variabele weer.  

Een indicatie om *d* te interpreteren is: rond 0,3 is een klein effect, rond 0,5 is een gemiddeld effect en rond 0,8 is een groot effect [^6].  

## 5 Uitvoering in R
Er is een dataset ingeladen met `Tevredenheidscijfer_voor_tutorgesprek` (T~0~) en met `Tevredenheidscijfer_na_tutorgesprek` (T~1~). 

### 5.1 Test assumpties: Normaliteit 
<div class="col2">
```{r beschrijvende gegevens na tutor, collapse = TRUE}
mean(
  Tevredenheidscijfer_voor_tutorgesprek)
sd(Tevredenheidscijfer_voor_tutorgesprek)
```

Gemiddeld tentamencijfer voor tutorgesprek (standaardafwijking): 3,34 (0,85)



```{r Assumptietest, collapse=TRUE}
mean(
  Tevredenheidscijfer_na_tutorgesprek)
sd(Tevredenheidscijfer_na_tutorgesprek)
```

Gemiddeld tentamencijfer na tutorgesprek (standaardafwijking): 3,60 (0,56)

</div>

#### Histogram
```{r library ggplot}
library(ggplot2)
```

<div class ="col2">
```{r histogram voor tutorgesprek}
ggplot(
  data.frame(Tevredenheidscijfer_voor_tutorgesprek),
  aes(x = Tevredenheidscijfer_voor_tutorgesprek)) +
  geom_histogram(aes(y = ..density..),
                 binwidth = 0.5, 
                 color = "grey30", 
                 fill = "#0089CF") + 
  geom_density(alpha = .2, adjust = 1) +
  ylab("Frequentiedichtheid") +
  xlab("Tevredenheidscijfer_voor_tutorgesprek") +
  scale_x_continuous(
    labels = as.character(seq(1, 5, 0.5)),
    breaks = seq(1, 5, 0.5)) +
    coord_fixed(ylim = c(0, 0.6),
              xlim = c(1, 5),
              ratio = 4) +
  labs(title = expression(paste("Tevredenheidscijfers (", T[0], ")")))
```

```{r histogram na tutorgesprek}
ggplot(
  data.frame(Tevredenheidscijfer_na_tutorgesprek),
  aes(x = Tevredenheidscijfer_na_tutorgesprek)) +
  geom_histogram(aes(y = ..density..),
                 binwidth = 0.5, 
                 color = "grey30", 
                 fill = "#0089CF") + 
  geom_density(alpha = .2, adjust = 1) +
  ylab("Frequentiedichtheid") +
  xlab("Tevredenheidscijfer_na_tutorgesprek") +
  scale_x_continuous(
    labels = as.character(seq(1, 5, 0.5)),
    breaks = seq(1, 5, 0.5)) +
  coord_fixed(ylim = c(0, 0.6),
              xlim = c(1, 5),
              ratio = 4) +
  labs(title = expression(paste("Tevredenheidscijfers (", T[1], ")")))
```

</div>
Beide histogrammen laten een belcurve zien vergelijkbaar aan een normale verdeling. Veel waardes liggen rondom de gemiddeldes. Het histogram `Tevredenheidscijfer_voor_tutorgesprek` lijkt licht scheef verdeeld. 


#### Q-Q plot
Gebruik `qqnorm()` en `qqline()`. Gebruik `pch = 20`om gevulde datapunten te creëren.

<div class ="col2">
```{r qqplot voor tutor}
qqnorm(Tevredenheidscijfer_voor_tutorgesprek , pch = 20)
qqline(Tevredenheidscijfer_voor_tutorgesprek)
```

```{r qqplot na tutor}
qqnorm(Tevredenheidscijfer_na_tutorgesprek, pch = 20)
qqline(Tevredenheidscijfer_na_tutorgesprek)
```
</div>
Als over het algemeen de meeste datapunten op de lijn liggen, kan aangenomen worden dat de data normaal verdeeld is. In deze casus liggen de meeste punten op de lijn behalve bij de uiteinden. 

#### Boxplot
<div class ="col2">
``` {r Boxplot na}
boxplot(Tevredenheidscijfer_voor_tutorgesprek, 
        xlab = "Lerarenopleiding", 
        ylab = "Tevredenheidscijfer_voor_tutorgesprek")
```

``` {r Boxplot voor}
boxplot(Tevredenheidscijfer_na_tutorgesprek, 
        xlab = "Lerarenopleiding", 
        ylab = "Tevredenheidscijfer_na_tutorgesprek")
```
</div>
De boxplotten geven de spreiding van het gemiddelde tenamencijfer per periode weer voor de Lerarenopleiding. 

### {.toc-ignore}

***
### {.toc-ignore}

Om te controleren of de data, ondanks eventuele afwijkende punten of een scheef lijkende verdeling, normaal verdeel is, kan de normaliteit getoets worden. Hierbij een toelichting bij twee veel gebruikte toetsen: de *Kolmogorov-Smirnov test* en de *Shapiro-Wilk test*.

#### Kolmogorov-Smirnov (met Lilliefors correctie)
```{r library nortest, warning=FALSE}
library(nortest)
```
<div class ="col2">
``` {r Lilliefors Test, warning=FALSE}
lillie.test(Tevredenheidscijfer_voor_tutorgesprek)
lillie.test(Tevredenheidscijfer_na_tutorgesprek)
```
</div>

De *Kolmogorov-Smirnov test* toetst het verschil in vorm tussen de twee verdelingen. In dit geval toetst deze test het verschil tussen een normale verdeling en de verdeling van de steekproef. De Lilliefors correctie is een correctie op de *Kolmogorov-Smirnov test*, die wordt gebruikt als het gemiddelde van de steekproef niet 0 is en de standaardafwijking niet 1 is. Als de p-waarde groter is dan 0,05 is de verdeling van de data niet significant verschillend van een normale verdeling.  

In dit geval is van beide groepen de p-waarde > 0,05; er is geen significant verschil gevonden tussen de verdeling van de steekproef en de normale verdeling. Er wordt aan de assumptie van normaliteit voldaan, dus de *gepaarde t-toets* kan uitgevoerd worden. 

#### Shapiro-Wilk Test
<div class ="col2">
``` {r Shapiro-Wilk Test, warning=FALSE}
shapiro.test(Tevredenheidscijfer_voor_tutorgesprek_n30)
shapiro.test(Tevredenheidscijfer_na_tutorgesprek_n30)
```
</div>

De *Shapiro-Wilk test* is een soort gelijke test als de *Kolmogorov-Smirnov test* en wordt vooral gebruikt bij kleine steekproeven. Als de p-waarde groter is dan 0,05 is de verdeling van de data niet significant verschillend van de normale verdeling. 

In dit voorbeeld, met een kleine *n*, hebben beide groepen een p-waarde > 0,05. De verdeling van beide groepen is niet significant verschillend van de normale verdeling. Er wordt aan de assumptie van normaliteit voldaan. De *gepaarde t-toets* kan uitgevoerd worden.  

### {.toc-ignore}

***
### 5.2 Gepaarde t-toets

Gebruik `t.test()` met `paired = TRUE`. 
```{r statistische toets}
t.test(Tevredenheidscijfer_voor_tutorgesprek, Tevredenheidscijfer_na_tutorgesprek, paired = TRUE)
```

* *t* (247) = -13,58 *p* < 0,01  
* Vrijheidsgraden: *df* = *n* -1 = 247  
* p-waarde < 0,05, dus de H~A~ wordt aangenomen  
* 95%-betrouwbaarheidsinterval; bij het herhalen van het onderzoek zal in 95% van de gevallen de µ in het interval vallen. 95%-betrouwbaarheidsinterval: -0,22 tot -0,29  
* Het verschil tussen beide groepen: *MD* = -0,26  

### 5.3 Effectmaat: Cohen's d
Gebruik `cohen.d()` met `paired = TRUE` om het effect te meten.
```{r Cohen s d}
library(effsize)
cohen.d(Tevredenheidscijfer_voor_tutorgesprek, Tevredenheidscijfer_na_tutorgesprek, paired = TRUE)
```
*d* = -0,09. De sterkte van het effect van de tutor op het cijfer is minimaal. 


```{r eta-squared, include = FALSE, echo = FALSE}
#ik heb geen optie gevonden die etasq uitrekent zonder anova. Gebruik je deze eigenlijk wel voor t-toets?
t <- 17.713
df <- 245
Eta2 <- (t^2) / (t^2 + 245)
Eta2
```

## 6 Rapportage
Een *gepaarde t-toets* is uitgevoerd om te toetsen of het gemiddelde tevredenheidscijfer van de studenten gelijk is gebleven na een gesprek met hun tutor. Het verschil tussen het gemiddelde van T~0~ (*M~T0~* = 3,4, *SD~T0~* = 0,85) en het gemiddelde van T~1~ (*M~T1~* = 3,60, *SD~T1~* = 0,56) is significant, *t* (247) = -13,8, *p* < 0,01. Het 95% betrouwbaarheidsinterval voor het verschil tussen het gemiddelde van beide groepen is van -0,22 tot -0,29. Het valt op dat het gemiddelde van T~1~ hoger is dan T~0~. Het effect is minimaal, *d* = 0,09. 

Aan de hand van de resultaten kan geconcludeerd worden dat de studenten, na een gesprek met de tutor, de opleiding beter beoordelen dan daarvoor, maar het effect is minimaal.  

[^1]: Student's t-test [Wikipedia]. (21 augustus 2019). https://en.wikipedia.org/wiki/Student%27s_t-test
[^3]: van Geloven, N. (25 september2013). Wilcoxon signed rank toets [Wiki Statistiek Academisch Medisch Centrum]. https://wikistatistiek.amc.nl/index.php/Wilcoxon_signed_rank_toets
[^4]: Laerd statistics. (2018). Testing for Normality using SPSS Statistics. https://statistics.laerd.com/spss-tutorials/testing-for-normality-using-spss-statistics.php  
[^5]: Normaliteit. (14 juli 2014). [UvA Wiki Methodologiewinkel]. https://wiki.uva.nl/methodologiewinkel/index.php/Normaliteit  
[^6]: Marshall, E., & Boggis, E. (2016). The statistics tutor’s quick guide to commonly used statistical tests. *Statstutor Community Project.*


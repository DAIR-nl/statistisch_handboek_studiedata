---
title: "One-way ANOVA"
author: "© 2019, SURF Versnellingsagenda Statistisch Handboek Hoger Onderwijs"
date: "`r format(Sys.time(), '%d-%m-%y')`"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    theme: united
---
<style>
  .col2 {
    columns: 2 200px;
    -webkit-columns: 2 200px;
    -moz-columns: 2 200px;
  }
</style>

``` {r versiegeschiedenis, include = FALSE, eval = FALSE}
## versie 0.1     3-9-19
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r opmerking, include=FALSE, eval=FALSE}


#posthoc Tukey 
```



```{r aanmaken data, include=FALSE, echo=TRUE}
## Het hoofd communicatie wil in verband met wervingsactiviteiten weten wat de reistijd is van studenten aan verschillende opleidingen.


## Doel: tidy data met een kolom reistijd (value) en een kolom opleidng (factor)
library(dplyr)
RNGkind(sample.kind = "Rounding")
set.seed(0)

Studiegrootte <- 311
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_gsk <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_gsk <- replicate(2.1*Studiegrootte, "Geneeskunde")

Studiegrootte <- 33
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_soc <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_soc <- replicate(2.1*Studiegrootte, "Sociologie")

Studiegrootte <- 73
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_aee <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_aee <- replicate(2.1*Studiegrootte, "Aarde en economie")

Studiegrootte <- 23
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_atc <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_atc <- replicate(2.1*Studiegrootte, "Arabische Taal en Cultuur")

Studiegrootte <- 212
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_bfk <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_bfk <- replicate(2.1*Studiegrootte, "Bedrijfskunde")

Studiegrootte <- 68
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_cvt <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_cvt <- replicate(2.1*Studiegrootte, "Civiele techniek")

Studiegrootte <- 41
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_ect <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_ect <- replicate(2.1*Studiegrootte, "Econometrie")

Studiegrootte <- 267
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_psy <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_psy <- replicate(2.1*Studiegrootte, "Psychologie")

Studiegrootte <- 61
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_gsc <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_gsc <- replicate(2.1*Studiegrootte, "Geschiedenis")

Studiegrootte <- 140
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_csc <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_csc <- replicate(2.1*Studiegrootte, "Computer science")

Studiegrootte <- 82
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_ids <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_ids <- replicate(2.1*Studiegrootte, "Industrial design")

Studiegrootte <- 105
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_las <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_las <- replicate(2.1*Studiegrootte, "Liberal arts and Sciences")

Studiegrootte <- 71
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_kgs <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_kgs <- replicate(2.1*Studiegrootte, "Kunstgeschiedenis")

Studiegrootte <- 29
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_fil <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_fil <- replicate(2.1*Studiegrootte, "Filosofie")

Studiegrootte <- 81
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_sck <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_sck <- replicate(2.1*Studiegrootte, "Scheikunde")

Studiegrootte <- 61
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 25, 8)
reistijd_pws <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_pws <- replicate(2.1*Studiegrootte, "Pedagogische wetenschappen")

Studiegrootte <- 84
reistijd_gem <- rnorm(1, 45, 9)
sd_gem <- rnorm(1, 23, 8)
reistijd_wis <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_wis <- replicate(2.1*Studiegrootte, "Wiskunde")



Reistijd <- c(reistijd_aee, reistijd_atc, reistijd_bfk, reistijd_csc, reistijd_cvt,
               reistijd_ect, reistijd_fil, reistijd_gsc, reistijd_gsk, reistijd_ids, 
               reistijd_kgs, reistijd_las, reistijd_psy, reistijd_pws, reistijd_sck, 
               reistijd_soc, reistijd_wis)

Opleiding <- c(namenlijst_aee, namenlijst_atc, namenlijst_bfk, namenlijst_csc, namenlijst_cvt,
               namenlijst_ect, namenlijst_fil, namenlijst_gsc, namenlijst_gsk, namenlijst_ids,
               namenlijst_kgs, namenlijst_las, namenlijst_psy, namenlijst_pws, namenlijst_sck,
               namenlijst_soc, namenlijst_wis)

Opleiding <- Opleiding[order(Reistijd)]
Reistijd <- sort(Reistijd)

Reistijd_per_opleiding <- data.frame(Reistijd, Opleiding)
colnames(Reistijd_per_opleiding) <- c("Reistijd", "Opleiding")


Reistijd_per_opleiding <- Reistijd_per_opleiding %>%
  mutate(Reistijd = if_else(Reistijd < 0, Reistijd*-1, Reistijd))
```

## 1 Toepassing
Bij het toetsen of het gemiddelde van drie of meer onafhankelijke groepen aan elkaar gelijk zijn, wordt de *one-way ANOVA* gebruikt [^1]. 

## 2 Onderwijscasus
In verband met wervingsactiviteiten wil het hoofd van de afdeling Communicatie weten wat de reistijd is van studenten aan verschillende opleidingen. Hij heeft daarom data verzameld over de reistijd van uitwonende studenten per opleiding. 

H~0~: De gemiddelde reistijd van de studenten is per opleiding gelijk aan elkaar: µ~0~ = µ~1~ = µ~2~ ... µ~n~  
H~A~: Tenminste voor één opleiding is de gemiddelde reistijd niet gelijk aan de gemiddelde reistijd van studenten voor andere opleidingen. µ~0~ ≠ µ~1~ = µ~2~ ... = µ~n~

## 3 Assumpties
Controleer of de steekproef aan de volgende assumpties voldoen:  
1. Normaliteit  
2. Homogeniteit van varianties  
3. Onafhankelijkheid   

Als de data niet voldoet aan één van deze assumpties kan de test *one -way ANOVA* nog steeds uitgevoerd en geïnterpreteerd worden.

### 1. Normaliteit
Controleer de assumptie van normaliteit met de volgende stappen:  
1. Controleer de data visueel met een histogram, een boxplot of een Q-Q plot.  
2. Toets of de data normaal verdeeld is met de *Kolmogorov-Smirnov test* of bij een kleinere steekproef (n < 50[^2]) met de *Shapiro-Wilk test* [^3].  

```{r opmerking, include=FALSE, eval=FALSE}
# 3. Als blijkt dat de data niet normaal verdeeld is, transformeer de data en kijk daarna of het normaal verdeeld is.
```

Als er geen sprake is van normaliteit, gebruik de *Kruskal-Wallis test* [^4].  

### 2. Homogeniteit van Varianties
Controleer of de spreiding van iedere groep ongeveer hetzelfde is, dit kan getoetst worden met de *Levene's Test (for equality of variance)*. Wanneer de test significant is, is de spreiding van de groepen verschillend.[^5]  

### 3. Onafhankelijkheid
Elke groep heeft geen overlap met één van de andere groepen en de groepen kunnen elkaars deelname niet beïnvloeden. 


## 4 Uitvoering in R
Er is een dataset ingeladen genaamd `Reistijd_per_opleiding`. Deze bevat data de reistijden van uitwonende studenten per opleiding.

### De data bekijken
Gebruik `head()` om de data te bekijken
```{r de data bekijken}
head(Reistijd_per_opleiding)
```
```{r de data visualiseren}
levels(Reistijd_per_opleiding$Opleiding)
library(graphics)
par(mar = c(3, 12, 1, 0) + .1)
boxplot(Reistijd ~ Opleiding, Reistijd_per_opleiding, las = 2, horizontal = TRUE)
```

Een andere optie zijn deze ridges:
```{r ridges, warning = FALSE, message = FALSE}
library(tidyverse)
library(ggridges)

ggplot(Reistijd_per_opleiding, aes(Reistijd, Opleiding)) +
  geom_density_ridges(rel_min_height=.01)
```


### Assumpties testen in R
```{r lillietest voorbereiden}
library(nortest)
Reistijdlijst <- Reistijd_per_opleiding %>%
  split(Opleiding)
```

```{r lillietest}
for (. in Reistijdlijst) {
  print(lillie.test(.$Reistijd))
}
```


### One way ANOVA 
```{r ANOVA}
res.aov <- aov(Reistijd ~ Opleiding, Reistijd_per_opleiding)
summary(res.aov)
```


### Post-hoc vergelijking 
De *one-way ANOVA* toetst of één of meerdere van de gemiddelden anders is dan de andere gemiddelden, welke groep anders is wordt niet gespecificeerd. Als er bij de *one-way ANOVA* uitkomt dat er een significant verschil is tussen de groepen kan een post-hoc vergelijking gedaan worden om te bepalen welke groepen significant verschillen.  
Er zijn meerdere post-hoc vergelijkingen:
* *Tukey* wordt gebruikt als de assumptie van gelijke varianties is voldaan
* Dunnet's *C* wordt gebruikt bij ongelijke varianties 


## 5 Rapportage
[^1]: van Geloven, N. (May 25 2016). One-way ANOVA [Wiki Statistiek Academisch Medisch Centrum]. https://wikistatistiek.amc.nl/index.php/One-way_ANOVA
[^2]: van Geloven, N. (2013, 25 September). Wilcoxon signed rank toets [Wiki Statistiek Academisch Medisch Centrum]. https://wikistatistiek.amc.nl/index.php/Wilcoxon_signed_rank_toets
[^3]: Laerd statistics. (2018). Testing for Normality using SPSS Statistics. https://statistics.laerd.com/spss-tutorials/testing-for-normality-using-spss-statistics.php  
[^4]: One-way ANOVA. (8 juli 2014). [UvA Wiki Methodologiewinkel]. https://wiki.uva.nl/methodologiewinkel/index.php/One-way_ANOVA



[^2]: Laerd statistics. (2018). Testing for Normality using SPSS Statistics. Verkregen van: https://statistics.laerd.com/spss-tutorials/testing-for-normality-using-spss-statistics.php  
[^3]: Normaliteit. (14 jul 2014). [UvA Wiki Methodologiewinkel]. Verkregen van: https://wiki.uva.nl/methodologiewinkel/index.php/Normaliteit  





[^1]: van Geloven, N. (2016, May 25). T-toets [Wiki Statistiek Academisch Medisch Centrum]. Verkregen van: https://wikistatistiek.amc.nl/index.php/T-toets#one_sample_t-toets

[^4]: Prabhakaran, S. (2016-2017). Statistical Tests [r-statistics.co]. Verkregen van: http://r-statistics.co/Statistical-Tests-in-R.html  
[^5]: Knottnerus, J. A., & Bouter, L. M. (2001). The ethics of sample size: Two-sided testing and one-sided thinking. *Journal of Clinical Epidemiology, 54*(2), 109-110.

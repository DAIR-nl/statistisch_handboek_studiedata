---
title: "One-way ANOVA"
author: "© 2019, SURF Versnellingsagenda - Statistisch Handboek Hoger Onderwijs"
date: "`r format(Sys.time(), '%d-%m-%y')`"
output: 
  html_document:
    toc: TRUE
    toc_float:  TRUE
    number_sections: TRUE
    theme: united
---
<style>
    .col3 {
    columns: 3 100px;
    -webkit-columns: 3 100px;
    -moz-columns: 3 100px;
  }
</style>

``` {r versiegeschiedenis, include = FALSE, eval = FALSE}
## versie 0.1     3-9-19
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r set-options, echo=FALSE, cache=FALSE}
options(width = 80)
## Zodat de TukeyHSD naast elkaar geprint wordt
```

```{r opmerking 1, include=FALSE, eval=FALSE}


#posthoc Tukey 
```



```{r aanmaken data, include=FALSE, echo=TRUE}
## Het hoofd communicatie wil in verband met wervingsactiviteiten weten wat de reistijd is van studenten aan verschillende opleidingen.
## 3. Als blijkt dat de data niet normaal verdeeld is, transformeer de data en kijk daarna of het normaal verdeeld is.

## Doel: tidy data met een kolom reistijd (value) en een kolom opleiding (factor)
library(dplyr)
RNGkind(sample.kind = "Rounding")
set.seed(3)

Studiegrootte <- 29
reistijd_gem <- 35
sd_gem <- 12
reistijd_fil <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_fil <- replicate(2.1*Studiegrootte, "Filosofie")

Studiegrootte <- 23
reistijd_gem <- 45
sd_gem <- 13
reistijd_atc <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_atc <- replicate(2.1*Studiegrootte, "Arabische Taal en Cultuur")

Studiegrootte <- 71
reistijd_gem <- 36
sd_gem <- 11
reistijd_gsc <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_gsc <- replicate(2.1*Studiegrootte, "Geschiedenis")

Reistijd <- c(reistijd_atc, reistijd_gsc, reistijd_fil)
Opleiding <- c(namenlijst_atc, namenlijst_gsc, namenlijst_fil)

Opleiding <- Opleiding[order(Reistijd)]
Reistijd <- sort(Reistijd)

Reistijd_per_opleiding <- data.frame(Reistijd, Opleiding)
colnames(Reistijd_per_opleiding) <- c("Reistijd", "Opleiding")


Reistijd_per_opleiding <- Reistijd_per_opleiding %>%
  mutate(Reistijd = if_else(Reistijd < 0, Reistijd*-1, Reistijd))
```

# Toepassing
Bij het toetsen of het gemiddelde van drie of meer onafhankelijke groepen aan elkaar gelijk zijn, wordt de *one-way ANOVA* gebruikt [^1]. 

# Onderwijscasus
In verband met wervingsactiviteiten wil het hoofd van de afdeling Communicatie weten wat de reistijd is van studenten aan verschillende opleidingen. Hij heeft daarom data verzameld over de reistijd van uitwonende studenten per opleiding. 

H~0~: De gemiddelde reistijd van de studenten is per opleiding gelijk aan elkaar: µ~0~ = µ~1~ = µ~2~ ... µ~n~  

H~A~: Tenminste voor één opleiding is de gemiddelde reistijd niet gelijk aan de gemiddelde reistijd van studenten voor andere opleidingen. µ~0~ ≠ µ~1~ = µ~2~ ... = µ~n~

# Assumpties
Controleer of de steekproef aan de volgende assumpties voldoen:  
1. Normaliteit  
2. Homogeniteit van varianties  
3. Onafhankelijkheid   

Als de data niet voldoet aan één van deze assumpties kan de test *one -way ANOVA* nog steeds uitgevoerd en geïnterpreteerd worden. 

## Normaliteit
Controleer de assumptie van normaliteit met de volgende stappen:  
1. Controleer de data visueel met een histogram, een boxplot of een Q-Q plot.  
2. Toets of de data normaal verdeeld is met de *Kolmogorov-Smirnov test* of bij een kleinere steekproef (n < 50[^2]) met de *Shapiro-Wilk test* [^3].  
3. Als blijkt dat de data niet normaal verdeeld is, transformeer de data eventueel en bepaal daarna of deze wel normaal verdeeld is.

Als er geen sprake is van normaliteit, gebruik de *Kruskal-Wallis test* [^4]. 

```{r opmerking 2, include=FALSE, eval=FALSE}
# 3. Als blijkt dat de data niet normaal verdeeld is, transformeer de data en kijk daarna of het normaal verdeeld is.
```

## Homogeniteit van Varianties
Controleer of de spreiding van iedere groep ongeveer hetzelfde is, dit kan getoetst worden met de *Levene's Test (for equality of variance)*. Wanneer de test significant is, is de spreiding van de groepen verschillend.[^5]  

## Onafhankelijkheid
Elke groep heeft geen overlap met één van de andere groepen en de groepen kunnen elkaars deelname niet beïnvloeden. Deze stap wordt beredeneerd en wordt niet getoetst.  

# Post-hoc vergelijking 
De *one-way ANOVA* toetst of één of meerdere van de gemiddelden anders is dan de andere gemiddelden. Welke groep anders is wordt niet gespecificeerd. Als er bij de *one-way ANOVA* uitkomt dat er een significant verschil is tussen de groepen kan een post-hoc vergelijking gedaan worden om te bepalen welke groepen significant verschillen.  

Er zijn meerdere post-hoc vergelijkingen: 

* *Tukey* wordt gebruikt als de assumptie van gelijke varianties is voldaan  
* Dunnet's *C* wordt gebruikt bij ongelijke varianties  

# Uitvoering in R
Er is een dataset ingeladen met de reistijden van uitwonende studenten per opleiding is ingeladen genaamd `Reistijd_per_opleiding`. 

## De data bekijken
Gebruik `head()` om de data te bekijken.
```{r de data bekijken}
head(Reistijd_per_opleiding)
```

Gebruik vervolgens `levels()` om te onderzoeken welke opleidingen er in de data aanwezig zijn. 
```{r de data visualiseren}
levels(Reistijd_per_opleiding$Opleiding)
```

Voor `mean()`, `sd()`, `boxplot()` en voor `lillie.test()` is het handig om eerst de verschillende groepen op te slaan in een vector.
```{r subset}
Reistijd_atc <- Reistijd_per_opleiding$Reistijd[Reistijd_per_opleiding$Opleiding == "Arabische Taal en Cultuur"]
Reistijd_fil <- Reistijd_per_opleiding$Reistijd[Reistijd_per_opleiding$Opleiding == "Filosofie"]
Reistijd_gsc <- Reistijd_per_opleiding$Reistijd[Reistijd_per_opleiding$Opleiding == "Geschiedenis"]
```

Bekijk het gemiddelde en de standaardafwijking met `mean()` en `sd()`.

<div class ="col3">

```{r descriptives atc, collapse=TRUE}
mean(Reistijd_atc)
sd(Reistijd_atc)
```
```{r descriptives fil, collapse=TRUE}
mean(Reistijd_fil)
sd(Reistijd_fil)
```
```{r descriptives gsc, collapse=TRUE}
mean(Reistijd_gsc)
sd(Reistijd_gsc)
```
</div>

## Test assumpties: normaliteit 
### Histogram
```{r lib ggplot2}
library(ggplot2)
```
```{r histogram atc}
ggplot(Reistijd_per_opleiding,
  aes(x = Reistijd)) +
  geom_histogram(aes(y = ..density..),
                 binwidth = 10,
                 color = "grey30",
                 fill = "#0089CF") +
  facet_wrap(~ Opleiding) +
  geom_density(alpha = .2, adjust = 1) +
  ylab("Frequentiedichtheid") +
  labs(title = "Reistijd")


## Hoeveel bins willen we?

ggplot(Reistijd_per_opleiding,
  aes(x = Reistijd)) +
  geom_histogram(aes(y = ..density..),
                 color = "grey30",
                 fill = "#0089CF") +
  facet_wrap(~ Opleiding) +
  geom_density(alpha = .2, adjust = 1) +
  ylab("Frequentiedichtheid") +
  labs(title = "Reistijd")
```

### Q-Q plot

Gebruik `qqnorm()` en `qqline()` met `pch = 1` om een boxplot te maken met kleine cirkels. 

<div class ="col3">
```{r qqplot atc}
qqnorm(Reistijd_atc, pch = 1)
qqline(Reistijd_atc)
```
```{r qqplot fil}
qqnorm(Reistijd_fil, pch = 1)
qqline(Reistijd_fil)
```
```{r qqplot gsc}
qqnorm(Reistijd_gsc, pch = 1)
qqline(Reistijd_gsc)
```
</div>

### Boxplot

```{r boxplot}
library(graphics)
boxplot(Reistijd ~ Opleiding, Reistijd_per_opleiding)
```

### Kolmogorov-Smirnov (met Lilliefors correctie) 

```{r lillietest, collapse=TRUE}
library("nortest")
lillie.test(Reistijd_atc)
lillie.test(Reistijd_fil)
lillie.test(Reistijd_gsc)
```

## Test assumpties: Levene's test

```{r LeveneTest, warning = FALSE, message = FALSE}
library(car)
leveneTest(Reistijd_per_opleiding$Reistijd, Reistijd_per_opleiding$Opleiding)
```

## One way ANOVA 
Gebruik `aov()` voor een ANOVA. Geef het resultat overzichtelijk weer met `summary()`. Gebruik vervolgens `TukeyHSD()` om een Tukey-test te doen om te kijken welke verschillen significant zijn.
```{r ANOVA}
res.aov <- aov(Reistijd ~ Opleiding, Reistijd_per_opleiding)
summary(res.aov)
TukeyHSD(res.aov)
```

# Rapportage
Een *one-way ANOVA* is uitgevoerd om te toetsen of de gemiddelde reistijd van de studenten is per opleiding gelijk aan elkaar is. De onafhankelijke variabele, opleiding, is onderverdeeld in drie niveau's **(Opleiding 1, 2, 3 )** en de afhankelijke variabele is de reistijd van de studenten. The *one way ANOVA* was significant **F(1, 338) = 0,92, p-waarde = 0,034** 
**effect **
**posthoc en uitkomsten **


[^1]: van Geloven, N. (25 mei 2016). One-way ANOVA [Wiki Statistiek Academisch Medisch Centrum]. https://wikistatistiek.amc.nl/index.php/One-way_ANOVA
[^2]: Laerd statistics. (2018). Testing for Normality using SPSS Statistics. https://statistics.laerd.com/spss-tutorials/testing-for-normality-using-spss-statistics.php  
[^3]: Normaliteit. (14 juli 2014). [UvA Wiki Methodologiewinkel]. https://wiki.uva.nl/methodologiewinkel/index.php/Normaliteit  
[^4]: van Geloven, N. (21 maart 2018). Kruskal Wallis [Wiki Statistiek Academisch Medisch Centrum]. https://wikistatistiek.amc.nl/index.php/Kruskal_Wallis
[^5]: Analysis of variance. (7 september 2019). [Wikipedia] https://en.wikipedia.org/wiki/Analysis_of_variance 

---
title: "One-way ANOVA"
author: "© 2019, SURF Versnellingsagenda - Statistisch Handboek Hoger Onderwijs"
date: "`r format(Sys.time(), '%d-%m-%y')`"
output: 
  html_document:
    toc: TRUE
    toc_float:  TRUE
    number_sections: TRUE
    theme: united
---
<style>
    .col3 {
    columns: 3 100px;
    -webkit-columns: 3 100px;
    -moz-columns: 3 100px;
  }
</style>

``` {r versiegeschiedenis, include = FALSE, eval = FALSE}
## versie 0.1     3-9-19
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r set-options, echo=FALSE, cache=FALSE}
options(width = 80)
## Zodat de TukeyHSD naast elkaar geprint wordt
```

```{r aanmaken data, include=FALSE, echo=TRUE}
## Het hoofd communicatie wil in verband met wervingsactiviteiten weten wat de reistijd is van studenten aan verschillende opleidingen.

## Doel: tidy data met een kolom reistijd (value) en een kolom opleiding (factor)
library(dplyr)
RNGkind(sample.kind = "Rounding")
set.seed(3)

Studiegrootte <- 29
reistijd_gem <- 35
sd_gem <- 12
reistijd_fil <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_fil <- replicate(2.1*Studiegrootte, "Filosofie")

Studiegrootte <- 23
reistijd_gem <- 45
sd_gem <- 13
reistijd_atc <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_atc <- replicate(2.1*Studiegrootte, "Arabische Taal en Cultuur")

Studiegrootte <- 71
reistijd_gem <- 36
sd_gem <- 11
reistijd_gsc <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_gsc <- replicate(2.1*Studiegrootte, "Geschiedenis")

Reistijd <- c(reistijd_atc, reistijd_gsc, reistijd_fil)
Opleiding <- c(namenlijst_atc, namenlijst_gsc, namenlijst_fil)

Opleiding <- Opleiding[order(Reistijd)]
Reistijd <- sort(Reistijd)

Reistijd_per_opleiding <- data.frame(Reistijd, Opleiding)
colnames(Reistijd_per_opleiding) <- c("Reistijd", "Opleiding")


Reistijd_per_opleiding <- Reistijd_per_opleiding %>%
  mutate(Reistijd = if_else(Reistijd < 0, Reistijd*-1, Reistijd))
```

# Toepassing
Gebruik de *one-way ANOVA* bij het toetsen of het gemiddelde van drie of meer onafhankelijke groepen aan elkaar gelijk zijn. [^1] 

# Onderwijscasus
In verband met wervingsactiviteiten wil het hoofd van de afdeling Communicatie weten wat de reistijd is van studenten aan verschillende opleidingen. Hij heeft daarom data verzameld over de reistijd van uitwonende studenten voor de opleidingen: arabische taal en cultuur, filosofie en geschiedenis. 

H~0~: De gemiddelde reistijd van de studenten is per opleiding gelijk aan elkaar: µ~0~ = µ~1~ = µ~2~ ... µ~n~  

H~A~: Tenminste voor één opleiding is de gemiddelde reistijd niet gelijk aan de gemiddelde reistijd van studenten voor andere opleidingen. µ~0~ ≠ µ~1~ = µ~2~ ... = µ~n~

# Assumpties
Een assumptie is een aanname. De data moet aan een aantal assumpties voldoen voordat de toets uitgevoerd kan worden. 
Controleer of de steekproef aan de volgende assumpties voldoet: normaliteit, homogeniteit van varianties en onafhankelijkheid.  

De *one -way ANOVA* is een robuuste test. Dit betekent dat als één groep uit de steekproef niet voldoet aan de assumptie van normaliteit of homogeniteit van varianties kan de *one -way ANOVA* nog steeds uitgevoerd en geïnterpreteerd worden. [^2]   

## Normaliteit
De *one -way ANOVA* gaat ervan uit dat de data normaal verdeeld is. Controleer de assumptie van normaliteit met de volgende stappen:  
1. Controleer de data visueel met een histogram, een Q-Q plot of een boxplot. 
2. Toets of de data normaal verdeeld is met de *Kolmogorov-Smirnov test* of bij een kleinere steekproef (n < 50[^3]) met de *Shapiro-Wilk test*.[^4]
3. Als blijkt dat de data niet normaal verdeeld is, transformeer de data eventueel en bepaal daarna of deze wel normaal verdeeld is.

Als er geen sprake is van normaliteit, gebruik de *Kruskal-Wallis test*.[^5]

## Homogeniteit van Varianties
Controleer of de spreiding van iedere groep ongeveer hetzelfde is, dit kan getoetst worden met de *Levene's Test (for equality of variance)*. Bij een *p* < 0,05 is de spreiding van de groepen verschillend en wordt de assumptie geschonden.[^6]

## Onafhankelijkheid
Beredeneer of een van de groepen een overlap heeft met één van de andere groepen. Beredeneer of de groepen elkaars deelname kunnen beïnvloeden. Als er een overlap is, dan zijn de groepen afhankelijk en kan de *one-way ANOVA* niet uitgevoerd worden. 

# Post-hoc vergelijking 
De *one-way ANOVA* toetst of één of meerdere van de gemiddelden anders is dan de andere gemiddelden. Welke groep anders is wordt niet gespecificeerd. Als er bij de *one-way ANOVA* uitkomt dat er een significant verschil is tussen de groepen kan een post-hoc vergelijking gedaan worden om te bepalen welke groepen significant verschillen.  

Er zijn meerdere post-hoc vergelijkingen: 

* Gebruik *Tukey* bij gelijke varianties 
* Gebruik Dunnet's *C* bij ongelijke varianties  

# Uitvoering in R
Er is een dataset ingeladen met de reistijden van uitwonende studenten per opleiding is ingeladen genaamd `Reistijd_per_opleiding`. 

## De data bekijken
Gebruik `head()` om de data te bekijken.
```{r de data bekijken}
head(Reistijd_per_opleiding)
```

Gebruik `levels()` om te onderzoeken welke opleidingen er in de data aanwezig zijn. 
```{r de data visualiseren}
levels(Reistijd_per_opleiding$Opleiding)
```

Sla voor `mean()`, `sd()`, `boxplot()` en voor `lillie.test()` de verschillende groepen op in een vector.

```{r subset}
Reistijd_atc <- Reistijd_per_opleiding$Reistijd[Reistijd_per_opleiding$Opleiding == "Arabische Taal en Cultuur"]
Reistijd_fil <- Reistijd_per_opleiding$Reistijd[Reistijd_per_opleiding$Opleiding == "Filosofie"]
Reistijd_gsc <- Reistijd_per_opleiding$Reistijd[Reistijd_per_opleiding$Opleiding == "Geschiedenis"]
```

Om meer inzicht te krijgen in de data, inspecteer de data met `mean()`en `sd()`. 

<div class ="col3">

```{r descriptives atc, collapse=TRUE}
mean(Reistijd_atc)
sd(Reistijd_atc)
```
```{r descriptives fil, collapse=TRUE}
mean(Reistijd_fil)
sd(Reistijd_fil)
```
```{r descriptives gsc, collapse=TRUE}
mean(Reistijd_gsc)
sd(Reistijd_gsc)
```
</div>
* Gemiddelde reistijd arabische taal en cultuur (standaarddeviatie): 17,45(10,05)  
* Gemiddelde reistijd filosofie (standaarddeviatie): 33,77(10,96)  
* Gemiddelde reistijd geschiedenis (standaarddeviatie): 36,53(12,09)  

## Test assumpties: normaliteit 
### Histogram
Controleer de data visueel met een histogram. 
```{r lib ggplot2}
library(ggplot2)
```
```{r histogram atc}
ggplot(Reistijd_per_opleiding,
  aes(x = Reistijd)) +
  geom_histogram(aes(y = ..density..),
                 binwidth = 5,
                 color = "grey30",
                 fill = "#0089CF") +
  facet_wrap(~ Opleiding) +
  geom_density(alpha = .2, adjust = 1) +
  ylab("Frequentiedichtheid") +
  labs(title = "Reistijd")
```
Alle drie de histogrammen laten een belcurve zien vergelijkbaar aan een normale verdeling, veel waardes liggen rondom het gemiddelde.  


### Q-Q plot
Controleer de data visueel met een Q-Q plot. Gebruik `qqnorm()` en `qqline()` met `pch = 1` om een Q-Q plot te maken met kleine cirkels. Als over het algemeen de meeste datapunten op de lijn liggen, kan aangenomen worden dat de data normaal verdeeld is.

<div class ="col3">
```{r qqplot atc}
qqnorm(Reistijd_atc, pch = 1)
qqline(Reistijd_atc)
```
```{r qqplot fil}
qqnorm(Reistijd_fil, pch = 1)
qqline(Reistijd_fil)
```
```{r qqplot gsc}
qqnorm(Reistijd_gsc, pch = 1)
qqline(Reistijd_gsc)
```
</div>
Bij de Q-Q plot van de reistijd van studenten geschiedenis liggen de meeste punten op de lijn behalve bij de uiteinden. De cirkels van de Q-Q plot van studenten arabische taal en cultuur en studenten filosofie liggen net naast de getrokken lijn, maar zo minimaal ernaast dat de data vermoedelijk normaal verdeeld is.   

### Boxplot
Controleer de data visueel met een boxplot.
```{r boxplot}
library(graphics)
boxplot(Reistijd ~ Opleiding, Reistijd_per_opleiding)
```
De boxplotten geven de spreiding van het gemiddelde tentamencijfer per periode weer voor de Lerarenopleiding. De box geeft de middelste 50% van de tentamencijfers weer. De zwarte lijn binnen de box is de mediaan. In de staarten zitten de eerste 25% en de laatste 25%. De cirkels zijn de uitbijters.  

### Kolmogorov-Smirnov (met Lilliefors correctie) 
De *Kolmogorov-Smirnov test* toetst het verschil in vorm tussen de twee verdelingen. In dit geval toetst deze test het verschil tussen een normale verdeling en de verdeling van de steekproef. De Lilliefors correctie is een correctie die wordt gebruikt als het gemiddelde niet 0 is en de standaardafwijking niet 1 is. Als de p-waarde groter is dan 0,05 is de verdeling van de data niet significant verschillend van een normale verdeling.


```{r lillietest, collapse=TRUE}
library("nortest")
lillie.test(Reistijd_atc)
lillie.test(Reistijd_fil)
lillie.test(Reistijd_gsc)
```
Bij deze casus zijn van alle groepen de p-waarde > 0,05; er is geen significant verschil gevonden tussen de verdeling van de steekproef en de normale verdeling. Er wordt aan de assumptie van normaliteit voldaan, dus de *one-way ANOVA* kan uitgevoerd worden.


## Test assumpties: Levene's test
Test met de Levene's test de homogeniteit van varianties. Als uit de *Levene's test* komt dat de steekproeven verschillen in variantie kan de *ongepaarde t-toets* met ongelijke varianties uitgevoerd worden. 

```{r LeveneTest, warning = FALSE, message = FALSE}
library(car)
leveneTest(Reistijd_per_opleiding$Reistijd, Reistijd_per_opleiding$Opleiding)
```
*F*(2, 254) = 1,66, p-waarde = 0,19, de groepen zijn niet verschillend in variantie.  
Vrijheidsgraden bestaat nu uit twee cijfers, het eerste cijfer (het aantal groepen - 1 = 1) en de tweede cijfer (*n~1~* + *n~2~* - 2 = 254) 

## One way ANOVA 
Gebruik `aov()` voor een ANOVA. Geef het resultat overzichtelijk weer met `summary()`. 
```{r ANOVA}
res.aov <- aov(Reistijd ~ Opleiding, Reistijd_per_opleiding)
summary(res.aov)
```

## Tukey's toets
Gebruik de `TukeyHSD()` om een Tukey-test te doen om te kijken welke verschillen significant zijn.

```{r TukeyHSD}
TukeyHSD(res.aov)
```

# Rapportage
Een *one-way ANOVA* is uitgevoerd om te toetsen of de gemiddelde reistijd van de studenten is per opleiding gelijk aan elkaar is. De onafhankelijke variabele, opleiding, is onderverdeeld in drie niveau's **(Opleiding 1, 2, 3 )** en de afhankelijke variabele is de reistijd van de studenten. The *one way ANOVA* was significant **F(1, 338) = 0,92, p-waarde = 0,034** 
**effect **
**posthoc en uitkomsten **


[^1]: van Geloven, N. (25 mei 2016). *One-way ANOVA*. https://wikistatistiek.amc.nl/index.php/One-way_ANOVA
[^2]: Universiteit van Amsterdam (8 juli 2014). *One-way ANOVA*. https://wiki.uva.nl/methodologiewinkel/index.php/One-way_ANOVAA 
[^3]: Laerd statistics (2018). *Testing for Normality using SPSS Statistics*. https://statistics.laerd.com/spss-tutorials/testing-for-normality-using-spss-statistics.php  
[^4]: Universiteit van Amsterdam (14 juli 2014). *Normaliteit*. https://wiki.uva.nl/methodologiewinkel/index.php/Normaliteit  
[^5]: van Geloven, N. (21 maart 2018). *Kruskal Wallis* https://wikistatistiek.amc.nl/index.php/Kruskal_Wallis
[^6]: Wikipedia (7 september 2019). *Analysis of variance*. https://en.wikipedia.org/wiki/Analysis_of_variance 
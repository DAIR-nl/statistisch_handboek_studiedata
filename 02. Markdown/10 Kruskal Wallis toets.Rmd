---
title: "Kruskal Wallis toets"
author: "© 2019, SURF Versnellingsagenda Statistisch Handboek Hoger Onderwijs"
date: "`r format(Sys.time(), '%d-%m-%y')`"
output: 
  html_document:
    toc: TRUE
    toc_float:
      collapsed: FALSE
    number_sections: TRUE
    theme: united
---


<style>
`r htmltools::includeHTML(paste0(here::here(),"/03. Includes/css/Stylesheet SHHO.css"))`
</style>

```{r header, include = FALSE, echo = TRUE, results='asis'} 
paste0(here::here(),"/03. Includes/code/Header.R")
```

<!-- ## BLOK: Functiedefinities.R -->
```{r functiedefinities,include=FALSE, echo=TRUE}
library(stringr)
Round_and_format <- function(x, digits = 2) {
  x <- as.character(round(x, digits))
  x <- str_replace(x, "[.]", ",")
  return(x)
}
```
<!-- ## /BLOK: Functiedefinities.R -->

<!-- ## BLOK: Data-aanmaken.R -->
```{r aanmaken data, include=FALSE, echo=TRUE}
## H0 en H1 medianen of gemiddelden, ook in toepassing 
## is het wel interessant om gemiddelden te tonen? 
## link naar Mann W-U test 
## pilot: - Groepsgrootte, onafhankelijkheid, en numerieke data - meer informatie goed of juist teveel?


RNGkind(sample.kind = "Rounding")
set.seed(8)
# 3
## 300 waarnemingen voor Vooropleiding
Seed <- sample(c(1, 2, 3, 4), 300, replace = TRUE)
Vooropleiding <-  ifelse(Seed == 1, "Rechtsgeleerdheid", 
                  ifelse(Seed == 2, "Notarieel recht",
                  ifelse(Seed == 3, "Fiscaal recht",
                  ifelse(Seed == 4, "Schakelprogramma",
                                 NA))))

## 300 waarnemingen voor puntenaantallen, random gesampled uit een lijst mogelijkheden
Punten_mogelijkheden <- c(6, 12, 18, 24, 30, 36, 36, 42, 42, 42, 48, 48, 48, 48, 54, 54, 54, 60, 60, 60, 60, 60, 60)
Ec_jaar1 <- sample(Punten_mogelijkheden, 300, replace = TRUE)

Studentnr <- sample(3000000:4000000, 300)
Resultaten_arbeidsrecht <- data.frame(Studentnr, Vooropleiding, Ec_jaar1)

## puntencorrectie om Fiscaal en Notarieel +6 punten te geven en Rechtsgeleerdheid -6 punten
Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Fiscaal recht" | Vooropleiding == "Notarieel recht"] <-
  Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Fiscaal recht" | Vooropleiding == "Notarieel recht"] + 6
Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Rechtsgeleerdheid"] <-
  Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Rechtsgeleerdheid"] - 6
```
<!-- ## /BLOK: Data-aanmaken.R -->

# Toepassing
Gebruik de *Kruskal Wallis toets* om te toetsen of de medianen van meerdere groepen significant verschillen. Een kenmerk van de data is dat deze numeriek en ongepaard is.  

De *Kruskal Wallis* ordent de scores van laag naar hoog en ze geeft de scores een rangnummer. Op deze wijze zijn outliers en de assumptie van normaliteit geen probleem meer.[^1] Gebruikt de *Kruskal Wallis* in plaats van de *one way ANOVA* als de assumpties van normaliteit en/of van Homogeniteit van Varianties worden geschonden.[^2]  

# Onderwijscasus
De opleidingsdirecteur van de tweejarige Masteropleiding Arbeidsrecht is geïnteresseerd in de afstudeersnelheid van zijn studenten. Hij vraagt zich af of het type vooropleiding bepalend is voor hoeveel vakken de studenten afronden in het eerste jaar. Hij kijkt naar de vier meest gangbare vooropleidingen die de studenten doorlopen voordat ze met de Master Arbeidsrecht beginnen; de bachelors: Fiscaal recht, Notarieel recht, Rechtsgeleerdheid en een Schakelprogramma.  

H~0~: De vooropleiding is niet bepalend voor het aantal vakken die de Masterstudenten Arbeidsrecht behalen in het eerste jaar. De gemiddelde rank is per groep ongeveer gelijk aan elkaar. 

H~1~: De vooropleiding is bepalend voor het aantal vakken die de Masterstudenten Arbeidsrecht behalen in het eerste jaar. De gemiddelde rank is per groep ongeveer gelijk aan elkaar. 

# Assumpties
Controleer of de data aan de volgende assumpties voldoen: numerieke data, onafhankelijkheid en het aantal groepen is > 2. 

## Numerieke data
Gebruik de *Kruskal Wallis toets* bij (semi-)continue data. Semi-continue data is als de data gehele getallen bevat met veel verschillende waardes[^3]. Een voorbeeld hiervan is de aanwezigheid van studenten tijdens de jaaropening. 

## Onafhankelijkheid 
Elke groep heeft geen overlap met één van de andere groepen en de groepen kunnen elkaars deelname niet beïnvloeden. Deze stap wordt beredeneerd en wordt niet getoetst.  

## Aantal groepen
Het aantal groepen is > 2. Gebruik bij 2 groepen de *Mann-Whitney U toets*.

# Post-hoc toets 
De *Kruskal Wallis Toets* toetst of één of meerdere groepen verschillen. Welke groep verschilt wordt niet gespecificeerd. Als er een verschil zit tussen de groepen kan de *Mann-Whitney U toets* als post-hoc vergelijking gedaan worden, om te bepalen welke groepen significant verschillen. 

Gebruik de *Bonferroni correctie* om Type I fouten te voorkomen. Deze toets past de p-waarde aan door de waarde te vermenigvuldigen met het aantal uitgevoerde toetsen [^4].

# Uitvoering in R
Er is een dataset ingeladen met studieresultaten van de master arbeidsrecht per vooropleiding: Fiscaal recht, Notarieel recht, Rechtsgeleerdheid en een Schakelprogramma.

## De data bekijken
<!-- ## BLOK: Data-bekijken.R -->
```{r data bekijken, collapse = TRUE}
## Eerste 5 observaties
head(Resultaten_arbeidsrecht)

## Laatste 5 observaties
tail(Resultaten_arbeidsrecht)
```
<!-- ## /BLOK: Data-bekijken.R -->

De data bevat data van studenten van verschillende vooropleidingen. Gebruik `levels()` om te onderzoeken welke opleidingen er in de data aanwezig zijn. 

<!-- ## BLOK: Data-bekijken-2.R -->
```{r data bekijken 2}
## Opleidingen in de data aanwezig
levels(Resultaten_arbeidsrecht$Vooropleiding)
```
<!-- ## /BLOK: Data-bekijken-2.R -->

Om meer inzicht te krijgen in de data, inspecteer de groepen met `n()`, `mean()` en `median()`. Groepeer hiervoor eerst met `group_by()`.

<!-- ## BLOK: Data-beschrijven.R -->
``` {r data beschrijven, warning=FALSE, message=FALSE}
## Aantallen, gemiddelde en mediaan
library(dplyr)
group_by(Resultaten_arbeidsrecht, Vooropleiding) %>%
  summarise(
    count = n(),
    mean = mean(Ec_jaar1),
    median = median(Ec_jaar1)
  )
```
<!-- ## /BLOK: Data-beschrijven.R -->

``` {r data beschrijven als object, include=FALSE, echo=TRUE}
library(dplyr)
x <- group_by(Resultaten_arbeidsrecht, Vooropleiding) %>%
  summarise(
    count = n(),
    mean = mean(Ec_jaar1),
    median = median(Ec_jaar1)
  )

vN_FIS <- Round_and_format(x[1,2])
vN_NOT <- Round_and_format(x[2,2])
vN_RCH <- Round_and_format(x[3,2])
vN_SCH <- Round_and_format(x[4,2])

vMean_FIS <- Round_and_format(x[1,3])
vMean_NOT <- Round_and_format(x[2,3])
vMean_RCH <- Round_and_format(x[3,3])
vMean_SCH <- Round_and_format(x[4,3])

vMed_FIS <- Round_and_format(x[1,4])
vMed_NOT <- Round_and_format(x[2,4])
vMed_RCH <- Round_and_format(x[3,4])
vMed_SCH <- Round_and_format(x[4,4])
```
* Gemiddeld behaald aantal punten Fiscaal Recht: `r vMean_FIS`. n = `r vN_FIS`.
* Gemiddeld behaald aantal punten Notarieel Recht: `r vMean_NOT`. n = `r vN_NOT`.
* Gemiddeld behaald aantal punten Rechtsgeleerdheid: `r vMean_RCH`. n = `r vN_RCH`.
* Gemiddeld behaald aantal punten Schakelprogramma: `r vMean_SCH`. n = `r vN_SCH`.

## Kruskal Wallis toets
Gebruik `kruskal.test()`. In het eerste argument gebruik je de afhankelijke variabele en de variabele die de groep definiëert. Het tweede argument is het dataframe. 
<!-- ## BLOK: Kruskal-Wallis-test -->
```{r Kruskal Wallis test}
kruskal.test(Ec_jaar1 ~ Vooropleiding, Resultaten_arbeidsrecht)
```
<!-- ## /BLOK: Kruskal-Wallis-test -->
```{r Kruskal Wallis test als object, include= FALSE, echo= TRUE}
Ktest <- kruskal.test(Ec_jaar1 ~ Vooropleiding, Resultaten_arbeidsrecht)
vK_DF <- Round_and_format(Ktest$parameter)
vK_Chi2 <- Round_and_format(Ktest$statistic)
vK_P <- Round_and_format(Ktest$p.value)
```
df: het aantal groepen - 1 = `r vK_DF`
chi-squared: `r vK_Chi2`
p-waarde (`r vK_P`) < 0,05 , dus de H~0~ wordt verworpen en de H~A~ aangenomen  


# Post-hoc toets: Mann-Whitney U toets
Om te weten welke groepen verschillen is er in `pairwise.wilcox.test()` de *Bonferroni correctie* beschikbaar voor *multiple testing*
<!-- ## BLOK: Mann-Whitney-U-test-->
``` {r pairwise wilcox test}
pairwise.wilcox.test(Resultaten_arbeidsrecht$Ec_jaar1, Resultaten_arbeidsrecht$Vooropleiding, p.adjust.method = "bonferroni")
```
<!-- ## /BLOK: Mann-Whitney-U-test-->
# Rapportage
Om te toetsen of ........... is de *chi-kwadraat toets* uitgevoerd. De resultaten ondersteunen de conclusie dat ..................., χ^2^ (df) ≈ `r vK_Chi2` (`r vK_DF`), `r vK_P` < 0,01.

[^1]: Universiteit van Amsterdam (7 juli 2014). *Kruskal-Wallis Test* https://wiki.uva.nl/methodologiewinkel/index.php/Kruskal-Wallis_Test 
[^2]: van Geloven, N. (21 maart 2018). *Kruskal Wallis* https://wikistatistiek.amc.nl/index.php/Kruskal_Wallis 
[^3]: van Geloven, N. (21 November 2017).*KEUZE TOETS* https://wikistatistiek.amc.nl/index.php/KEUZE_TOETS
[^4]: Universiteit van Amsterdam (7 juli 2014). *Kruskal-Wallis Test* https://wiki.uva.nl/methodologiewinkel/index.php/Kruskal-Wallis_Test
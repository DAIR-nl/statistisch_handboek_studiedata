---
title: "Kruskal Wallis toets"
author: "Â© 2019, SURF Versnellingsagenda Statistisch Handboek Hoger Onderwijs"
date: "`r format(Sys.time(), '%d-%m-%y')`"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    number_sections: TRUE
    theme: united
---

``` {r versiegeschiedenis, include = FALSE, eval = FALSE}
## versie 0.1     3-9-19
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r aanmaken data, include=FALSE, echo=TRUE}
## De opleidingsdirecteur van de tweejarige Masteropleiding Arbeidsrecht vraagt zich af of de vooropleiding van zijn studenten te maken heeft met hoe snel zij afstuderen.  Zij bekijkt daarom het aantal punten behaald in het eerste jaar naar vooropleiding. Zij vraagt zich af: Welke vooropleidng levert de studenten die het meeste punten halen?

RNGkind(sample.kind = "Rounding")
set.seed(8)
# 3
## 300 waarnemingen voor Vooropleiding
Seed <- sample(c(1, 2, 3, 4), 300, replace = TRUE)
Vooropleiding <-  ifelse(Seed == 1, "Rechtsgeleerdheid", 
                  ifelse(Seed == 2, "Notarieel recht",
                  ifelse(Seed == 3, "Fiscaal recht",
                  ifelse(Seed == 4, "Schakelprogramma",
                                 NA))))

## 300 waarnemingen voor puntenaantallen, random gesampled uit een lijst mogelijkheden
Punten_mogelijkheden <- c(6, 12, 18, 24, 30, 36, 36, 42, 42, 42, 48, 48, 48, 48, 54, 54, 54, 60, 60, 60, 60, 60, 60)
Ec_jaar1 <- sample(Punten_mogelijkheden, 300, replace = TRUE)

Studentnr <- sample(3000000:4000000, 300)
Resultaten_arbeidsrecht <- data.frame(Studentnr, Vooropleiding, Ec_jaar1)

## puntencorrectie om fiscaal en notarieel +6 punten te geven en rechtsgeleerdheid -6 punten
Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Fiscaal recht" | Vooropleiding == "Notarieel recht"] <-
  Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Fiscaal recht" | Vooropleiding == "Notarieel recht"] + 6
Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Rechtsgeleerdheid"] <-
  Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Rechtsgeleerdheid"] - 6
```

# Toepassing
De *Kruskal Wallis toets* wordt gebruikt om te toetsen of de medianen van meerdere groepen significant verschillen. Een kenmerk van de data is dat deze numeriek en ongepaard is.  
Deze toets wordt ook vaak gebruikt in plaats van de *one way ANOVA*; Wanneer de assumpties van normaliteit en/of van Homogeniteit van Varianties worden geschonden.  

# Onderwijscasus
De opleidingsdirecteur van de tweejarige Masteropleiding Arbeidsrecht vraagt zich af of het type vooropleiding bepalend is voor hoeveel vakken de studenten afronden in het eerste jaar. 

###### De opleidingsdirecteur van de tweejarige Masteropleiding Arbeidsrecht vraagt zich af of de vooropleiding van zijn studenten te maken heeft met hoe snel zij afstuderen.  Zij bekijkt daarom het aantal punten behaald in het eerste jaar naar vooropleiding. Zij vraagt zich af: Welke vooropleidng levert de studenten die het meeste punten halen?

# Assumpties
- data continu (andy field 654 note 3)




# Uitvoering in R
Er is data ingeladen met studieresultaten van de Master arbeidsrecht per vooropleiding.

## De data bekijken
```{r de data exploreren, collapse=TRUE}
head(Resultaten_arbeidsrecht)
levels(Resultaten_arbeidsrecht$Vooropleiding)
```
Er is te zien dat er vier groepen naar vooropleiding in de data te vinden zijn: Fiscaal recht, Notarieel recht, Rechtsgeleerdheid en een schakelprogramma. Voor elke student (een rij) is er te zien hoeveel studiepunten er zijn gehaald in het eerste jaar. `mean()` kan het gemiddelde aantal punten per vooropleiding geven.

### 
## in base R
``` {r gemiddeldes per vooropleiding base, collapse=TRUE}
mean(Resultaten_arbeidsrecht$Ec_jaar1 [Vooropleiding=="Rechtsgeleerdheid"])
mean(Resultaten_arbeidsrecht$Ec_jaar1 [Vooropleiding=="Notarieel recht"])
mean(Resultaten_arbeidsrecht$Ec_jaar1 [Vooropleiding=="Fiscaal recht"])
mean(Resultaten_arbeidsrecht$Ec_jaar1 [Vooropleiding=="Schakelprogramma"])
```

## in package 'dplyr'
``` {r gemiddeldes per vooropleiding dplyr, warning=FALSE, message=FALSE}
library(dplyr)
group_by(Resultaten_arbeidsrecht, Vooropleiding) %>%
  summarise(
    count = n(),
    mean = mean(Ec_jaar1),
    median = median(Ec_jaar1)
  )
```

## Kruskal Wallis toets

```{r kruskal test}
kruskal.test(Ec_jaar1 ~ Vooropleiding, Resultaten_arbeidsrecht)
```

Om te weten welke groepen verschillen is er in `pairwise.wilcox.test()` een correctie beschikbaar voor *multiple testing*
``` {r pairwise wilcox test}
pairwise.wilcox.test(Resultaten_arbeidsrecht$Ec_jaar1, Resultaten_arbeidsrecht$Vooropleiding, p.adjust.method = "bonferroni")
```
# Toelichting op de output

# Rapportage

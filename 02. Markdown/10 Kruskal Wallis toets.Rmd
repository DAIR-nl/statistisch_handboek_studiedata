---
title: "Kruskal Wallis toets"
author: "© 2019, SURF Versnellingsagenda Statistisch Handboek Hoger Onderwijs"
date: "`r format(Sys.time(), '%d-%m-%y')`"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    number_sections: TRUE
    theme: united
---

``` {r versiegeschiedenis, include = FALSE, eval = FALSE}
## versie 0.1     3-9-19
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r aanmaken data, include=FALSE, echo=TRUE}
## De opleidingsdirecteur van de tweejarige Masteropleiding Arbeidsrecht vraagt zich af of de vooropleiding van zijn studenten te maken heeft met hoe snel zij afstuderen. Zij bekijkt daarom het aantal punten behaald in het eerste jaar naar vooropleiding. Zij vraagt zich af: Welke vooropleidng levert de studenten die het meeste punten halen?

## H0 en H1 medianen of gemiddelden, ook in toepassing 
## is het wel interessant om gemiddelden te tonen? 

## link naar Mann W-U test 

RNGkind(sample.kind = "Rounding")
set.seed(8)
# 3
## 300 waarnemingen voor Vooropleiding
Seed <- sample(c(1, 2, 3, 4), 300, replace = TRUE)
Vooropleiding <-  ifelse(Seed == 1, "Rechtsgeleerdheid", 
                  ifelse(Seed == 2, "Notarieel recht",
                  ifelse(Seed == 3, "Fiscaal recht",
                  ifelse(Seed == 4, "Schakelprogramma",
                                 NA))))

## 300 waarnemingen voor puntenaantallen, random gesampled uit een lijst mogelijkheden
Punten_mogelijkheden <- c(6, 12, 18, 24, 30, 36, 36, 42, 42, 42, 48, 48, 48, 48, 54, 54, 54, 60, 60, 60, 60, 60, 60)
Ec_jaar1 <- sample(Punten_mogelijkheden, 300, replace = TRUE)

Studentnr <- sample(3000000:4000000, 300)
Resultaten_arbeidsrecht <- data.frame(Studentnr, Vooropleiding, Ec_jaar1)

## puntencorrectie om fiscaal en notarieel +6 punten te geven en rechtsgeleerdheid -6 punten
Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Fiscaal recht" | Vooropleiding == "Notarieel recht"] <-
  Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Fiscaal recht" | Vooropleiding == "Notarieel recht"] + 6
Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Rechtsgeleerdheid"] <-
  Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Rechtsgeleerdheid"] - 6
```

# Toepassing
De *Kruskal Wallis toets* wordt gebruikt om te toetsen of de medianen van meerdere groepen significant verschillen. Een kenmerk van de data is dat deze numeriek en ongepaard is.  

Een belangrijke realisatie bij de *Kruskal Wallis toets* is dat de toets de scores van laag naar hoog ordend en ze een rangnummer geeft. Op deze wijze zijn outliers en de assumptie normaliteit geen probleem meer [^1]. Vandaar dat deze toets in plaats van de de *one way ANOVA* gebruikt wordt wanneer de assumpties van normaliteit en/of van Homogeniteit van Varianties worden geschonden [^2].  

# Onderwijscasus
De opleidingsdirecteur van de tweejarige Masteropleiding Arbeidsrecht buigt zich over het vraagstuk van de afstudeersnelheid van de studenten. Hierbij vraagt hij zich af of het type vooropleiding bepalend is voor hoeveel vakken de studenten afronden in het eerste jaar. Hij kijkt naar de vier meest gangbare vooropleidingen die de studenten doorlopen voordat ze met de Master Arbeidsrecht beginnen; de Bachelors Fiscaal recht, Notarieel recht, Rechtsgeleerdheid en een schakelprogramma.  

H~0~: De vooropleiding is niet bepalend voor het aantal vakken die de Masterstudenten Arbeidsrecht behalen in het eerste jaar. De gemiddelde rank is per groep ongeveer gelijk aan elkaar. 

H~1~: De vooropleiding is bepalend voor het aantal vakken die de Masterstudenten Arbeidsrecht behalen in het eerste jaar. De gemiddelde rank is per groep ongeveer gelijk aan elkaar. 

# Assumpties
Controleer of de data aan de volgende assumpties voldoen: numerieke data, onafhankelijkheid en het aantal groepen is > 2. 

## Numerieke data
Gebruik de *Kruskal Wallis toets* bij (semi-)continue data. Semi-continue data is als de data gehele getallen bevat met veel verschillende waardes[^3]. Een voorbeeld hiervan is de aanwezigheid van studenten tijdens de jaaropening. 

## Onafhankelijkheid 
Elke groep heeft geen overlap met één van de andere groepen en de groepen kunnen elkaars deelname niet beïnvloeden. Deze stap wordt beredeneerd en wordt niet getoetst.  

## aantal groepen
Het aantal groepen is > 2. Bij 2 groepen gebruik de *Mann-Whitney U toets*

# Post-hoc toets 
De *Kruskal Wallis Toets* toetst of één of meerdere groepen verschillen. Welke groep verschilt wordt niet gespecificeerd. Als er een verschil zit tussen de groepen kan de *Mann-Whitney U toets* als post-hoc vergelijking gedaan worden, om te bepalen welke groepen significant verschillen. 

Gebruik de *Bonferroni correctie* om Type I fouten te voorkomen. Pas de p-waarde aan door alpha te delen door het aantal uitgevoerde toetsen [^4].

# Uitvoering in R
Er is data ingeladen met studieresultaten van de Master arbeidsrecht per vooropleiding: Fiscaal recht, Notarieel recht, Rechtsgeleerdheid en een schakelprogramma.

## De data bekijken
```{r de data exploreren, collapse=TRUE}
head(Resultaten_arbeidsrecht)
levels(Resultaten_arbeidsrecht$Vooropleiding)
```
Voor elke student (een rij) is er te zien hoeveel studiepunten er zijn gehaald in het eerste jaar en welke vooropleiding de student afgerond heeft.  
`mean()` geeft het gemiddelde aantal punten per vooropleiding.

## in base R
``` {r gemiddeldes per vooropleiding base, collapse=TRUE}
mean(Resultaten_arbeidsrecht$Ec_jaar1 [Vooropleiding=="Rechtsgeleerdheid"])
mean(Resultaten_arbeidsrecht$Ec_jaar1 [Vooropleiding=="Notarieel recht"])
mean(Resultaten_arbeidsrecht$Ec_jaar1 [Vooropleiding=="Fiscaal recht"])
mean(Resultaten_arbeidsrecht$Ec_jaar1 [Vooropleiding=="Schakelprogramma"])
```

## in package 'dplyr'
``` {r gemiddeldes per vooropleiding dplyr, warning=FALSE, message=FALSE}
library(dplyr)
group_by(Resultaten_arbeidsrecht, Vooropleiding) %>%
  summarise(
    count = n(),
    mean = mean(Ec_jaar1),
    median = median(Ec_jaar1)
  )
```

## Kruskal Wallis toets

```{r kruskal test}
kruskal.test(Ec_jaar1 ~ Vooropleiding, Resultaten_arbeidsrecht)
```
df: het aantal groepen - 1
p-waarde < 0,05 , dus de H~0~ wordt verworpen en de H~A~ aangenomen 
chi-squared: 33,07 

# Post-hoc toets: Mann-Whitney U toets
Om te weten welke groepen verschillen is er in `pairwise.wilcox.test()` een correctie beschikbaar voor *multiple testing*
``` {r pairwise wilcox test}
pairwise.wilcox.test(Resultaten_arbeidsrecht$Ec_jaar1, Resultaten_arbeidsrecht$Vooropleiding, p.adjust.method = "bonferroni")
```
# Rapportage
Om te toetsen of ........... is de *chi-kwadraat toets* uitgevoerd. De resultaten ondersteunen de conclusie dat ..................., χ^2^ (3) ≈ 33,07, *p* < 0,01.

[^1]: Universiteit van Amsterdam (7 juli 2014). *Kruskal-Wallis Test* https://wiki.uva.nl/methodologiewinkel/index.php/Kruskal-Wallis_Test 
[^2]: van Geloven, N. (21 maart 2018). *Kruskal Wallis* https://wikistatistiek.amc.nl/index.php/Kruskal_Wallis 
[^3]: van Geloven, N. (21 November 2017).*KEUZE TOETS* https://wikistatistiek.amc.nl/index.php/KEUZE_TOETS
[^4]: Universiteit van Amsterdam (7 juli 2014). *Kruskal-Wallis Test* https://wiki.uva.nl/methodologiewinkel/index.php/Kruskal-Wallis_Test
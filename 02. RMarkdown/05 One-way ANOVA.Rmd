---
title: "One-way ANOVA"
author: "© 2019, SURF Versnellingsagenda - Statistisch Handboek Hoger Onderwijs"
date: "`r format(Sys.time(), '%d-%m-%Y')`"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: 
      collapsed: FALSE 
    number_sections: true
  keywords: [statistisch handboek, studiedata]
---

<style>
`r htmltools::includeHTML(paste0(here::here(),"/03. Includes/css/Stylesheet SHHO.css"))`
</style>

```{r header, include = FALSE, echo = TRUE, results='asis'} 
paste0(here::here(),"/03. Includes/code/Header.R")
```

<!-- ## BLOK: Functiedefinities.R -->
```{r functiedefinities,include=FALSE, echo=TRUE}
library(stringr)
Round_and_format <- function(x, digits = 2) {
  x <- as.character(round(x, digits))
  x <- str_replace(x, "[.]", ",")
  return(x)
}
```
<!-- ## /BLOK: Functiedefinities.R -->

```{r set-options, echo=FALSE, cache=FALSE}
options(width = 80)
## Zodat de TukeyHSD naast elkaar geprint wordt
```

<!-- ## BLOK: Data-aanmaken.R -->
```{r aanmaken data, include=FALSE, echo=TRUE}
## Het hoofd communicatie wil in verband met wervingsactiviteiten weten wat de reistijd is van studenten aan verschillende opleidingen.

## Doel: tidy data met een kolom reistijd (value) en een kolom opleiding (factor)
library(dplyr)
RNGkind(sample.kind = "Rounding")
set.seed(3)

Studiegrootte <- 29
reistijd_gem <- 35
sd_gem <- 12
Reistijd_FIL <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_fil <- replicate(2.1*Studiegrootte, "Filosofie")

Studiegrootte <- 23
reistijd_gem <- 45
sd_gem <- 13
Reistijd_ATC <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_atc <- replicate(2.1*Studiegrootte, "Arabische Taal en Cultuur")

Studiegrootte <- 71
reistijd_gem <- 36
sd_gem <- 11
Reistijd_GSC <- round(rnorm(2.1*Studiegrootte, reistijd_gem, sd_gem), 2)
namenlijst_gsc <- replicate(2.1*Studiegrootte, "Geschiedenis")

Reistijd <- c(Reistijd_ATC, Reistijd_GSC, Reistijd_FIL)
Opleiding <- c(namenlijst_atc, namenlijst_gsc, namenlijst_fil)

Opleiding <- Opleiding[order(Reistijd)]
Reistijd <- sort(Reistijd)

Reistijd_per_opleiding <- data.frame(Reistijd, Opleiding)
colnames(Reistijd_per_opleiding) <- c("Reistijd", "Opleiding")


Reistijd_per_opleiding <- Reistijd_per_opleiding %>%
  mutate(Reistijd = if_else(Reistijd < 0, Reistijd*-1, Reistijd))
```
<!-- ## /BLOK: Data-aanmaken.R -->
# Toepassing
Gebruik de *one-way ANOVA* bij het toetsen of het gemiddelde van drie of meer onafhankelijke groepen aan elkaar gelijk zijn.[^1] 

# Onderwijscasus
<div id = "casus">
In verband met wervingsactiviteiten wil het hoofd van de afdeling Communicatie weten wat de reistijd is van studenten aan verschillende opleidingen. Hij heeft daarom data verzameld over de reistijd van uitwonende studenten voor de opleidingen: Arabische Taal en Cultuur, Filosofie en Geschiedenis. 

H~0~: De gemiddelde reistijd van de studenten is per opleiding gelijk aan elkaar: µ~0~ = µ~1~ = µ~2~ ... µ~n~  

H~A~: Tenminste voor één opleiding is de gemiddelde reistijd niet gelijk aan de gemiddelde reistijd van studenten voor andere opleidingen. µ~0~ ≠ µ~1~ = µ~2~ ... = µ~n~
</div>

# Assumpties
Voor een betrouwbaar resultaat moet de data aan een aantal voorwaarden voldoen voordat de toets uitgevoerd kan worden.
Controleer of de steekproef aan de volgende assumpties voldoet: normaliteit, homogeniteit van varianties en onafhankelijkheid.  

De *one-way ANOVA* is een robuuste test. Dit betekent dat als één groep uit de steekproef niet voldoet aan de assumptie van normaliteit of homogeniteit van varianties kan de *one-way ANOVA* nog steeds uitgevoerd en geïnterpreteerd worden.[^2] Als er geen sprake is van normaliteit en/of homogeniteit, gebruik de *Kruskal-Wallis test*.[^5] 

## Normaliteit
De *one-way ANOVA* gaat ervan uit dat de data normaal verdeeld is. Controleer de assumptie van normaliteit met de volgende stappen:  
1. Controleer de data visueel met een histogram, een Q-Q plot of een boxplot.  
2. Toets of de data normaal verdeeld is met de *Kolmogorov-Smirnov test* of bij een kleinere steekproef (n < 50[^3]) met de *Shapiro-Wilk test*.[^4]  
3. Als blijkt dat de data niet normaal verdeeld is, transformeer de data eventueel en bepaal daarna of deze wel normaal verdeeld is.

De *one-way ANOVA* is een robuuste test. Dit betekent dat als één groep uit de steekproef niet voldoet aan de assumptie van normaliteit of homogeniteit van varianties kan de *one-way ANOVA* nog steeds uitgevoerd en geïnterpreteerd worden.[^2] Als er geen sprake is van normaliteit en/of homogeniteit, gebruik de *Kruskal-Wallis test*.[^12]

## Homogeniteit van Varianties
Toets met de *Levene's Test (for equality of variance)* of de spreiding van iedere groep ongeveer hetzelfde is. Bij een *p* < 0,05 is de spreiding van de groepen significant verschillend. [^15]

# Effectmaat
Bereken de effectmaat om te bepalen of de gevonden p-waarde betekenisvol is. 
Een veel gebruikte effectmaat is Cohen's *d*. Cohen's *d* geeft de sterkte van het effect van een onafhankelijke variabele op een afhankelijke variabele weer.  

Een indicatie om *d* te interpreteren is: rond 0,3 is een klein effect, rond 0,5 is een gemiddeld effect en rond 0,8 is een groot effect.[^9]  

# Uitvoering in R
Er is een dataset ingeladen met de reistijden van uitwonende studenten per opleiding is ingeladen genaamd `Reistijd_per_opleiding`. 

## De data bekijken
Gebruik `head()` en `tail()` om de structuur van de data te bekijken.
<!-- ## BLOK: Data-bekijken.R -->
```{r data bekijken, collapse = TRUE}
## Eerste 5 observaties
head(Reistijd_per_opleiding)

## Laatste 5 observaties
tail(Reistijd_per_opleiding)
```
<!-- ## /BLOK: Data-bekijken.R -->

De data bevat data van studenten van verschillende opleidingen. Gebruik `levels()` om te onderzoeken welke opleidingen er in de data aanwezig zijn. 

<!-- ## BLOK: Data-bekijken2.R -->
```{r data bekijken 2}
## Opleidingen in de data aanwezig
levels(Reistijd_per_opleiding$Opleiding)
```
<!-- ## /BLOK: Data-bekijken2.R -->

Selecteer beide groepen en sla deze op in een vector om deze makkelijker aan te kunnen roepen. 
<!-- ## BLOK: Data-selecteren.R -->
```{r data selecteren}
Reistijd_ATC <- Reistijd_per_opleiding$Reistijd[Reistijd_per_opleiding$Opleiding == "Arabische Taal en Cultuur"]
Reistijd_FIL <- Reistijd_per_opleiding$Reistijd[Reistijd_per_opleiding$Opleiding == "Filosofie"]
Reistijd_GSC <- Reistijd_per_opleiding$Reistijd[Reistijd_per_opleiding$Opleiding == "Geschiedenis"]
```
<!-- ## /BLOK: Data-selecteren.R -->

Om meer inzicht te krijgen in de data, inspecteer de data met `M()`en `sd()`. 

<div class ="col3">
<!-- ## BLOK: Data-beschrijven-1.R -->
```{r Data beschrijven 1, collapse=TRUE}
## Aantallen, gemiddelde en standaarddeviatie ATC
length(Reistijd_ATC)
mean(Reistijd_ATC)
sd(Reistijd_ATC)
```
<!-- ## /BLOK: Data-beschrijven-1.R -->
```{r data beschrijven als object 1, include=FALSE, echo=TRUE}
vM_ATC <- Round_and_format(mean(Reistijd_ATC))
vSD_ATC <- Round_and_format(sd(Reistijd_ATC))
vN_ATC <- Round_and_format(length(Reistijd_ATC))
```

<!-- ## BLOK: Data-beschrijven-2.R -->
```{r Data beschrijven 2, collapse=TRUE}
## Aantallen, gemiddelde en standaarddeviatie 2010
length(Reistijd_FIL)
mean(Reistijd_FIL)
sd(Reistijd_FIL)
```
<!-- ## /BLOK: Data-beschrijven-2.R -->
```{r data beschrijven als object 2, include=FALSE, echo=TRUE}
vM_FIL <- Round_and_format(mean(Reistijd_FIL))
vSD_FIL <-Round_and_format(sd(Reistijd_FIL))
vN_FIL <- Round_and_format(length(Reistijd_FIL))
```

<!-- ## BLOK: Data-beschrijven-3.R -->
```{r Data beschrijven 3, collapse=TRUE}
## Aantallen, gemiddelde en standaarddeviatie 2010
length(Reistijd_GSC)
mean(Reistijd_GSC)
sd(Reistijd_GSC)
```
<!-- ## /BLOK: Data-beschrijven-3.R -->
```{r data beschrijven als object 3, include=FALSE, echo=TRUE}
vM_GSC <- Round_and_format(mean(Reistijd_GSC))
vSD_GSC <-Round_and_format(sd(Reistijd_GSC))
vN_GSC <- Round_and_format(length(Reistijd_GSC))
```
</div>

* Gemiddelde reistijd Arabische Taal en Cultuur (standaarddeviatie): `r vM_ATC` (`r vSD_ATC`). n = `r vN_ATC`  
* Gemiddelde reistijd Filosofie (standaarddeviatie): `r vM_FIL` (`r vSD_FIL`). n = `r vN_FIL`.
* Gemiddelde reistijd Geschiedenis (standaarddeviatie): `r vM_GSC` (`r vSD_GSC`). n = `r vN_GSC`.

## Visuele inspectie van normaliteit
Geef de data visueel weer met een histogram, Q-Q plot of boxplot.

### Histogram
Controleer de data visueel met een histogram.
<!-- ## BLOK: Histogram.R -->
```{r lib ggplot2}
library(ggplot2)
```
```{r histogram atc}
ggplot(Reistijd_per_opleiding,
  aes(x = Reistijd)) +
  geom_histogram(aes(y = ..density..),
                 binwidth = 5,
                 color = "grey30",
                 fill = "#0089CF") +
  facet_wrap(~ Opleiding) +
  geom_density(alpha = .2, adjust = 1) +
  ylab("Frequentiedichtheid") +
  labs(title = "Reistijd")
```
<!-- ## /BLOK: Histogram.R -->

Alle drie de histogrammen laten een belcurve zien vergelijkbaar aan een normale verdeling, veel waardes liggen rondom het gemiddelde.  

### Q-Q plot
Gebruik `qqnorm()` en `qqline()`. Gebruik `pch = 1`om kleine cirkels als datapunten te gebruiken.

Als over het algemeen de meeste datapunten op de lijn liggen, kan aangenomen worden dat de data normaal verdeeld is.
<div class ="col3">
<!-- ## BLOK: QQplot1.R -->
```{r qqplot atc}
qqnorm(
 Reistijd_ATC, pch = 1,
 main = "Normaal Q-Q plot van reistijd Arabische Taal en Cultuur",
 ylab = "Kwantielen in data",
 xlab = "Theoretische kwantielen")
qqline(Reistijd_ATC)
```
<!-- ## /BLOK: QQplot1.R -->
<!-- ## BLOK: QQplot2.R -->
```{r qqplot fil}
qqnorm(
 Reistijd_FIL, pch = 1,
 main = "Normaal Q-Q plot van reistijd Filosofie",
 ylab = "Kwantielen in data",
 xlab = "Theoretische kwantielen")
qqline(Reistijd_FIL)
```
<!-- ## /BLOK: QQplot2.R -->
<!-- ## BLOK: QQplot3.R -->
```{r qqplot gsc}
qqnorm(
 Reistijd_GSC, pch = 1,
 main = "Normaal Q-Q plot van reistijd Geschiedenis",
 ylab = "Kwantielen in data",
 xlab = "Theoretische kwantielen")
qqline(Reistijd_GSC)
```
<!-- ## BLOK: QQplot3.R -->
</div>

Bij de Q-Q plot van de reistijd van studenten Geschiedenis liggen de meeste punten op de lijn behalve bij de uiteinden. De cirkels van de Q-Q plot van studenten Arabische Taal en Cultuur en studenten Filosofie liggen net naast de getrokken lijn, maar zo minimaal ernaast dat de data vermoedelijk normaal verdeeld is.   

### Boxplot
Controleer de data visueel met een boxplot. De boxplotten geven de spreiding weer van het gemiddelde tentamencijfer per periode voor de Lerarenopleiding. De box geeft de middelste 50% van de tentamencijfers weer. De zwarte lijn binnen de box is de mediaan. In de staarten zitten de eerste 25% en de laatste 25%. Cirkels visualiseren uitbijters.
  
```{r boxplot}
library(graphics)
boxplot(Reistijd ~ Opleiding, Reistijd_per_opleiding)
```

De boxplotten geven de spreiding weer van de reistijd voor de drie opleidingen.   
De boxplotten Arabische Taal en Cultuur en Geschiedenis zien er symmetrisch uit; de boxen zijn even hoog boven als onder de mediaan. De staarten zijn onder en boven even groot. De boxplot van Filosofie is boven de mediaan groter dan onder de mediaan, de data kan wat scheef verdeeld zijn.  


## Toetsen van normaliteit
Om te controleren of de data normaal verdeeld is, kan de normaliteit getoetst worden. Hierbij een toelichting bij twee veel gebruikte toetsen: de *Kolmogorov-Smirnov test* en de *Shapiro-Wilk test*.

### Kolmogorov-Smirnov (met Lilliefors correctie) 
De *Kolmogorov-Smirnov test*  toetst het verschil in vorm tussen twee verdelingen. In deze casus toetst deze test het verschil tussen een normale verdeling en de verdeling van de steekproef. De Lilliefors correctie wordt gebruikt als het gemiddelde niet 0 is en de standaardafwijking niet 1 is. Als de p-waarde < 0,05 is de verdeling van de data significant verschillend van de normale verdeling.


```{r library nortest}
library("nortest")
```
<div class="col3">
<!-- ## BLOK: Lilliefors-test.R -->
```{r Kolmogorov-Smirnov Test, warning=FALSE}
lillie.test(Reistijd_ATC)
lillie.test(Reistijd_FIL)
lillie.test(Reistijd_GSC)
```
<!-- ## /BLOK: Lilliefors-test.R -->
</div>
Bij deze casus zijn van alle groepen de p-waarde > 0,05; er is geen significant verschil gevonden tussen de verdeling van de steekproef en de normale verdeling. Er wordt aan de assumptie van normaliteit voldaan, dus de *one-way ANOVA* kan uitgevoerd worden.

## Homogeniteit van varianties
Test met de Levene's test de homogeniteit van varianties. Als uit de *Levene's test* komt dat de steekproeven verschillen in variantie kan de *ongepaarde t-toets* met ongelijke varianties uitgevoerd worden. 

<!-- ## BLOK: Levenes-test.R -->
```{r LeveneTest, warning = FALSE, message = FALSE}
library(car)
leveneTest(Reistijd_per_opleiding$Reistijd, Reistijd_per_opleiding$Opleiding)
```
<!-- ## /BLOK: Levenes-test.R -->
```{r Levenes test als object, echo = FALSE}
L <- leveneTest(Reistijd_per_opleiding$Reistijd, Reistijd_per_opleiding$Opleiding)
vF_waarde <- Round_and_format(L$`F value`)
vF_p <- Round_and_format(L$`Pr(>F)`)
vDF1 <- Round_and_format(L$`Df`[1])
vDF2 <- Round_and_format(L$`Df`[2])
```
*F*(`r vDF1`, `r vDF2`) = `r vF_waarde`, p-waarde = `r vF_p`, de groepen zijn niet verschillend in spreiding.  
Vrijheidsgraden bestaat nu uit twee cijfers, het eerste cijfer (het aantal groepen - 1 = `r vDF1`) en het tweede cijfer (*n~1~* + *n~2~* - 2 = `r vDF2`)


### Shapiro-Wilk Test
De *Shapiro-Wilk test* is een soortgelijke test als de *Kolmogorov-Smirnov test* en wordt vooral gebruikt bij kleine steekproeven. Als de p-waarde groter is dan 0,05 is de verdeling van de data niet significant verschillend van de normale verdeling.

<div class="col3">
<!-- ## BLOK: Shapiro-Wilk-test.R -->
``` {r Shapiro-Wilk Test, warning=FALSE}
shapiro.test(Reistijd_ATC)
shapiro.test(Reistijd_FIL)
shapiro.test(Reistijd_GSC)
```
<!-- ## /BLOK: Shapiro-Wilk-test.R -->
</div>

In dit voorbeeld, met een kleine *n*, hebben beide groepen een p-waarde > 0,05, dus is de verdeling van beide groepen niet significant verschillend van de normale verdeling. Er wordt aan de assumptie van normaliteit voldaan, dus de *one-way ANOVA* kan uitgevoerd worden.

## One-way ANOVA 
Gebruik `aov()` om een ANOVA-object (`aov`) te creëren. Geef het resultaat overzichtelijk weer met `summary()`.
<!-- ## BLOK: ANOVA-toets.R -->
```{r ANOVA}
res.aov <- aov(Reistijd ~ Opleiding, Reistijd_per_opleiding)
summary(res.aov)
```
<!-- ## /BLOK: ANOVA-toets.R -->
```{r ANOVA als object, echo=FALSE}
ANOVA <- summary(res.aov)
vF_waarde <- Round_and_format(ANOVA[[1]]$`F value`[1])
```
* *F* (`r vDF1`, `r vDF2`) = `r vF_waarde`, *p* < 0,01  
* Vrijheidsgraden: het aantal groepen - 1 = `r vDF1`; *n~1~* + *n~2~* - 2 = `r vDF2`
* p-waarde < 0,05, dus de H~0~ wordt verworpen en de H~A~ wordt aangenomen

### Effectmaat: Cohen's d 
Gebruik `cohen.d()` met `paired = FALSE` om het effect te meten.
<!-- ## BLOK: Library-effsize.R -->
```{r library effsize}
library(effsize)
```
<!-- ## /BLOK: Library-effsize.R -->
<div class="col3">
<!-- ## BLOK: Cohens-d.R --> 
```{r Cohen s d}
cohen.d(Reistijd_ATC,
        Reistijd_FIL,
        paired = FALSE)
cohen.d(Reistijd_ATC,
        Reistijd_GSC,
        paired = FALSE)
cohen.d(Reistijd_FIL,
        Reistijd_GSC,
        paired = FALSE)
```
<!-- ## /BLOK: Cohens-d.R --> 
</div>

## Effectmaat: eta squared
Gebruik `EtaSq()` op een ANOVA-object om eta-squared te vinden.
<!-- ## BLOK: Eta-squared.R --> 
```{r eta-squared, message = FALSE}
library(DescTools)
EtaSq(res.aov)
```
<!-- ## /BLOK: Eta-squared.R -->
Een indicatie om *d* te interpreteren is: rond 0,3 is het een klein effect, rond 0,5 is het een gemiddeld effect en rond 0,8 is het een groot effect.[^7]



## Tukey's toets
Doe een post hoc test om te toetsen welke verschillen significant zijn. Gebruik bij gelijke variantie de Tukey honestly significant difference test. Gebruik `TukeyHSD()` op het ANOVA-object.
<!-- ## BLOK: Tukey-HSD.R -->
```{r TukeyHSD}
TukeyHSD(res.aov)
```
<!-- ## /BLOK: Tukey-HSD.R -->
```{r TukeyHSD als object}
THSD <- TukeyHSD(res.aov)
vATCvsFIL <- Round_and_format(THSD$Opleiding[1,1])
vATCvsGSC <- Round_and_format(THSD$Opleiding[2,1])
vFILvsGSC <- Round_and_format(THSD$Opleiding[3,1])
```
Het verschil tussen Filosofie en Arabische Taal en Cultuur: *MD* = `r vATCvsFIL`, p < 0,01. 
Het verschil tussen Geschiedenis en Arabische Taal en Cultuur: *MD* = `r vATCvsGSC`, p < 0,01. 
Het verschil tussen Geschiedenis en Filosofie: *MD* = `r vFILvsGSC`, p = 0,26. 

# Rapportage
Een *one-way ANOVA* is uitgevoerd om te toetsen of de gemiddelde reistijd van de studenten is per opleiding gelijk aan elkaar is. De opleidingen zijn: Arabische Taal en Cultuur (*M~atc~* = `r vM_ATC`, *SD~atc~* = `r vSD_ATC`), Filosofie (*M~fil~* = `r vM_FIL`, *SD~fil~* = `r vSD_FIL`) en Geschiedenis (*M~gsc~* = `r vM_GSC`, *SD~fil~* = `r vSD_FIL`. The *one way ANOVA* was significant, *F*(`r vDF1`, `r vDF2`) = `r vF_waarde`, *p* < 0,01. Dat wil zeggen dat er een significant verschil is tussen de gemiddelde reistijden van de drie opleidingen.  

**het effect is **

| Opleiding     | N          | M          | SD          |
| ------------- | ---------- | ---------- | ----------- |
| Arabisch      | `r vN_ATC` | `r vM_ATC` | `r vSD_ATC` |
| Filosofie     | `r vN_FIL` | `r vM_FIL` | `r vSD_FIL` |
| Geschiedenis  | `r vN_GSC` | `r vM_GSC` | `r vSD_GSC` |

**posthoc en uitkomsten **
*Tukey's HSD test* is uitgevoerd om te toetsen welke van de drie gemiddelden significant verschillen van elkaar. 


Filosofie en Arabische Taal en Cultuur verschillen significant (*MD* = `r vATCvsFIL`, p < 0,01). Geschiedenis en Arabische Taal en Cultuur hebben een significant verschil (*MD* = `r vATCvsGSC`, p < 0,01). Tussen Geschiedenis en Filosofie is geen significant verschil gevonden (*MD* = `r vFILvsGSC`, p = 0,26). 


Aan de hand van de resultaten kan geconcludeerd worden dat ..... Het effect is minimaal.

[^1]: van Geloven, N. (25 mei 2016). *One-way ANOVA*. https://wikistatistiek.amc.nl/index.php/One-way_ANOVA
[^2]: Universiteit van Amsterdam (8 juli 2014). *One-way ANOVA*. https://wiki.uva.nl/methodologiewinkel/index.php/One-way_ANOVA 
[^3]: Laerd statistics (2018). *Testing for Normality using SPSS Statistics*. https://statistics.laerd.com/spss-tutorials/testing-for-normality-using-spss-statistics.php  
[^4]: Universiteit van Amsterdam (14 juli 2014). *Normaliteit*. https://wiki.uva.nl/methodologiewinkel/index.php/Normaliteit  
[^5]: van Geloven, N. (21 maart 2018). *Kruskal Wallis* https://wikistatistiek.amc.nl/index.php/Kruskal_Wallis
[^6]: Wikipedia (7 september 2019). *Analysis of variance*. https://en.wikipedia.org/wiki/Analysis_of_variance 
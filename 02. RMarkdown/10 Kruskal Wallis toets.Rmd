---
title: "Kruskal Wallis toets"
author: "© 2019, SURF Versnellingsagenda Statistisch Handboek Hoger Onderwijs"
date: "`r format(Sys.time(), '%d-%m-%y')`"
output: 
  html_document:
    toc: TRUE
    toc_float:
      collapsed: FALSE
    number_sections: TRUE
    theme: lumen
---

<style>
`r htmltools::includeHTML(paste0(here::here(),"/03. Includes/css/Stylesheet_SHHO.css"))`
</style>

```{r header, include = FALSE, echo = TRUE, results='asis'} 
paste0(here::here(),"/03. Includes/code/Header.R")
```

<!-- ## BLOK: Functiedefinities.R -->
```{r functiedefinities,include=FALSE, echo=TRUE}
library(stringr)
Round_and_format <- function(x, digits = 2) {
  x <- as.character(round(x, digits))
  x <- str_replace(x, "[.]", ",")
  return(x)
}
```
<!-- ## /BLOK: Functiedefinities.R -->

<!-- ## BLOK: Data-aanmaken.R -->
```{r aanmaken data, include=FALSE, echo=TRUE}
## H0 en H1 medianen of gemiddelden, ook in toepassing 
## is het wel interessant om gemiddelden te tonen? 
## link naar Mann W-U test 
## Vraag Sandjai en Martijn: Hoe kan het dat fiscaal recht en schakelprogramma niet significant verschillen, terwijl notarieel recht en schakelprogramma wel verschillen.  


RNGkind(sample.kind = "Rounding")
set.seed(8)
# 3
## 300 waarnemingen voor Vooropleiding
Seed <- sample(c(1, 2, 3, 4), 300, replace = TRUE)
Vooropleiding <-  ifelse(Seed == 1, "Rechtsgeleerdheid", 
                  ifelse(Seed == 2, "Notarieel recht",
                  ifelse(Seed == 3, "Fiscaal recht",
                  ifelse(Seed == 4, "Schakelprogramma",
                                 NA))))

## 300 waarnemingen voor puntenaantallen, random gesampled uit een lijst mogelijkheden
Punten_mogelijkheden <- c(6, 12, 18, 24, 30, 36, 36, 42, 42, 42, 48, 48, 48, 48, 54, 54, 54, 60, 60, 60, 60, 60, 60)
Ec_jaar1 <- sample(Punten_mogelijkheden, 300, replace = TRUE)

Studentnr <- sample(3000000:4000000, 300)
Resultaten_arbeidsrecht <- data.frame(Studentnr, Vooropleiding, Ec_jaar1)

## puntencorrectie om Fiscaal en Notarieel +6 punten te geven en Rechtsgeleerdheid -6 punten
Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Fiscaal recht" | Vooropleiding == "Notarieel recht"] <-
  Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Fiscaal recht" | Vooropleiding == "Notarieel recht"] + 6
Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Rechtsgeleerdheid"] <-
  Resultaten_arbeidsrecht$Ec_jaar1[Vooropleiding == "Rechtsgeleerdheid"] - 6
```
<!-- ## /BLOK: Data-aanmaken.R -->

# Toepassing
Gebruik de *Kruskal Wallis toets* om te toetsen of de medianen van meerdere groepen significant verschillen. Een kenmerk van de data is dat deze numeriek en ongepaard is.  
De *Kruskal Wallis toets* kan een alternatief zijn voor de *one way ANOVA*.[^1] De *Kruskal Wallis toets* maakt een rangschikking van de data. Hierdoor is de test verdelingsvrij en is normaliteit geen assumptie. Ook zijn uitbijters minder van invloed op het eindresultaat. Toch wordt er voor deze test minder vaak gekozen, dit komt doordat bij het maken van een rankschikking de data informatie verliest. Als de data wel normaal verdeeld zijn heeft de *Kruskal Wallis toets* minder onderscheidend vermogen, dan wanneer de *one way ANOVA* uitgevoerd zou worden.[^2]  

# Onderwijscasus
<div id="casus">
De opleidingsdirecteur van de tweejarige Masteropleiding Arbeidsrecht is geïnteresseerd in de afstudeersnelheid van zijn studenten. Hij vraagt zich af of het type vooropleiding bepalend is voor hoeveel vakken de studenten afronden in het eerste jaar. Hij kijkt naar de vier meest gangbare vooropleidingen die de studenten doorlopen voordat ze met de Master Arbeidsrecht beginnen; de bachelors: Fiscaal recht, Notarieel recht, Rechtsgeleerdheid en een schakelprogramma.  

H~0~: De vooropleiding is niet bepalend voor het aantal vakken die de Masterstudenten Arbeidsrecht behalen in het eerste jaar.  

H~1~: De vooropleiding is bepalend voor het aantal vakken die de Masterstudenten Arbeidsrecht behalen in het eerste jaar.
</div>
# Assumpties
Voor een valide resultaat moeten de data aan een aantal voorwaarden voldoen voordat de toets uitgevoerd kan worden. De data zijn (semi-)continue [^3], de groepen zijn onafhankelijk van elkaar [^4] en het aantal groepen > 2. Gebruik bij 2 groepen de *Mann-Whitney U toets*.

# Post-hoc toets 
De *Kruskal Wallis Toets* toetst of één of meerdere groepen verschillen. Welke groep verschilt wordt niet gespecificeerd. Om te bepalen wélke groepen significant verschillen gebruik de *Mann-Whitney U toets* als post-hoc toets. 

Gebruik de *Bonferroni correctie* om Type I fouten te voorkomen. Deze toets past de p-waarde aan door de waarde te vermenigvuldigen met het aantal uitgevoerde toetsen [^5].

# Uitvoering in R
Er is een dataset ingeladen met studieresultaten van de master arbeidsrecht per vooropleiding: Fiscaal recht, Notarieel recht, Rechtsgeleerdheid en een schakelprogramma.

## De data bekijken
<!-- ## BLOK: Data-bekijken.R -->
```{r data bekijken, collapse = TRUE}
## Eerste 6 observaties
head(Resultaten_arbeidsrecht)

## Laatste 6 observaties
tail(Resultaten_arbeidsrecht)
```
<!-- ## /BLOK: Data-bekijken.R -->

De dataset bevat data van studenten van verschillende vooropleidingen. Gebruik `levels()` om te onderzoeken welke opleidingen er in de data aanwezig zijn. 

<!-- ## BLOK: Data-bekijken-2.R -->
```{r data bekijken 2}
## Opleidingen in de data aanwezig
levels(Resultaten_arbeidsrecht$Vooropleiding)
```
<!-- ## /BLOK: Data-bekijken-2.R -->

Om meer inzicht te krijgen in de data, inspecteer de groepen met `n()`, `mean()` en `median()`. Groepeer hiervoor eerst met `group_by()`.

<!-- ## BLOK: Data-beschrijven.R -->
``` {r data beschrijven, warning=FALSE, message=FALSE}
## Aantallen en mediaan
library(dplyr)
group_by(Resultaten_arbeidsrecht, Vooropleiding) %>%
  summarise(
    count = n(),
    median = median(Ec_jaar1)
  )
```
<!-- ## /BLOK: Data-beschrijven.R -->

``` {r data beschrijven als object, include=FALSE, echo=TRUE}
library(dplyr)
x <- group_by(Resultaten_arbeidsrecht, Vooropleiding) %>%
  summarise(
    count = n(),
    median = median(Ec_jaar1)
  )

vN_FIS <- Round_and_format(x[1,2])
vN_NOT <- Round_and_format(x[2,2])
vN_RCH <- Round_and_format(x[3,2])
vN_SCH <- Round_and_format(x[4,2])

vMed_FIS <- Round_and_format(x[1,3])
vMed_NOT <- Round_and_format(x[2,3])
vMed_RCH <- Round_and_format(x[3,3])
vMed_SCH <- Round_and_format(x[4,3])
```
* Mediaan Fiscaal Recht: `r vMed_FIS`. *n* = `r vN_FIS`.
* Mediaan Notarieel Recht: `r vMed_NOT`. *n* = `r vN_NOT`.
* Mediaan Rechtsgeleerdheid: `r vMed_RCH`. *n* = `r vN_RCH`.
* Mediaan schakelprogramma: `r vMed_SCH`. *n* = `r vN_SCH`.

### Boxplot
De box geeft de middelste 50% van het aantal studiepunten weer. De zwarte lijn binnen de box is de mediaan. In de staarten zitten de eerste 25% en de laatste 25%. Cirkels visualiseren mogelijke uitbijters.[^8]  

<!-- ## BLOK: Boxplot.R -->
``` {r Boxplot}
boxplot(Ec_jaar1 ~ Vooropleiding, Resultaten_arbeidsrecht,
        main = "Gemiddeld aantal EC per vooropleiding van de Master Arbeidsrecht")
```
<!-- ## /BLOK: Boxplot.R -->

Bij de *Kruskal Wallis toets* wordt getoetst of de medianen van meerdere groepen significant verschillen, daarom is het in dit geval ook relevant om te kijken naar het verschil tussen de medianen van de groepen. De mediaan van rechtsgeleerdheid heeft duidelijk minder studiepunten dan Fiscaal recht en Notarieel recht. Het schakelprogramma ligt er tussen in.

# Kruskal Wallis toets
Gebruik `kruskal.test()`. In het eerste argument gebruik je de afhankelijke variabele en de variabele die de groep definiëert. Het tweede argument is het dataframe. 
<!-- ## BLOK: Kruskal-Wallis-test -->
```{r Kruskal Wallis test}
kruskal.test(Ec_jaar1 ~ Vooropleiding, Resultaten_arbeidsrecht)
```
<!-- ## /BLOK: Kruskal-Wallis-test -->
```{r Kruskal Wallis test als object, include= FALSE, echo= TRUE}
Ktest <- kruskal.test(Ec_jaar1 ~ Vooropleiding, Resultaten_arbeidsrecht)
vK_DF <- Round_and_format(Ktest$parameter)
vK_Chi2 <- Round_and_format(Ktest$statistic)
vK_P <- Round_and_format(Ktest$p.value)
```
* *df*: het aantal groepen - 1 = `r vK_DF`  
* *H*, R noemt het chi-squared omdat het een chi-kwadraat verdeling is: `r vK_Chi2`   
* p-waarde < 0,05, dus de H~0~ wordt verworpen en de H~A~ wordt aangenomen[^6]

# Post-hoc toets: Mann-Whitney U toets
Om te weten welke groepen verschillen wordt de *Mann-Whitney U toets* uitgevoerd, ook wel *Wilcoxon rank-sum* genoemd.[^7] Gebruik hierbij de `pairwise.wilcox.test()`. 
Pas de *Bonferroni correctie* toe, om te corrigeren voor dat er meerdere toetsen worden uitgevoerd, p.adjust.method = "bonferroni"    

<!-- ## BLOK: Mann-Whitney-U-test-->
``` {r pairwise wilcox test}
pairwise.wilcox.test(Resultaten_arbeidsrecht$Ec_jaar1, Resultaten_arbeidsrecht$Vooropleiding, p.adjust.method = "bonferroni")
```
<!-- ## /BLOK: Mann-Whitney-U-test-->

* De studenten met Rechtsgeleerdheid als vooropleiding (mediaan = `r vMed_RCH`) scoren statistisch significant lager dan de elk van de drie andere vooropleidingen.
* Tussen de groepen met vooropleiding schakelprogramma (mediaan = `r vMed_SCH`) en Notarieel recht (mediaan = `r vMed_NOT`) is een statistisch significant verschil gevonden.  

* Er is geen statistisch significant verschil gevonden tussen Fiscaal recht (mediaan = `r vMed_FIS`) en Notarieel recht (mediaan = `r vMed_NOT`).
* Er is ook geen statistisch significant verschil gevonden tussen Fiscaal recht (mediaan = `r vMed_FIS`) en schakelprogramma (mediaan = `r vMed_SCH`).

# Rapportage
De *Kruskal Wallis toets* is uitgevoerd om te toetsen of een vooropleiding bepalend is voor de hoeveelheid studiepunten die een student behaalt tijdens het eerste jaar van de master Arbeidsrecht. Uit de resultaten kan afgelezen worden dat er een statistisch significant verschil is tussen het aantal studiepunten en het type vooropleiding die de student heeft afgerond. *H*~`r vK_DF`~ ≈ `r vK_Chi2` < 0,05.  
Met een post-hoc toets is het verschil tussen de vooropleidingen getoetst. Er is een statistisch significant verschil gevonden tussen Rechtsgeleerdheid en de drie andere vooropleidingen. En er is ook een statistisch significant verschil gevonden tussen schakelprogramma en Notarieel recht. 

TABEL mediaan per groep 

De resultaten ondersteunen de conclusie dat de vooropleiding bepalend is voor de hoeveelheid studiepunten die een student behaalt tijdens het eerste jaar van de master Arbeidsrecht. De studenten met Rechtsgeleerdheid als vooropleiding behalen statistisch significant minder studiepunten dan de elk van de drie andere vooropleidingen. Studenten met de vooropleiding Fiscaal recht (mediaan = `r vMed_FIS`) en Notarieel recht (mediaan = `r vMed_NOT`) behalen de meeste studiepunten.

[^1]: van Geloven, N. (21 maart 2018). *Kruskal Wallis*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Kruskal_Wallis). 
[^2]: Universiteit van Amsterdam (7 juli 2014). *Kruskal-Wallis Test*. [UvA Wiki Methodologiewinkel](https://wiki.uva.nl/methodologiewinkel/index.php/Kruskal-Wallis_Test). 
[^3]: Semi-continue data wil zeggen dat de data gehele getallen bevat met veel verschillende waardes. Een voorbeeld hiervan is de aanwezigheid van studenten tijdens de jaaropening. Van Geloven, N. (21 November 2017).*KEUZE TOETS*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/KEUZE_TOETS).
[^4]: Elke groep heeft geen overlap met één van de andere groepen en de groepen kunnen elkaars deelname niet beïnvloeden. Deze stap wordt beredeneerd en wordt niet getoetst.  
[^5]: Universiteit van Amsterdam (7 juli 2014). *Kruskal-Wallis Test*. [UvA Wiki Methodologiewinkel](https://wiki.uva.nl/methodologiewinkel/index.php/Kruskal-Wallis_Test).
[^6]: In dit voorbeeld wordt eruit gegaan van een waarschijnlijkheid van 95% en zodoende een p-waardegrens van 0,05. Dit is naar eigen inzicht aan te passen. Hou hierbij rekening met type I en type II fouten.
[^7]: van Geloven, N. (13 maart 2018).  *Mann-Whitney U toets*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Mann-Whitney_U_toets).
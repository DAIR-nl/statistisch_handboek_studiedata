---
title: "Gepaarde t-toets"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: 
      collapsed: FALSE 
    number_sections: true
  keywords: [statistisch handboek, studiedata]
---

<!-- ## CLOSEDBLOK: Functies.R -->
```{r functies, include = TRUE, echo = FALSE, results='asis', warning=FALSE, message=FALSE}
library(here)
if (!exists("Substitute_var")) {
  ## Installeer packages en functies
  source(paste0(here::here(), "/99. Functies en Libraries/00. Voorbereidingen.R"), echo = FALSE)
}
```
<!-- ## /CLOSEDBLOK: Functies.R -->

<style>
`r htmltools::includeHTML(paste0(here::here(),"/01. Includes/css/Stylesheet_SHHO.css"))`
</style>

<!-- ## CLOSEDBLOK: Header.R -->
```{r header, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Header.R"))} 
```
<!-- ## /CLOSEDBLOK: Header.R -->

<!-- ## CLOSEDBLOK: Reticulate.py -->
```{r reticulate, include = TRUE, echo = FALSE, warning=FALSE, message=FALSE}
library(reticulate)
knitr::knit_engines$set(python = reticulate::eng_python)
```
<!-- ## /CLOSEDBLOK: Reticulate.py -->

<!-- ## OPENBLOK: Data-aanmaken.py -->
```{r aanmaken data, include=FALSE, echo=TRUE}
source(paste0(here::here(),"/01. Includes/data/02.R"))
```
<!-- ## /OPENBLOK: Data-aanmaken.py -->

<!-- ## TEKSTBLOK: Dataset-inladen.py -->
Er is een dataset ingeladen met het gemiddeld aantal uren studeren voor (T~0~) en na (T~1~) de cursus. De gemiddeldes per onderwijsperiode zijn afgerond op 1 decimaal in de dataframe `dfStudielogboek`. 
<!-- ## /TEKSTBLOK: Dataset-inladen.py -->

<!-- ## TEKSTBLOK: Data-bekijken.py -->
Gebruik `<dataframe>.head()` en `<dataframe>.tail()` om de structuur van de data te bekijken.
<!-- ## /TEKSTBLOK: Data-bekijken.py -->

<!-- ## OPENBLOK: Data-bekijken.py -->
```{python, include=FALSE}
import pandas as pd
dfStudielogboek = pd.DataFrame(r.Studielogboek)
```

```{python data bekijken-1, collapse = TRUE}
## Eerste 6 observaties
print(dfStudielogboek.head(6))
```

```{python data bekijken-2, collapse = TRUE}
## Laatste 6 observaties
print(dfStudielogboek.tail(6))
```
<!-- ## /OPENBLOK: Data-bekijken.py -->

<!-- ## OPENBLOK: Data-selecteren.py -->
```{python data selecteren}
Uren_studeren_T0 = dfStudielogboek[dfStudielogboek['Meetmoment'] == "T0"]['Uren_studeren']
Uren_studeren_T1 = dfStudielogboek[dfStudielogboek['Meetmoment'] == "T1"]['Uren_studeren']
Uren_studeren_verschil = Uren_studeren_T1 - Uren_studeren_T0
```
<!-- ## /OPENBLOK: Data-selecteren.py -->

<!-- ## OPENBLOK: numpy-inladen.py -->
```{python}
# Om het gemiddelde en de standaard deviatie te berekenen, hebben we de library 'numpy' nodig
import numpy as np
```

```{python, include = FALSE}
Uren_studeren_verschil = np.array(Uren_studeren_T1) - np.array(Uren_studeren_T0)
```
<!-- ## OPENBLOK: numpy-inladen.py -->

<!-- ## OPENBLOK: Data-beschrijven-1.py -->
```{python data beschrijven t1, collapse = TRUE}
## aantallen, gemiddelde en standaarddeviatie voor tutorgesprek
print(len(Uren_studeren_T0))
print(np.mean(Uren_studeren_T0))
print(np.sqrt(np.var(Uren_studeren_T0, ddof = 1)))
```
<!-- ## /OPENBLOK: Data-beschrijven-1.py -->

<!-- ## CLOSEDBLOK: Data-beschrijven.py -->
```{python Var beschrijven, include=FALSE, echo=TRUE}
vMean_t0 = np.mean(Uren_studeren_T0)
vSD_t0 = np.sqrt(np.var(Uren_studeren_T0, ddof = 1))
vN_t0 = np.size(Uren_studeren_T0)
vMean_t1 = np.mean(Uren_studeren_T1)
vSD_t1 = np.sqrt(np.var(Uren_studeren_T1, ddof = 1))
vN_t1 = np.size(Uren_studeren_T1)
```
<!-- ## /CLOSEDBLOK: Data-beschrijven.py -->

<!-- ## TEKSTBLOK: Data-beschrijven.py -->
* Gemiddeld uren studeren T~0~ (standaardafwijking): `r Round_and_format(py$vMean_t0)` (`r Round_and_format(py$vSD_t0)`). *n* = `r py$vN_t0`.
* Gemiddeld uren studeren T~1~ (standaardafwijking): `r Round_and_format(py$vMean_t1)` (`r Round_and_format(py$vSD_t1)`). *n* = `r py$vN_t1`.
<!-- ## /TEKSTBLOK: Data-beschrijven.py -->

<!-- ## OPENBLOK: Data-beschrijven-2.py -->
```{python data bekijken t2, collapse=TRUE}
## aantallen, gemiddelde en standaarddeviatie na tutorgesprek
print(len(Uren_studeren_T1))
print(np.mean(Uren_studeren_T1))
print(np.sqrt(np.var(Uren_studeren_T1, ddof = 1)))
```
<!-- ## /OPENBLOK: Data-beschrijven-2.py -->

<!-- ## OPENBLOK: Histogram.py -->
```{python histogram}
## Histogram met matplotlib
import matplotlib.pyplot as plt
hist = plt.hist(Uren_studeren_verschil, density = True, edgecolor = "black", bins = 12)
title = plt.title("Verschilscores uren studeren voor en na cursus")
xlab = plt.xlabel("Verschilscores uren studeren")
ylab = plt.ylabel("Frequentiedichtheid")
yax = plt.ylim([0, 0.175])
plt.show()
```
<!-- ## /OPENBLOK: Histogram.py -->

<!-- ## TEKSTBLOK: QQplot.py -->
Importeer `scipy.stats` om een Q-Q plot te maken en statistische testen uit te voeren. Voor een Q-Q plot kan de functie `scipy.stats.probplot()` worden gebruikt.
<!-- ## /TEKSTBLOK: QQplot.py -->

<!-- ## OPENBLOK: QQplot-inladen.py -->
```{python}
import scipy.stats as stats
```
<!-- ## /OPENBLOK: QQplot-inladen.py -->

<!-- ## OPENBLOK: QQplot-1.py -->
```{python qqplot}
qq = stats.probplot(Uren_studeren_verschil, dist="norm", plot=plt)
title = plt.title("Normaal Q-Q plot verschilscores uren studeren voor en na cursus")
xlab = plt.xlabel("Theoretische kwantielen")
ylab = plt.ylabel("Kwantielen in data")
plt.show()
```
<!-- ## /OPENBLOK: QQplot-1.py -->

<!-- ## OPENBLOK: Boxplot.py -->
``` {python Boxplot}
## Boxplot
fig, ax = plt.subplots()
box = ax.boxplot([Uren_studeren_verschil], labels = [""])
title = plt.title("Boxplot van verschilscores uren studeren voor en na cursus")
plt.show()
```
<!-- ## /OPENBLOK: Boxplot.py -->

<!-- ## TEKSTBLOK: Lilliefors-test1.py -->
De standaard interpretatie van een statitische toets in Python is als volgt: `(<teststatistiek>, <p-waarde>)`. Verder wordt er standaard tweezijdig getoetst.
<!-- ## /TEKSTBLOK: Lilliefors-test1.py -->

<!-- ## OPENBLOK: Library-nortest.py -->
```{python}
import statsmodels.stats.api
```
<!-- ## /OPENBLOK: Library-nortest.py -->

<!-- ## OPENBLOK: Lilliefors-test-1.py -->
``` {python Lilliefors Test-1, warning=FALSE}
print(statsmodels.stats.api.lilliefors(Uren_studeren_verschil, pvalmethod="approx"))
```
<!-- ## /OPENBLOK: Lilliefors-test-1.py -->

<!-- ## CLOSEDBLOK: data inladen-2.py -->
```{python, include=FALSE}
Uren_studeren_verschil_n30 = r.Uren_studeren_verschil_n30
N = len(Uren_studeren_verschil_n30)
```
<!-- ## /CLOSEDBLOK: data inladen-2.py -->

<!-- ## TEKSTBLOK: Shapiro-Wilk-test.py -->
Er is een subset van de verschillen tussen het aantal studieuren op T~0~ en T~1~ ingeladen, `Uren_studeren_verschil_n30` met daarin `r py$N` observaties.
<!-- ## /TEKSTBLOK: Shapiro-Wilk-test.py -->

<!-- ## OPENBLOK: Shapiro-Wilk-test-1.py -->
``` {python Shapiro-Wilk Test-1}
print(stats.shapiro(Uren_studeren_verschil_n30))
```
<!-- ## /OPENBLOK: Shapiro-Wilk-test-1.py -->

<!-- ## TEKSTBLOK: T-test.py -->
Gebruik `stats.ttest_rel()` om een *gepaarde t-toets* uit te voeren. Gebruik hier weer de twee variabelen `Uren_studeren_T0` en `Uren_studeren_T1`.
<!-- ## /TEKSTBLOK: T-test.py -->

<!-- ## OPENBLOK: T-toets.py -->
```{python T-test}
print(stats.ttest_rel(Uren_studeren_T0, Uren_studeren_T1))
```
```{python}
# Absoluut gemiddeld verschil berekenen
absoluut_verschil = np.mean(np.abs(np.array(Uren_studeren_T1) - np.array(Uren_studeren_T0)))
print(absoluut_verschil)
```
<!-- ## /OPENBLOK: T-toets.py -->

<!-- ## CLOSEDBLOK: T-test.py -->
```{python T-test als object, echo = FALSE}
stat, pval = stats.ttest_rel(Uren_studeren_T0, Uren_studeren_T1)
N_tot = len(Uren_studeren_verschil)
df = N_tot - 1
```
<!-- ## /CLOSEDBLOK: T-test.py -->

<!-- ## TEKSTBLOK: T-test2.py -->
* *t*~`r py$df`~ = `r Round_and_format(py$stat)`, *p* < 0,05
* Vrijheidsgraden, *df* = *n* -1 = `r py$N_tot`-1 = `r py$df`  
* p-waarde < 0,05, dus de H~0~ wordt verworpen [^10]
* het absolute verschil tussen de twee groepen: `r Round_and_format(py$absoluut_verschil)` 
<!-- ## TEKSTBLOK: T-test2.py -->

<!-- ## TEKSTBLOK: Cohen-d.py -->
Er is geen Python eigenfunctie voor Cohen's D, neem daarom onderstaande functie `cohen_d()` over.[^11]
<!-- ## /TEKSTBLOK: Cohen-d.py  -->

<!-- ## OPENBLOK: Cohens-d-test.py -->
```{python}
def cohen_d(x, y):
  # import numpy
  import numpy as np
	
	# calculate the size of samples
  n1, n2 = len(x), len(y)
	
	# calculate the variance of the samples
  v1, v2 = np.var(x, ddof=1), np.var(y, ddof=1)
	
	# calculate the pooled standard deviation
  s = np.sqrt(((n1 - 1) * v1 + (n2 - 1) * v2) / (n1 + n2 - 2))
	
	# calculate the means of the samples
  m1, m2 = np.mean(x), np.mean(y)
	
	# calculate the effect size
  return (m1 - m2) / s
```

```{python}
print(cohen_d(Uren_studeren_T0, Uren_studeren_T1))
```
<!-- ## OPENBLOK: Cohens-d-test.py -->

<!-- ## CLOSEDBLOK: Cohens-d-test.py -->
```{python}
d = cohen_d(Uren_studeren_T0, Uren_studeren_T1)
```
<!-- ## /CLOSEDBLOK: Cohens-d-test.py -->

<!-- ## TEKSTBLOK: Cohens-d-test.py -->
*d* = `r Round_and_format(py$d)`. De sterkte van het effect van de tutor op het cijfer is minimaal. 
<!-- ## /TEKSTBLOK: Cohens-d-test.py -->

<!-- ## TEKSTBLOK: Rapportage.py -->
Een *gepaarde t-toets* is uitgevoerd om te toetsen of het gemiddeld aantal uur studeren van de studenten is veranderd na deelname aan de cursus 'Plannen'. Het verschil tussen het gemiddelde van T~0~ (*M~T0~* = `r Round_and_format(py$vMean_t0)`, *SD~T0~* = `r Round_and_format(py$vSD_t0)`) en het gemiddelde van T~1~ (*M~T1~* =`r Round_and_format(py$vMean_t1)`, *SD~T1~* = `r Round_and_format(py$vSD_t1)`) is significant, *t* ~`r py$df`~ = `r Round_and_format(py$stat)`, *p* < 0,01. Gemiddeld studeren de studenten `r Round_and_format(py$absoluut_verschil)` uur meer na deelname aan de cursus. 
Het valt op dat het gemiddelde van T~1~ hoger is dan van T~0~. Het effect is groot, *d* = `r Round_and_format(py$d)`. 

| Meting     | N         | M            | SD         |
| --------   | --------- | ------------ | ---------- |
| T~0~       | `r py$vN_t0` | `r Round_and_format(py$vMean_t0)` | `r Round_and_format(py$vSD_t0)` |
| T~1~       | `r py$vN_t1` | `r Round_and_format(py$vMean_t1)` | `r Round_and_format(py$vSD_t1)` |
<!-- ## /TEKSTBLOK: Rapportage.py -->

<!-- ## TEKSTBLOK: Extra-Bron.py -->
[^11]: De geschreven Python functie voor Cohen's D is verkregen vanuit de volgende pagina op [Stackoverflow](https://stackoverflow.com/questions/21532471/how-to-calculate-cohens-d-in-python)
<!-- ## /TEKSTBLOK: Extra-Bron.py -->

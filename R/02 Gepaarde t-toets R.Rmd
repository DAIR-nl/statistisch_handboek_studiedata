---
title: "Gepaarde t-toets"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: 
      collapsed: FALSE 
    number_sections: true
  keywords: [statistisch handboek, studiedata]
---

<!-- ## CLOSEDBLOK: Functies.R -->
```{r functies, include = TRUE, echo = FALSE, results='asis', warning=FALSE, message=FALSE}
library(here)
if (!exists("Substitute_var")) {
  ## Installeer packages en functies
  source(paste0(here::here(), "/99. Functies en Libraries/00. Voorbereidingen.R"), echo = FALSE)
}
```
<!-- ## /CLOSEDBLOK: Functies.R -->

<style>
`r htmltools::includeHTML(paste0(here::here(),"/01. Includes/css/Stylesheet_SHHO.css"))`
</style>

<!-- ## CLOSEDBLOK: Header.R -->
```{r header, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Header.R"))} 
```
<!-- ## /CLOSEDBLOK: Header.R -->

<!-- ## CLOSEDBLOK: Reticulate.R -->

<!-- ## /CLOSEDBLOK: Reticulate.R -->

```{r opmerking, include=FALSE, eval=FALSE}
# doorlinken naar de Wilcoxon Signed Rank Test
# linken naar blz transformeren data 
```

<!-- ## OPENBLOK: Data-aanmaken.R -->
```{r aanmaken data, include=FALSE, echo=TRUE}
source(paste0(here::here(),"/01. Includes/data/02.R"))
```
<!-- ## /OPENBLOK: Data-aanmaken.R -->

# Toepassing
Gebruik de *gepaarde t-toets* om te toetsen of bij een herhaalde meting de gemiddelden van een groep van elkaar verschillen.[^1] 


# Onderwijscasus
<div id ="casus">
Voor het verminderen van de studielast van studenten aan een universiteit biedt deze universiteit cursussen plannen aan. De cursussen zijn bedoeld om studenten beter inzicht te geven in de gevolgen van de planning van hun studielast. De cursus wordt tussen twee onderwijsperiodes in gegeven. Voor en na de cursus moeten de studenten gedurende een onderwijsperiode een logboek bijhouden over hun studiegedrag. Gaan de studenten gemiddeld meer studeren of juist minder?

*H~0~*: Het gemiddeld aantal uren studeren per onderwijsperiode verandert niet na de cursus, µ~T0~ = µ~T1~  

*H~A~*: Het gemiddeld aantal uren studeren per onderwijsperiode verandert na de cursus, µ~T0~ ≠ µ~T1~ 
</div>

# Assumpties
Om een valide resultaat te bereiken moeten, voordat de toets kan worden uitgevoerd, de data aan een aantal voorwaarden voldoen.

## Normaliteit
De *t-toets* gaat ervan uit dat de data normaal verdeeld zijn voor elke groep. Ga er bij een *n* > 100 vanuit dat de *t-toets* robuust genoeg is om uit te voeren zonder dat de data een normale verdeling volgt.[^2]   

Controleer de assumptie van normaliteit met de volgende stappen:  
1. controleer de data visueel met een histogram, een Q-Q plot of een boxplot.  
2. Toets of de data normaal verdeeld zijn met de *Kolmogorov-Smirnov test* of bij een kleinere steekproef (n < 50) met de *Shapiro-Wilk test*.[^3]<sup>, </sup>[^4]  

Als blijkt dat de data niet normaal verdeeld zijn, transformeer de data eventueel en bepaal daarna of deze wel normaal verdeeld is of gebruik de *Wilcoxon Signed Rank Test*.[^5]<sup>, </sup>[^6]



# Uitvoering
<!-- ## TEKSTBLOK: Dataset-inladen.R-->
Er is een dataset ingeladen met het gemiddeld aantal uren studeren voor (T~0~) en na (T~1~) de cursus. De gemiddeldes per onderwijsperiode zijn afgerond op 1 decimaal in de dataset `Studielogboek`. 
<!-- ## /TEKSTBLOK: Dataset-inladen.R-->

## De data bekijken
<!-- ## TEKSTBLOK: Data-bekijken.R -->
Gebruik `head()` en `tail()` om de structuur van de data te bekijken.
<!-- ## /TEKSTBLOK: Data-bekijken.R -->
<!-- ## OPENBLOK: Data-bekijken.R -->
```{r data bekijken, collapse = TRUE}
## Eerste 6 observaties
head(Studielogboek)

## Laatste 6 observaties
tail(Studielogboek)
```
<!-- ## /OPENBLOK: Data-bekijken.R -->

Selecteer beide groepen en sla deze op in een vector om deze makkelijker aan te kunnen roepen.
<!-- ## OPENBLOK: Data-selecteren.R -->
```{r data selecteren}
Uren_studeren_T0 <-Studielogboek[Studielogboek$Meetmoment=="T0", 2]
Uren_studeren_T1 <- Studielogboek[Studielogboek$Meetmoment=="T1", 2]
```
<!-- ## /OPENBLOK: Data-selecteren.R -->
<div class = "col-container">
  <div class ="col">
<!-- ## OPENBLOK: Data-beschrijven-1.R -->
```{r data beschrijven t1, collapse = TRUE}
## aantallen, gemiddelde en standaarddeviatie voor cursus
length(Uren_studeren_T0)
mean(Uren_studeren_T0)
sd(Uren_studeren_T0)
```
<!-- ## /OPENBLOK: Data-beschrijven-1.R -->
  </div>
  <div class = "col">
<!-- ## OPENBLOK: Data-beschrijven-2.R -->
```{r data bekijken t2, collapse=TRUE}
## aantallen, gemiddelde en standaarddeviatie na cursus
length(Uren_studeren_T1)
mean(Uren_studeren_T1)
sd(Uren_studeren_T1)
```
<!-- ## /OPENBLOK: Data-beschrijven-2.R -->
  </div>
</div>
<!-- ## CLOSEDBLOK: Data-beschrijven.R -->
```{r Var beschrijven, include=FALSE, echo=TRUE}
vMean_t0 <- Round_and_format(mean(Uren_studeren_T0))
vSD_t0 <-Round_and_format(sd(Uren_studeren_T0))
vN_t0 <- Round_and_format(length(Uren_studeren_T0))
vMean_t1 <- Round_and_format(mean(Uren_studeren_T1))
vSD_t1 <- Round_and_format(sd(Uren_studeren_T1))
vN_t1 <- Round_and_format(length(Uren_studeren_T1))
```
<!-- ## /CLOSEDBLOK: Data-beschrijven.R -->
<!-- ## TEKSTBLOK: Data-beschrijven.R -->
* Gemiddeld uren studeren T~0~ (standaardafwijking): `r vMean_t0` (`r vSD_t0`). *n* = `r vN_t0`.
* Gemiddeld uren studeren T~1~ (standaardafwijking): `r vMean_t1` (`r vSD_t1`). *n* = `r vN_t1`.

<!-- ## /TEKSTBLOK: Data-beschrijven.R -->

## Visuele inspectie van normaliteit
Geef normaliteit visueel weer met een histogram, Q-Q plot of boxplot.

### Histogram
<!-- ## OPENBLOK: Histogram.R -->
```{r histogram}
## Histogram met ggplot2
library(ggplot2)

ggplot(Studielogboek,
  aes(x = Uren_studeren)) +
  geom_histogram(aes(y = ..density..),
                 binwidth = 4,
                 color = "grey30",
                 fill = "#0089CF") +
  facet_wrap(~ Meetmoment) +
  geom_density(alpha = .2, adjust = 1) +
  ylab("Frequentiedichtheid") +
  scale_x_continuous(
    labels = as.character(seq(0, 60, 4)),
    breaks = seq(0, 60, 4)) +
  coord_fixed(ylim = c(0, 0.05),
              xlim = c(0, 60),
              ratio = 1000) +
  labs(title = "Gemiddeld uren studeren voor en na cursus")
```
<!-- ## /OPENBLOK: Histogram.R -->

Beide histogrammen hebben wat weg van een Bell Curve en zouden normaal verdeeld kunnen zijn: veel waardes liggen rondom de gemiddeldes. 

### Q-Q plot
<!-- ## TEKSTBLOK: QQplot.R-->
Gebruik `qqnorm()` en `qqline()` met `pch = 1`om een Q-Q plot te maken, met als datapunten kleine cirkels.
<!-- ## /TEKSTBLOK: QQplot.R-->

Als over het algemeen de meeste datapunten op de lijn liggen, kan aangenomen worden dat de data normaal verdeeld zijn.

<div class = "col-container">
  <div class="col">
<!-- ## OPENBLOK: QQplot-1.R -->
```{r qqplot-1}
qqnorm(Uren_studeren_T0, 
       pch = 1,
       main = "Normaal Q-Q plot studielogboek voor cursus",
       ylab = "kwantielen in data",
       xlab = "Theoretische kwantielen")
qqline(Uren_studeren_T0)
```
<!-- ## /OPENBLOK: QQplot-1.R -->
  </div>
  <div class = "col">
<!-- ## OPENBLOK: QQplot-2.R -->
```{r qqplot-2}
qqnorm(Uren_studeren_T1, 
       pch = 1,
       main = "Normaal Q-Q plot studielogboek na cursus",
       ylab = "kwantielen in data",
       xlab = "Theoretische kwantielen")
qqline(Uren_studeren_T1)
```
<!-- ## /OPENBLOK: QQplot-2.R -->
  </div>
</div>

In deze casus liggen de meeste punten op de lijn behalve bij de uiteinden. Dit zou kunnen liggen aan de onder- en bovengrens van het aantal studieuren. Doordat er een beperkt aantal uren in een week zitten en daarmee een limiet is aan het aantal studieuren, vallen de hoogste datapunten niet meer perfect op de lijn van de normaalverdeling. Vergelijkbaar liggen de laagste datapunten ook niet meer perfect op de lijn omdat alle studenten minimaal 8 uur studeren. 

### Boxplot
De box geeft de middelste 50% van het studielogboek weer. De zwarte lijn binnen de box is de mediaan. In de staarten zitten de eerste 25% en de laatste 25%. Cirkels visualiseren mogelijke uitbijters.[^8] Hoe meer de boxen overlappen, hoe waarschijnlijker er geen significant verschil is tussen de groepen.   

<!-- ## OPENBLOK: Boxplot.R -->
``` {r Boxplot}
## Boxplot
boxplot(Uren_studeren ~ Meetmoment, Studielogboek,
        main = "Boxplot van studielogboek")
```
<!-- ## /OPENBLOK: Boxplot.R -->

De boxplotten geven de spreiding weer van het gemiddelde aantal uur studeren per periode voor deelnemers aan de cursus. De boxplot en de staarten van T~0~ zijn niet helemaal symmetrisch, maar beide uiteinden zijn ongeveer even lang en de mediaan ligt ongeveer in het midden, daarom zijn de data vermoedelijk normaal verdeeld. De boxplot van T~1~ ziet er symmetrisch uit. Er zijn een aantal mogelijke uitbijters.[^9]

Op basis van de grafieken lijken er geen grote afwijkingen van de normaalverdeling voor de studieuren in beide groepen te zijn. Maar normaliteit kan ook getest worden met statistische toetsen.

```{r opmerking2, include=FALSE, eval=FALSE}
# Irene, is dit goed
```

## Toetsen van normaliteit
Om te controleren of de data normaal verdeeld zijn, kan de normaliteit getoetst worden. Twee veelgebruikte toetsen zijn: de *Kolmogorov-Smirnov test* en de *Shapiro-Wilk test*.


### Kolmogorov-Smirnov 
De *Kolmogorov-Smirnov test* toetst het verschil tussen twee verdelingen. Standaard toetst deze test het verschil tussen een normale verdeling en de verdeling van de steekproef. De Lilliefors correctie wordt gebruikt als het gemiddelde en de standaardafwijking niet van tevoren bekend of bepaald zijn. Als de p < 0,05 is, is de verdeling van de data statistisch significant verschillend van de normale verdeling.

<!-- ## TEKSTBLOK: Lilliefors-test1.py -->

<!-- ## /TEKSTBLOK: Lilliefors-test1.py -->

<!-- ## OPENBLOK: Library-nortest.R -->
```{r library nortest, warning=FALSE}
library(nortest)
```
<!-- ## /OPENBLOK: Library-nortest.R -->
<div class="col-container">
  <div class = "col">
<!-- ## OPENBLOK: Lilliefors-test-1.R -->
``` {r Lilliefors Test-1, warning=FALSE}
lillie.test(Uren_studeren_T0)
```
<!-- ## /OPENBLOK: Lilliefors-test-1.R -->
  </div>
  <div class = "col">
<!-- ## OPENBLOK: Lilliefors-test-2.R -->
``` {r Lilliefors Test-2, warning=FALSE}
lillie.test(Uren_studeren_T1)
```
<!-- ## /OPENBLOK: Lilliefors-test-2.R -->
  </div>
</div>

Van beide groepen is de p > 0,05; er is geen statistisch significant verschil gevonden tussen de verdeling van de steekproef en de normale verdeling. De *gepaarde t-toets* kan uitgevoerd worden. 

### Shapiro-Wilk Test
De *Shapiro-Wilk test* is een soortgelijke test als de *Kolmogorov-Smirnov test* en wordt vooral gebruikt bij kleine steekproeven (n < 50). Als de p < 0,05 is, is de verdeling van de data significant verschillend van de normale verdeling.
<!-- ## TEKSTBLOK: Shapiro-Wilk-test.R -->
Er zijn 2 steekproeven van `Studielogboek` ingeladen: `Uren_studeren_T0_n30` (T~0~) en `Uren_studeren_T1_n30` (T~1~), *n~T0~* = `r length(Uren_studeren_T0_n30)` , *n~T1~* = `r length(Uren_studeren_T1_n30)` 
<!-- ## /TEKSTBLOK: Shapiro-Wilk-test.R -->
<div class ="col-container">
  <div class ="col">
<!-- ## OPENBLOK: Shapiro-Wilk-test-1.R -->
``` {r Shapiro-Wilk Test-1, warning=FALSE}
shapiro.test(Uren_studeren_T0_n30)
```
<!-- ## /OPENBLOK: Shapiro-Wilk-test-1.R -->
  </div>
  <div class ="col">
<!-- ## OPENBLOK: Shapiro-Wilk-test-2.R -->
``` {r Shapiro-Wilk Test-2, warning=FALSE}
shapiro.test(Uren_studeren_T1_n30)
```
<!-- ## /OPENBLOK: Shapiro-Wilk-test-2.R -->
  </div>
</div>

Voor beide groepen is de *p* > 0,05, dus er is geen statistisch significant verschil gevonden tussen de verdeling van de steekproef en de normale verdeling. De *gepaarde t-toets* kan uitgevoerd worden.  

## Gepaarde t-toets
<!-- ## TEKSTBLOK: T-test.R -->
Gebruik `t.test()`. Om aan te geven dat de twee meetmomenten aan elkaar gepaard zijn gebruik het argument `paired = TRUE` om een *gepaarde t-toets* uit te voeren. Gebruik hier weer het hele dataframe `Studielogboek`. 
<!-- ## /TEKSTBLOK: T-test.R -->
De *gepaarde t-toets* wordt uitgevoerd om de vraag te beantwoorden of het gemiddeld aantal uren studeren verandert na deelname aan de cursus. De verwachting is dat de studenten gemiddeld meer gaan studeren, maar omdat het relevant is om te weten of de studenten meer of minder gaan studeren na de cursus is er voor gekozen om tweezijdig te toetsen. 

<!-- ## OPENBLOK: T-toets.R -->
```{r T-test}
t.test(Uren_studeren ~ Meetmoment, Studielogboek, 
       paired = TRUE,
       alternative = "two.sided")
```
<!-- ## /OPENBLOK: T-toets.R -->
<!-- ## CLOSEDBLOK: T-test.R -->
```{r T-test als object, echo = FALSE}
t <- t.test(Uren_studeren ~ Meetmoment, Studielogboek, paired = TRUE)
vT_waarde <- Round_and_format(t$statistic)
vN <- t$parameter + 1
vDF <- t$parameter
vconf.int1 <- Round_and_format(t$conf.int[1])
vconf.int2 <- Round_and_format(t$conf.int[2])
vDiffMean <- Round_and_format(t$estimate*-1)
```
<!-- ## /CLOSEDBLOK: T-test.R -->
<!-- ## TEKSTBLOK: T-test2.R -->
* *t*~`r vDF`~ = `r vT_waarde`, *p* < 0,05
* Vrijheidsgraden, *df* = *n* -1 = `r vN`-1 = `r vDF`  
* p-waarde < 0,05, dus de H~0~ wordt verworpen [^10]
* 95%-betrouwbaarheidsinterval: met 95% zekerheid ligt het daadwerkelijke verschil tussen het aantal studieuren voor en na de cursus,  µ~verschil~ = µ~T1~ - µ~T0~, in dit interval. In deze casus is het interval tussen `r vconf.int1` en `r vconf.int2`. In dit interval zit geen 0, hieraan is te zien dat er met 95% zekerheid een significant verschil is tussen µ~T1~ en µ~T0~.
* het absolute verschil tussen de twee groepen: `r vDiffMean`.
<!-- ## /TEKSTBLOK: T-test2.R -->

### Effectmaat: Cohen's d
De p-waarde geeft aan of het verschil tussen twee groepen statistisch significant is. Bereken de effectmaat om te bepalen of het gevonden verschil betekenisvol is. Een veel gebruikte effectmaat is Cohen's *d*. Cohen's *d* geeft de sterkte van het effect van een onafhankelijke variabele, de cursus plannen, op een afhankelijke variabele, het aantal uur studeren, weer.  
Een indicatie om *d* te interpreteren is: rond 0,3 is een klein effect, rond 0,5 is een gemiddeld effect en rond 0,8 is een groot effect.[^7]  

Gebruik `cohen.d()` met `paired = TRUE` om de effectgrootte te meten.
<!-- ## OPENBLOK: Cohens-d-test.R -->
```{r Cohens d}
library(effsize)
cohen.d(Uren_studeren ~ Meetmoment, Studielogboek, paired = TRUE)
```
<!-- ## /OPENBLOK: Cohens-d-test.R -->

<!-- ## CLOSEDBLOK: Cohens-d-test.R -->
```{r var Cohens d, include = FALSE}
d <- cohen.d(Uren_studeren ~ Meetmoment, Studielogboek, paired = TRUE)
vD_waarde <- Round_and_format(d$estimate)
```
<!-- ## CLOSEDBLOK: Cohens-d-test.R -->

<!-- ## TEKSTBLOK: Cohens-d-test.R -->
*d* = `r vD_waarde`. De sterkte van het effect van de tutor op het cijfer is minimaal. 
<!-- ## /TEKSTBLOK: Cohens-d-test.R -->

# Rapportage
<!-- ## TEKSTBLOK: Rapportage.R -->
Een *gepaarde t-toets* is uitgevoerd om te toetsen of het gemiddeld aantal uur studeren van de studenten is veranderd na deelname aan de cursus. Het verschil tussen het gemiddelde van T~0~ (*M~T0~* = `r vMean_t0`, *SD~T0~* = `r vSD_t0`) en het gemiddelde van T~1~ (*M~T1~* =`r vMean_t1`, *SD~T1~* = `r vSD_t1`) is significant, *t* ~`r vDF`~ = `r vT_waarde`, *p* < 0,01. Het 95% betrouwbaarheidsinterval voor het verschil tussen het gemiddelde van beide groepen is van `r vconf.int1` tot `r vconf.int2`. Het valt op dat het gemiddelde van T~1~ hoger is dan van T~0~. Het effect is echter minimaal klein, *d* = `r vD_waarde`. 


| Meting     | N         | M            | SD         |
| --------   | --------- | ------------ | ---------- |
| T~0~       | `r vN_t0` | `r vMean_t0` | `r vSD_t0` |
| T~1~       | `r vN_t1` | `r vMean_t1` | `r vSD_t1` |
<!-- ## /TEKSTBLOK: Rapportage.R -->
*Tabel 1. Groepsgrootte, gemiddeld tentamencijfer en standaarddeviatie per meetmoment*

Aan de hand van de resultaten kan geconcludeerd worden dat de studenten, na deelname aan de cursus, meer tijd besteden aan hun studie dan daarvoor. Het effect is minimaal.  

<!-- ## CLOSEDBLOK: Footer.R -->
```{r footer, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Footer.R"))}
```
<!-- ## /CLOSEDBLOK: Footer.R -->

[^1]: Wikipedia (21 augustus 2019). *Student's t-test*. [Wikipedia](https://en.wikipedia.org/wiki/student%27s_t-test).
[^2]: Lumley, T., Diehr, P., Emerson, S., & Chen, L. (2002). The importance of the normality assumption in large public health data sets. *Annu Rev Public Health, 23*, 151-69. doi: 10.1146/annurev.publheath.23.100901.140546 http://rctdesign.org/techreports/arphnonnormality.pdf 
[^3]: Van Geloven, N. (25 september2013). *Wilcoxon signed rank toets*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Wilcoxon_signed_rank_toets).
[^4]: Laerd statistics (2018). *Testing for Normality using SPSS Statistics*. [Testing for Normality using SPSS Statistics](https://statistics.laerd.com/spss-tutorials/testing-for-normality-using-spss-statistics.php).  
[^5]: Universiteit van Amsterdam (14 juli 2014). *Normaliteit*. [UvA Wiki Methodologiewinkel](https://wiki.uva.nl/methodologiewinkel/index.php/Normaliteit).  
[^6]: De *Wilcoxon signed rank toets* maakt een rangschikking van de data. Hierdoor is de test verdelingsvrij en is normaliteit geen assumptie. Ook zijn uitbijters minder van invloed op het eindresultaat. Toch wordt er voor deze test minder vaak gekozen, dit komt doordat bij het maken van een rankschikking de data informatie verliest. Als de data wel normaal verdeeld zijn heeft de *Wilcoxon signed rank toets* minder onderscheidend vermogen, dan wanneer de *one sample t-toets* uitgevoerd zou worden.  
[^7]: Marshall, E., & Boggis, E. (2016). *The statistics tutor’s quick guide to commonly used statistical tests*. http://www.statstutor.ac.uk/resources/uploaded/tutorsquickguidetostatistics.pdf 
[^8]: Outliers (13 augustus 2016). [UvA Wiki Methodologiewinkel](https://wiki.uva.nl/methodologiewinkel/index.php/Outliers).
[^9]: Uitbijters kunnen bepalend zijn voor de uitkomst van toetsen. Bekijk of de uitbijters valide uitbijters zijn en niet een meetfout of op een andere manier incorrect verkregen data. Het weghalen van uitbijters kan de uitkomst ook vertekenen, daarom is het belangrijk om verwijderde uitbijters te melden in een rapport. 
[^10]: In dit voorbeeld wordt uitgegaan van een waarschijnlijkheid van 95% en c.q. een p-waardegrens van 0,05. De grens is naar eigen inzicht aan te passen, houd hierbij rekening met type I en type II fouten.
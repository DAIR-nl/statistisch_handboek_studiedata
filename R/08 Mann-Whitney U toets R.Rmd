---
title: "Mann-Whitney U toets"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: 
      collapsed: FALSE 
    number_sections: true
    includes:
      in_header: ["../01. Includes/html/favicon.html", "../01. Includes/html/analytics.html"]
  keywords: [statistisch handboek, studiedata]
---
<!-- ## CLOSEDBLOK: Functies.R -->
```{r functies, include = TRUE, echo = FALSE, results='asis', warning=FALSE, message=FALSE}
library(here)
if (!exists("Substitute_var")) {
  ## Installeer packages en functies
  source(paste0(here::here(), "/99. Functies en Libraries/00. Voorbereidingen.R"), echo = FALSE)
}
```
<!-- ## /CLOSEDBLOK: Functies.R -->

<!-- ## CLOSEDBLOK: CSS -->
<style>
`r htmltools::includeHTML(paste0(here::here(),"/01. Includes/css/Stylesheet_SHHO.css"))`
</style>
<!-- ## /CLOSEDBLOK: CSS -->

<!-- ## CLOSEDBLOK: Header.R -->
```{r header, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Header.R"))} 
```
<!-- ## /CLOSEDBLOK: Header.R -->

<!-- ## CLOSEDBLOK: Status.R -->
```{r status, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Status.R"))} 
```
<!-- ## /CLOSEDBLOK: Status.R -->

<!-- ## CLOSEDBLOK: Reticulate.R -->

<!-- ## /CLOSEDBLOK: Reticulate.R -->

<!-- ## OPENBLOK: Data-aanmaken.R -->
```{r aanmaken data, include=FALSE, echo=TRUE}
source(paste0(here::here(),"/01. Includes/data/08.R"))
```
<!-- ## /OPENBLOK: Data-aanmaken.R -->
# Toepassing
Gebruik de *Mann-Whitney U toets* om te toetsen of twee onafhankelijke groepen significant van elkaar verschillen. 

Deze toets wordt ook *Mann–Whitney–Wilcoxon*, *Wilcoxon rank-sum toets*, of *Wilcoxon–Mann–Whitney toets* genoemd.[^1] Niet te verwarren met de *Wilcoxon Signed Rank Test* die toetst of twee afhankelijke groepen significant van elkaar verschillen. 

De *Mann-Whitney U toets* kan een alternatief zijn voor de *ongepaarde t-toets*. De *Mann-Whitney U toets* stelt minder eisen aan de data en hoeft onder andere niet te voldoen aan de assumptie van normaliteit. Bij de *Mann-Whitney U toets* hebben uitbijters minder invloed op het eindresultaat dan bij de *ongepaarde t-toets*. Daarentegen, als de data wel normaal verdeeld zijn heeft de *Mann-Whitney U toets* minder onderscheidend vermogen dan de *ongepaarde t-toets*.[^2] Vandaar dat ondanks de voordelen er toch minder vaak voor de *Mann-Whitney U toets* gekozen wordt. 

# Onderwijscasus
<div id ="casus">
De onderwijsdirecteur van de opleiding Business Administration van een hogeschool vraagt zich af of er verschil is in de studieresultaten van studenten met een Nederlandse vooropleiding en een buitenlandse vooropleiding. Met name in het tweede studiejaar lijken er verschillen op te treden die hij wil begrijpen om mogelijke interventies met zijn docenten te bespreken. Hij vraagt zich af: ‘Verschilt het aantal studiepunten in het tweede studiejaar van studenten met een Nederlandse vooropleiding van het aantal studiepunten in het tweede studiejaar van studenten met een buitenlandse vooropleiding?

*H~0~*: De verdeling van het behaalde aantal studiepunten in het tweede jaar van studenten met een buitenlandse vooropleiding is hetzelfde als de verdeling van studenten met een Nederlandse vooropleiding. 

*H~A~*: De verdeling van het behaalde aantal studiepunten in het tweede jaar van studenten met een buitenlandse vooropleiding is anders als de verdeling van studenten met een Nederlandse vooropleiding.
</div>

# Assumpties
Voor een valide resultaat moeten de data aan een aantal voorwaarden voldoen voordat de toets uitgevoerd kan worden: de data zijn ordinaal of numeriek, de groepen zijn onafhankelijk van elkaar [^3] en het aantal groepen is twee. Gebruik bij meer dan twee groepen de *Kruskal Wallis toets*.

# Effectmaat

De p-waarde geeft aan of het verschil tussen twee groepen statistisch significant is. De grootte van het verschil of effect is echter ook relevant. Een effectmaat is een gestandaardiseerde maat die de grootte van een effect weergeeft zodat effecten vergeleken kunnen worden voor verschillende onderzoeken.[^3] 
De *Mann-Whitney U toets* heeft als effectmaat *r*.[^4] Een indicatie om *r* te interpreteren is: rond 0,1 is het een klein effect, rond 0,3 is het een gemiddeld effect en rond 0,5 is het een groot effect.[^5]

# Uitvoering 
<!-- ## TEKSTBLOK: Dataset-inladen.R-->
Er is een dataset `Studiepunten_studiejaar2` ingeladen met het aantal punten dat studenten in het tweede jaar halen.
<!-- ## /TEKSTBLOK: Dataset-inladen.R-->

## De data bekijken
<!-- ## TEKSTBLOK: Data-bekijken.R -->
Gebruik `head()` en `tail()` om de structuur van de data te bekijken.
<!-- ## /TEKSTBLOK: Data-bekijken.R -->
<!-- ## OPENBLOK: Data-bekijken.R -->
```{r data bekijken, collapse = TRUE}
## Eerste 6 observaties
head(Studiepunten_studiejaar2)
## Eerste 6 observaties
tail(Studiepunten_studiejaar2)
```
<!-- ## /OPENBLOK: Data-bekijken.R -->
<!-- ## TEKSTBLOK: Data-beschrijven.R -->
Bekijk de grootte, de mediaan en de kwantielen van het aantal studiepunten met `length()` en `quantile()`.
<!-- ## /TEKSTBLOK: Data-beschrijven.R -->
<!-- ## OPENBLOK: Data-selecteren.R -->
```{r data selecteren}
Vooropleiding_Nederlands <- Studiepunten_studiejaar2$Vooropleiding == "Nederlands"
```
<!-- ## /OPENBLOK: Data-selecteren.R -->

<!-- ## OPENBLOK: Numpy-inladen.R -->

<!-- ## /OPENBLOK: Numpy-inladen.R -->

<div class="col-container">
  <div class="col">
<!-- ## OPENBLOK: Data-beschrijven-1.R -->
```{r, data beschrijven 1, collapse=TRUE}
length(Studiepunten_studiejaar2$Studiepunten[Vooropleiding_Nederlands])
quantile(Studiepunten_studiejaar2$Studiepunten[Vooropleiding_Nederlands])
```
<!-- ## /OPENBLOK: Data-beschrijven-1.R -->
  </div>
  <div class="col">
<!-- ## OPENBLOK: Data-beschrijven-2.R -->
``````{r Data beschrijven 2, collapse=TRUE}
length(Studiepunten_studiejaar2$Studiepunten[!Vooropleiding_Nederlands])
quantile(Studiepunten_studiejaar2$Studiepunten[!Vooropleiding_Nederlands])
```
<!-- ## /OPENBLOK: Data-beschrijven-2.R -->
  </div>
</div>
<!-- ## CLOSEDBLOK: Data-beschrijven-3.R -->
``` {r data beschrijven als object, include=FALSE, echo=TRUE}
## Onderstaand zijn de dynamische variabelen te vinden
library(dplyr)

x <- group_by(Studiepunten_studiejaar2, Vooropleiding) %>%
  summarise(
    N = n(),
    Q1 = quantile(Studiepunten)[2],
    Mediaan = median(Studiepunten),
    Q3 = quantile(Studiepunten)[4]
  )

vN_NL <- Round_and_format(x[2,2])
vN_Inter <- Round_and_format(x[1,2])

vQ1_NL <- Round_and_format(x[2,3])
vQ1_Inter <- Round_and_format(x[1,3])

vMed_NL <- Round_and_format(x[2,4])
vMed_Inter <- Round_and_format(x[1,4])

vQ3_NL <- Round_and_format(x[2,5])
vQ3_Inter <- Round_and_format(x[1,5])
```
<!-- ## /CLOSEDBLOK: Data-beschrijven-3.R -->

<!-- ## TEKSTBLOK: Data-beschrijven2.R -->
* Mediaan studenten Nederlandse vooropleiding: `r vMed_NL`. *n* = `r vN_NL`.
* Mediaan studenten buitenlandse vooropleiding: `r vMed_Inter`. *n* = `r vN_Inter`.

<!-- ## /TEKSTBLOK: Data-beschrijven2.R -->

## Mann-Whitney U toets
<!-- ## TEKSTBLOK: Mann-Whitney-U-toets-1.R -->
Gebruik `wilcox.test()` om een *Mann-Whitney U toets* te doen. Het eerste argument bevat het aantal studiepunten van studenten met een Nederlandse vooropleiding `Studiepunten_studiejaar2$Studiepunten[Vooropleiding_Nederlands]`; het tweede argument het aantal studiepunten van studenten met een buitenlandse vooropleiding `Studiepunten_studiejaar2$Studiepunten[!Vooropleiding_Nederlands]`. Voer daarna de argument `paired = FALSE` omdat de steekproeven ongepaard zijn, het argument `alternative = "two.sided" ` vanwege de tweezijdige alternatieve hypothese en
het argument `conf.int = TRUE` om een schatting met bijbehorend betrouwbaarheidsinterval te geven voor de mediaan 
van de verschilscores.[^6]<sup>,</sup>[^7]
<!-- ## /TEKSTBLOK: Mann-Whitney-U-toets-1.R -->

<!-- ## OPENBLOK: Mann-Whitney-U-toets-2.R -->
```{r Mann Whitney U toets}
wilcox.test(Studiepunten_studiejaar2$Studiepunten[Vooropleiding_Nederlands], 
            Studiepunten_studiejaar2$Studiepunten[!Vooropleiding_Nederlands],
            paired = FALSE,
            alternative = "two.sided",
            conf.int = TRUE)
```
<!-- ## /OPENBLOK: Mann-Whitney-U-toets-2.R -->
<!-- ## CLOSEDBLOK: Mann-Whitney-U-toets-3.R -->
```{r Mann Whitney U toets als object, include = FALSE}
wcx <- wilcox.test(Studiepunten_studiejaar2$Studiepunten[Vooropleiding_Nederlands], 
            Studiepunten_studiejaar2$Studiepunten[!Vooropleiding_Nederlands],
            paired = FALSE,
            alternative = "two.sided",
            conf.int = TRUE)
vW_W <- Round_and_format_0decimals(wcx$statistic)
vW_P <- Round_and_format(wcx$p.value)
vW_est <- Round_and_format(wcx$estimate)
vW_lb <- Round_and_format(wcx$conf.int[1])
vW_ub <- Round_and_format(wcx$conf.int[2])
```
<!-- ## /CLOSEDBLOK: Mann-Whitney-U-toets-3.R -->

<!-- ## OPENBLOK: Mann-Whitney-U-toets-4.R -->
Bereken vervolgens de effectmaat *r* op basis van de *p*-waarde van de *Mann-Whitney U toets*.
```{r effectgrootte}
# Sla de p-waarde op
pwaarde <- wilcox.test(Studiepunten_studiejaar2$Studiepunten[Vooropleiding_Nederlands], 
            Studiepunten_studiejaar2$Studiepunten[!Vooropleiding_Nederlands],
            paired = FALSE,
            alternative = "two.sided",
            conf.int = TRUE)$p.value

# Bereken de effectgrootte van de tweezijdige toets
r <- qnorm(pwaarde/2) / sqrt(nrow(Studiepunten_studiejaar2))
# Bereken de effectgrootte van de eenzijdige toets
#r <- qnorm(pwaarde) / sqrt(nrow(Studiepunten_studiejaar2))

# Print de effectmaat
paste("De effectmaat is", abs(r))

```
<!-- ## /OPENBLOK: Mann-Whitney-U-toets-4.R -->

<!-- ## TEKSTBLOK: Mann-Whitney-U-toets-4.R -->
* *W* = `r vW_W`, *p* = < 0,0001, *r* = `r Round_and_format(abs(r))`
* *p*-waarde < 0,05, dus de H~0~ wordt niet verworpen.[^8]
* Effectmaat is `r Round_and_format(abs(r))`, dus een klein tot gemiddeld effect
* De mediaan van de verschilscores is `r vW_est` met een 
95%-betrouwbaarheidsinterval  van `r vW_lb` tot `r vW_ub`
<!-- ## /TEKSTBLOK: Mann-Whitney-U-toets-4.R -->


# Rapportage
<!-- ## TEKSTBLOK: Rapportage.R -->
De *Mann-Whitney U toets* is uitgevoerd om te toetsen of het behaalde aantal studiepunten in het tweede jaar hetzelfde is voor studenten met buitenlandse vooropleiding als voor studenten met Nederlandse vooropleiding. Uit de resultaten kan afgelezen worden dat er een statistisch significant verschil is tussen het aantal studiepunten van studenten met een buitenlandse vooropleiding en met een Nederlandse vooropleiding, *W* = `r vW_W`, *p* < 0,0001, *r* = `r Round_and_format(abs(r))`. Er is een klein tot gemiddeld effect: het verschil in mediaan tussen beide groepen (Nederlandse minus buitenlandse vooropleiding) is geschat op `r vW_est ` met een 95%-betrouwbaarheidsinterval van `r vW_lb` tot `r vW_ub`.  
<!-- ## /TEKSTBLOK: Rapportage.R -->

<!-- ## CLOSEDBLOK: Footer.R -->
```{r footer, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Footer.R"))}
```
<!-- ## /CLOSEDBLOK: Footer.R -->
 
[^1]: Van Geloven, N. (13 maart 2018). *Mann-Whitney U toets*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Mann-Whitney_U_toets).
[^2]: Onderscheidend vermogen, in het Engels power genoemd, is de kans dat de nulhypothese verworpen wordt wanneer de alternatieve hypothese 'waar' is.
[^3]: Field, A., Miles, J., & Field, Z. (2012). *Discovering statistics using R*. London: Sage publications.
[^4]: De effectmaat *r* wordt voor de *Mann-Whitney U toets* berekend door de
*z*-waarde behorend bij de *p*-waarde van de toets te delen door de wortel van
het aantal observaties, i.e. $\frac{z}{\sqrt{N}}$.
[^5]: Elke groep heeft geen overlap met één van de andere groepen en de groepen kunnen elkaars deelname niet beïnvloeden. Deze stap wordt beredeneerd en wordt niet getoetst.
[^6]: De mediaan van de verschilscores kan bij twee ongepaarde steekproeven bijvoorbeeld geschat worden door alle *m x n* verschilscores te berekenen tussen *m* observaties uit de ene steekproef en *n* observaties uit de andere steekproef. De mediaan van deze *m x n* verschilscores is dan de schatting.
[^7]: Wikipedia (10 maart 2020). *Hogdes-Lehmann estimator*.[https://en.wikipedia.org/wiki/Hodges%E2%80%93Lehmann_estimator](https://en.wikipedia.org/wiki/Hodges%E2%80%93Lehmann_estimator) 
[^8]: In dit voorbeeld wordt uitgegaan van een waarschijnlijkheid van 95% c.q. een p-waardegrens van 0,05. De grens is naar eigen inzicht aan te passen; houd hierbij rekening met type I en type II fouten.
---
title: "Mann-Whitney U toets"
author: "© 2019, SURF Versnellingsagenda - Statistisch Handboek Hoger Onderwijs"
date: "`r format(Sys.time(), '%d-%m-%Y')`"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: 
      collapsed: FALSE 
    number_sections: true
  keywords: [statistisch handboek, studiedata]
---

<style>
`r htmltools::includeHTML(paste0(here::here(),"/03. Includes/css/Stylesheet_SHHO.css"))`
</style>

```{r header, include = FALSE, echo = TRUE, results='asis'} 
paste0(here::here(),"/03. Includes/code/Header.R")
```

<!-- ## BLOK: Functiedefinities.R -->
```{r functiedefinities,include=FALSE, echo=TRUE}
library(stringr)
Round_and_format <- function(x, digits = 2) {
  x <- as.character(round(x, digits))
  x <- str_replace(x, "[.]", ",")
  return(x)
}

Round_and_format_0decimals <- function(x, digits = 0) {
  x <- as.character(round(x, digits))
  x <- str_replace(x, "[.]", ",")
  return(x)
}
```
<!-- ## /BLOK: Functiedefinities.R -->

<!-- ## BLOK: Data-aanmaken.R -->
```{r aanmaken data, include=FALSE, echo=TRUE}
## De directeur van een hogeschool vraagt zich af of wat de invloed is van internationalisering op zijn instelling. Hij gebruikt hiervoor het totaal aantal punten behaald in het tweedejaar zodat uitval een minder grote rol speelt. Hij vraagt zich daarom af: is het behaald aantal EC in het tweede jaar van internationale studenten hoger dan van de Nederlandse studenten?
## Effectmaat niet gerapporteerd, ik zie geen overeenstemming van effectmaten bij de MW U 

RNGkind(sample.kind = "Rounding")
set.seed(0)

Goede_student_ec <- c(0, 3, 6, 6, 6, 6, 6, 6, 6)
Matige_student_ec <- c(0, 0, 0, 3, 6, 6, 6, 6, 6)
Slechte_student_ec <- c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6)

Resultaten_nl_studenten <- rbind (
                                  t(replicate(401, sample(Goede_student_ec, 11, replace = TRUE))), 
                                  t(replicate(203, sample(Matige_student_ec, 11, replace = TRUE))),
                                  t(replicate(309, sample(Slechte_student_ec, 11, replace = TRUE))))
Punten_jaar2_NL <- margin.table(Resultaten_nl_studenten, 1)

Resultaten_internationale_studenten <- rbind (
                                  t(replicate(250, sample(Goede_student_ec, 11, replace = TRUE))), 
                                  t(replicate(100, sample(Matige_student_ec, 11, replace = TRUE))),
                                  t(replicate(200, sample(Slechte_student_ec, 11, replace = TRUE))))
Punten_jaar2_inter <- margin.table(Resultaten_internationale_studenten, 1)
Studentnr <- sample(3000000:4000000, length(c(Punten_jaar2_NL, Punten_jaar2_inter)))

Punten_jaar2 <- data.frame(Studentnr, c(Punten_jaar2_NL, Punten_jaar2_inter), 
                           c(rep("ja", length(Punten_jaar2_NL)), rep("nee", length(Punten_jaar2_inter))))
colnames(Punten_jaar2)<-c("Studentnr", "EC_Jaar2", "Nederlands")
Punten_jaar2 <- Punten_jaar2[order(Studentnr),]
```
<!-- ## /BLOK: Data-aanmaken.R -->
# Toepassing
Gebruik de *Mann-Whitney U toets* om te toetsen of twee onafhankelijke groepen[^1] aan elkaar gelijk zijn. Deze toets wordt ook *Mann–Whitney–Wilcoxon*, *Wilcoxon rank-sum toets*, of *Wilcoxon–Mann–Whitney toets* genoemd.[^2]

# Onderwijscasus
<div id ="casus">
De directeur van een hogeschool vraagt zich af wat de invloed is van internationalisering op zijn instelling. Om uitval een minder grote rol te laten spelen gebruikt hij hiervoor het totaal aantal punten behaald in het tweedejaar. Hij vraagt af: ‘Is het behaald aantal EC in het tweede jaar van internationale studenten anders is dan van de Nederlandse studenten?’ 

H~0~: Het behaalde aantal EC in het tweede jaar is hetzelfde van internationale studenten als van Nederlandse studenten. 

H~1~: Het behaalde aantal EC in het tweede jaar is anders van internationale studenten als van Nederlandse studenten.
</div>

# Assumpties
De data zijn nomimaal, ordinaal of numeriek gemeten. De *Mann-Whitney U toets* wordt vaak als alternatief gezien voor de *ongepaarde t-toets*. De *Mann-Whitney U toets* maakt een rangschikking van de data. Hierdoor is de test verdelingsvrij en is normaliteit geen assumptie. Ook zijn uitbijters minder van invloed op het eindresultaat. Toch wordt er voor deze test minder vaak gekozen, dit komt doordat bij het maken van een rankschikking de data informatie verliest. Als de data normaal verdeeld zijn heeft de *Mann-Whitney U toets* minder onderscheidend vermogen, dan wanneer de *ongepaarde t-toets* uitgevoerd zou worden.

# Uitvoering 
Er is data ingeladen met het aantal punten studenten in hun tweede jaar halen. `Punten_jaar2_NL` bevat Nederlandse studenten, `Punten_jaar2_inter` bevat internationale studenten. 

## De data bekijken
Gebruik `head()` in R om de eerste vijf regels te bekijken

<!-- ## BLOK: Data-bekijken.R -->
```{r data bekijken, collapse = TRUE}
## Eerste 6 observaties
head(Punten_jaar2)
## Eerste 6 observaties
tail(Punten_jaar2)
```
<!-- ## /BLOK: Data-bekijken.R -->
Bekijk de grootte, mediaan en kantielen van de data met `length()` en `quantile()`. 
<!-- ## BLOK: Data-selecteren.R -->
```{r data selecteren}
Nederlands <- Punten_jaar2$Nederlands == "ja"
```
<!-- ## /BLOK: Data-selecteren.R -->

<div class="col-container">
  <div class="col">
<!-- ## BLOK: Data-beschrijven-1.R -->
```{r, data beschrijven 1, collapse=TRUE}
length(Punten_jaar2$EC_Jaar2[Nederlands])
quantile(Punten_jaar2$EC_Jaar2[Nederlands])
```
<!-- ## /BLOK: Data-beschrijven-1.R -->
  </div>
  <div class="col">
<!-- ## BLOK: Data-beschrijven-2.R -->
``````{r Data beschrijven 2, collapse=TRUE}
length(Punten_jaar2$EC_Jaar2[!Nederlands])
quantile(Punten_jaar2$EC_Jaar2[!Nederlands])
```
<!-- ## /BLOK: Data-beschrijven-2.R -->
  </div>
</div>
``` {r data beschrijven als object, include=FALSE, echo=TRUE}
## Onderstaand zijn de dynamische variabelen te vinden
library(dplyr)

x <- group_by(Punten_jaar2, Nederlands) %>%
  summarise(
    N = n(),
    Q1 = quantile(EC_Jaar2)[2],
    Mediaan = median(EC_Jaar2),
    Q3 = quantile(EC_Jaar2)[4]
  )

vN_NL <- Round_and_format(x[1,2])
vN_Inter <- Round_and_format(x[2,2])

vQ1_NL <- Round_and_format(x[1,3])
vQ1_Inter <- Round_and_format(x[2,3])

vMed_NL <- Round_and_format(x[1,4])
vMed_Inter <- Round_and_format(x[2,4])

vQ3_NL <- Round_and_format(x[1,5])
vQ3_Inter <- Round_and_format(x[2,5])
```

## Mann-Whitney U toets
Gebruik `wilcox.test()` met twee argumenten om een Mann-Whitney U toets te doen in R
<!-- ## BLOK: Mann-Whitney-U-toets.R -->
```{r Mann Whitney U toets}
wilcox.test(Punten_jaar2$EC_Jaar2[Nederlands], 
            Punten_jaar2$EC_Jaar2[!Nederlands])
```
<!-- ## /BLOK: Mann-Whitney-U-toets.R -->

```{r Mann Whitney U toets als object, include = FALSE}
wcx <- wilcox.test(Punten_jaar2$EC_Jaar2[Nederlands],
                   Punten_jaar2$EC_Jaar2[!Nederlands])
vW_W <- Round_and_format_0decimals(wcx$statistic)
vW_P <- Round_and_format(wcx$p.value)
```
* *W* = `r vW_W`, *p* = `r vW_P`
* p-waarde > 0,05, dus de H~0~ wordt niet verworpen [^3]

# Rapportage
De *Mann-Whitney U toets* is uitgevoerd om te toetsen of het behaalde aantal EC in het tweede jaar is hetzelfde van internationale studenten als van Nederlandse studenten. Uit de resultaten kan afgelezen worden dat er geen statistisch significant verschil is tussen het aantal studiepunten van internationale studenten als van Nederlandse studenten. *W* = TEST, p-waarde << 0,05. 

[^1]: Elke groep heeft geen overlap met één van de andere groepen en de groepen kunnen elkaars deelname niet beïnvloeden. Deze stap wordt beredeneerd en wordt niet getoetst.  
[^2]: Van Geloven, N. (13 maart 2018). *Mann-Whitney U toets*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Mann-Whitney_U_toets).
[^3]: In dit voorbeeld wordt eruit gegaan van een waarschijnlijkheid van 95% en zodoende een p-waardegrens van 0,05. Dit is naar eigen inzicht aan te passen. Hou hierbij rekening met type I en type II fouten.
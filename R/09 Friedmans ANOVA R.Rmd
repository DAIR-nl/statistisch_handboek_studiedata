---
title: "Friedman's ANOVA"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: 
      collapsed: FALSE 
    number_sections: true
    includes:
      in_header: ["../01. Includes/html/favicon.html", "../01. Includes/html/analytics.html"]
  keywords: [statistisch handboek, studiedata]
---

<!-- ## CLOSEDBLOK: Functies.R -->
```{r functies, include = TRUE, echo = FALSE, results='asis', warning=FALSE, message=FALSE}
library(here)
if (!exists("Substitute_var")) {
  ## Installeer packages en functies
  source(paste0(here::here(), "/99. Functies en Libraries/00. Voorbereidingen.R"), echo = FALSE)
}
```
<!-- ## /CLOSEDBLOK: Functies.R -->

<!-- ## CLOSEDBLOK: CSS -->
<style>
`r htmltools::includeHTML(paste0(here::here(),"/01. Includes/css/Stylesheet_SHHO.css"))`
</style>
<!-- ## /CLOSEDBLOK: CSS -->

<!-- ## CLOSEDBLOK: Header.R -->
```{r header, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Header.R"))} 
```
<!-- ## /CLOSEDBLOK: Header.R -->

<!-- ## CLOSEDBLOK: Reticulate.R -->

<!-- ## /CLOSEDBLOK: Reticulate.R -->

<!-- ## CLOSEDBLOK: Status.R -->
```{r status, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Status.R"))} 
```
<!-- ## /CLOSEDBLOK: Status.R -->

```{r set-options, echo=FALSE, cache=FALSE}
options(width = 80)
## Zodat de TukeyHSD naast elkaar geprint wordt
```

<!-- ## OPENBLOK: Data-aanmaken.R -->
```{r aanmaken data, include=FALSE, echo=TRUE}
source(paste0(here::here(),"/01. Includes/data/04.R"))
```

<!-- ## /OPENBLOK: Data-aanmaken.R -->

# Toepassing
Gebruik *Friedman's ANOVA* om gemiddelden te vergelijken van een groep bij drie of meer herhaalde metingen of om drie of meer gepaarde groepen te vergelijken.[^1]<sup>, </sup>[^2] *Friedman's ANOVA* is een alternatief voor de *repeated measures ANOVA* wanneer de data niet aan de assumptie van normaliteit voldoen. Daarnaast hebben uitbijters minder invloed op het resultaat van de *Friedman's ANOVA* in vergelijking tot de *repeated measures ANOVA*. Echter, als de data aan de assumpties van de *repeated measures ANOVA* voldoen, heeft deze toets een hoger onderscheidend vermogen dan *Friedman's ANOVA*.[^3]



# Onderwijscasus
<div id = "casus">

De vastgoedmanager van de  Facultaire Dienst (FD) van een hogeschool is nieuwsgierig hoe de verschillende eetgelegenheden op de campus gewaardeerd worden door studenten om te inventarisen op welke manier het horeca-aanbod verbeterd kan worden. Uit de Nationale Studenten Enquête (NSE) blijkt dat studenten van de hogeschool ontevreden zijn over het horeca-aanbod op de campus. Als vervolgonderzoek hierop wordt een groep studenten gevraagd om de eetgelegenheden op de campus te beoordelen. Aan de hand daarvan vergelijkt de FD kantines in vier gebouwen: het hoofdgebouw, het bestuursgebouw, het sportcentrum en het cultuurcentrum Rembrandt. Met deze gegevens wil de vastgoedmanager onderzoeken of er verschillen zijn in de waarderingscijfers van de kantines in de vier gebouwen. Als deze verschillen aanwezig zijn, is zij benieuwd welke kantines van elkaar verschillen.

*H~0~*: De verdelingen van de beoordelingen van studenten zijn hetzelfde voor de kantine in het hoofdgebouw, het bestuursgebouw, het sportcentrum en het cultuurcentrum Rembrandt.


*H~A~*: De verdelingen van de beoordelingen van studenten zijn niet hetzelfde voor de kantine in het hoofdgebouw, het bestuursgebouw, het sportcentrum en het cultuurcentrum Rembrandt

</div>

# Assumpties

Om een valide toetsresultaat te bereiken, moeten de data aan een aantal assumpties voldoen. De afhankelijke variabele moet ordinaal of continu zijn. Bij herhaalde metingen van dezelfde observatie-eenheden, moet de groep observatie-eenheden drie of meer keren gemeten zijn en een willekeurige steekproef van de populatie zijn. Bij gepaarde groepen, moet elk paar bestaan uit drie of meer gepaarde observatie-eenheden en moet de steekproef met alle paren een willekeurige steekproef van de populatie zijn.[^4]


# Effectmaat
De p-waarde geeft aan of het verschil tussen groepen statistisch significant is. De grootte van het verschil of effect is echter ook relevant. Een effectmaat is een gestandaardiseerde maat die de grootte van een effect weergeeft, zodat effecten vergeleken kunnen worden voor verschillende onderzoeken.[^5] Voor de *repeated measures ANOVA* wordt de effectmaat *Kendall's W* vaak gebruikt. Een indicatie om *r* te interpreteren is: rond 0,1 is het een klein effect, rond 0,3 is het een gemiddeld effect en rond 0,5 is het een groot effect.[^6]



# Post-hoc toetsen
De *repeated measures ANOVA* toetst of één of meerdere van de gemiddelden anders is dan de andere gemiddelden. Voer een post-hoc toets uit om te bepalen welke groepen significant verschillen. Gebruik de *Wilcoxon signed rank toets* als post-hoc toets.

Gebruik een correctie voor de p-waarden, omdat er meerdere toetsen tegelijkertijd worden gebruikt. In deze toetspagina wordt de *Bonferroni correctie* gebruikt. Deze correctie past de p-waarde aan door de p-waarde te vermenigvuldigen met het aantal uitgevoerde toetsen en verlaagt hiermee de kans dat er bij toeval een verband wordt ontdekt dat er niet is (type I fout).[^7] Er zijn ook andere opties voor een correctie op de p-waarden. De keuze voor een correctie is afhankelijk van het onderzoek.[^5]

# Uitvoering
<!-- ## TEKSTBLOK: Dataset-inladen.R-->
Er is een dataset `Studieuren_technische_natuurkunde` ingeladen met het aantal studieuren van eerstejaars studenten van de bachelor Technische Natuurkunde voor de drie vakken in de eerste onderwijsperiode.
<!-- ## /TEKSTBLOK: Dataset-inladen.R-->

## De data bekijken
<!-- ## TEKSTBLOK: Data-bekijken.R -->
Gebruik `head()` en `tail()` om de structuur van de data te bekijken.
<!-- ## /TEKSTBLOK: Data-bekijken.R -->

<!-- ## OPENBLOK: Data-bekijken.R -->
```{r data bekijken, collapse = TRUE}
## Eerste 5 observaties
head(Studieuren_technische_natuurkunde)

## Laatste 5 observaties
tail(Studieuren_technische_natuurkunde)
```
<!-- ## /OPENBLOK: Data-bekijken.R -->

Selecteer de drie groepen en sla deze op in een vector om deze makkelijker aan te kunnen roepen. 
<!-- ## OPENBLOK: Data-selecteren.R -->
```{r data selecteren}

Studieuren_lineaire_algebra <- Studieuren_technische_natuurkunde$Studieuren[Studieuren_technische_natuurkunde$Vak == "Lineaire Algebra"]
Studieuren_relativiteitstheorie <- Studieuren_technische_natuurkunde$Studieuren[Studieuren_technische_natuurkunde$Vak == "Relativiteitstheorie"]
Studieuren_kosmologie <- Studieuren_technische_natuurkunde$Studieuren[Studieuren_technische_natuurkunde$Vak == "Kosmologie"]
```
<!-- ## /OPENBLOK: Data-selecteren.R -->


<!-- ## TEKSTBLOK: Data-beschrijven.R -->
Inspecteer de data met `mean()`, `sd()` en `length()` om meer inzicht te krijgen in de data.
<!-- ## /TEKSTBLOK: Data-beschrijven.R -->


<div class="col-container"> 
  <div class="col">
<!-- ## OPENBLOK: Lilliefors-test-1.R -->
```{r descriptives 1, warning=FALSE, collapse=TRUE}
# Gemiddelde
mean(Studieuren_lineaire_algebra)
# Standaardafwijking
sd(Studieuren_lineaire_algebra)
# Aantal observaties
length(Studieuren_lineaire_algebra)
```
<!-- ## OPENBLOK: Lilliefors-test-1.R -->
  </div>
  <div class = "col">
<!-- ## OPENBLOK: Lilliefors-test-2.R -->
```{r descriptives 2, warning=FALSE, collapse=TRUE}
# Gemiddelde
mean(Studieuren_relativiteitstheorie)
# Standaardafwijking
sd(Studieuren_relativiteitstheorie)
# Aantal observaties
length(Studieuren_relativiteitstheorie)
```
<!-- ## OPENBLOK: Lilliefors-test-2.R -->
  </div>
  <div class = "col">
<!-- ## OPENBLOK: Lilliefors-test-3.R -->
```{r descriptives 3, warning=FALSE, collapse=TRUE}
# Gemiddelde
mean(Studieuren_kosmologie)
# Standaardafwijking
sd(Studieuren_kosmologie)
# Aantal observaties
length(Studieuren_kosmologie)
```
<!-- ## /OPENBLOK: Lilliefors-test-3.R -->
  </div>
</div>


<!-- ## CLOSEDBLOK: Data-beschrijven.R -->
```{r data beschrijven als object, include=FALSE, echo=TRUE}
vM_LA  <- Round_and_format(mean(Studieuren_lineaire_algebra))
vSD_LA <- Round_and_format(sd(Studieuren_lineaire_algebra))
vN_LA  <- Round_and_format(length(Studieuren_lineaire_algebra))

vM_RT  <- Round_and_format(mean(Studieuren_relativiteitstheorie))
vSD_RT <- Round_and_format(sd(Studieuren_relativiteitstheorie))
vN_RT  <- Round_and_format(length(Studieuren_relativiteitstheorie))

vM_KL  <- Round_and_format(mean(Studieuren_kosmologie))
vSD_KL <- Round_and_format(sd(Studieuren_kosmologie))
vN_KL  <- Round_and_format(length(Studieuren_kosmologie))
```
<!-- ## /CLOSEDBLOK: Data-beschrijven.R -->

<!-- ## TEKSTBLOK: Datatekst-beschrijven.R -->
* Gemiddelde aantal studieuren Lineaire Algebra (standaarddeviatie): `r vM_LA` (`r vSD_LA`), *n* = `r vN_LA`  
* Gemiddelde aantal studieuren Relativiteitstheorie (standaarddeviatie): `r vM_RT` (`r vSD_RT`), *n* = `r vN_RT`  
* Gemiddelde aantal studieuren Kosmologie (standaarddeviatie): `r vM_KL` (`r vSD_KL`), *n* = `r vN_KL`  

<!-- ## /TEKSTBLOK: Datatekst-beschrijven.R -->



## Repeated measures ANOVA 

<!-- ## TEKSTBLOK: ANOVA-toets.R -->
Voer de *repeated measures ANOVA* uit om de vraag te beantwoorden of er verschillen zijn tussen het aantal studieuren voor de vakken in de eerste onderwijsperiode van het eerste jaar van de bachelor Technische Natuurkunde. Gebruik de functie `ezANOVA` met als argumenten de dataset ``Studieuren_technische_natuurkunde`, de afhankelijke variabele `dv = Studieuren`, de variabele die de observaties aangeeft `wid = Studentnummer` en de onafhankelijke variabele `within = Vak`.
<!-- ## /TEKSTBLOK: ANOVA-toets.R -->

<!-- ## OPENBLOK: ANOVA-toets.R -->
```{r ANOVA2, warning = FALSE}
library(ez)
ezANOVA(Studieuren_technische_natuurkunde, dv = Studieuren, wid = Studentnummer,
               within = Vak)

```
<!-- ## /OPENBLOK: ANOVA-toets.R -->

<!-- ## CLOSEDBLOK: ANOVA-toets.R -->
```{r ANOVA als object, echo=FALSE}
library(ez)
obj <- ezANOVA(Studieuren_technische_natuurkunde, dv = Studieuren, wid = Studentnummer,
               within = Vak)
Mauchly_W <- Round_and_format(obj$`Mauchly's Test for Sphericity`$W)
GG_F <- Round_and_format(obj$`Sphericity Corrections`$GGe)
eta2 <- Round_and_format(obj$ANOVA$ges)
```
<!-- ## /CLOSEDBLOK: ANOVA-toets.R -->

<!-- ## TEKSTBLOK: ANOVA-toets1.R -->
*Mauchly's test* toont aan dat de assumptie van sphericiteit niet standthoudt in deze casus ($\chi^2$ = `r Mauchly_W`, p < 0,0001); gebruik in dit geval een van de correcties. Zowel de Greenhouse-Geisser als de Huynh-Feldt correctie laten een significant resultaat zien; rapporteer in dit geval de (conservatieve) Greenhouse-Geisser correctie.

* De data voldoet niet aan de assumptie van sphericiteit, $\chi^2$ = `r Mauchly_W`, p < 0,0001
* De resultaten van de Greenhouse-Geisser correctie zijn *F* = `r GG_F`, p < 0,0001, *η^2^* = `r eta2`
* De p-waarde < 0,05, dus de H~0~ wordt verworpen.[^11]
* Er is een significant verschil tussen het aantal studieuren voor de drie vakken in de eerste onderwijsperiode; het effect van de verschillende vakken op het aantal studieuren is groot
<!-- ## /TEKSTBLOK: ANOVA-toets1.R -->

## Post-hoc toets
<!-- ## TEKSTBLOK: posthoc1.R -->
Voer post-hoc toetsen uit om te onderzoeken welke vakken uit de eerste onderwijsperiode van elkaar verschillen wat betreft het aantal studieuren dat eerstejaars studenten van de bachelor Technische Natuurkunde hieraan besteden. Gebruik hiervoor de functie `pairwise.t.test` met als argumenten de afhankelijk variabele `Studieuren_technische_natuurkunde$Studieuren`, de onafhankelijke variabele `Studieuren_technische_natuurkunde$Vak` en de gebruikte methode om te corrigeren voor meerdere toetsen `p.adjust.method = "bonferroni"`.
<!-- ## /TEKSTBLOK: posthoc1.R -->

<!-- ## OPENBLOK: posthoc2.R -->
```{r }
# Bereken de verschillen in gemiddelde tussen de drie vakken
Verschil_gemiddelde_LA_RT <- mean(Studieuren_lineaire_algebra) - mean(Studieuren_relativiteitstheorie)
Verschil_gemiddelde_RT_KL <- mean(Studieuren_relativiteitstheorie) - mean(Studieuren_kosmologie)
Verschil_gemiddelde_KL_LA <- mean(Studieuren_kosmologie) - mean(Studieuren_lineaire_algebra)

# Bereken de p-waarden van de post-hoc toets
pairwise.t.test(Studieuren_technische_natuurkunde$Studieuren, Studieuren_technische_natuurkunde$Vak,
                p.adjust.method = "bonferroni")

```
<!-- ## /OPENBLOK: posthoc2.R -->

<!-- ## CLOSEDBLOK: posthoc3.R -->
```{r, include = FALSE}
# Bereken de verschillen in gemiddelde tussen de drie vakken
Mu_diff_LA_RT <- Round_and_format(mean(Studieuren_lineaire_algebra) - mean(Studieuren_relativiteitstheorie))
Mu_diff_RT_KL <- Round_and_format(mean(Studieuren_relativiteitstheorie) - mean(Studieuren_kosmologie))
Mu_diff_KL_LA <- Round_and_format(mean(Studieuren_kosmologie) - mean(Studieuren_lineaire_algebra))

# Bereken de p-waarden van de post-hoc toets
phtest <- pairwise.t.test(Studieuren_technische_natuurkunde$Studieuren, Studieuren_technische_natuurkunde$Vak,
                p.adjust.method = "bonferroni")



```
<!-- ## /CLOSEDBLOK: posthoc3.R -->

* Er is een significant verschil tussen Lineaire algebra en Relativiteitstheorie, *MD* = `r Mu_diff_LA_RT`, p < 0,0001
* Er is een significant verschil tussen Relativiteitstheorie en Kosmologie, *MD* = `r Mu_diff_RT_KL`, p < 0,0001
* Er is een significant verschil tussen Kosmologie en Lineaire algebra, *MD* = `r Mu_diff_KL_LA`, p < 0,03


# Rapportage

<!-- ## TEKSTBLOK: rapportage.R -->
Een *repeated measures ANOVA* is uitgevoerd om te onderzoeken of er verschillen zijn tussen het aantal studieuren dat eerstejaars studenten van de bachelor Technische Natuurkunde besteden aan de vakken in de eerste onderwijsperiode. De vakken zijn Lineaire Algebra, Relativiteitstheorie en Kosmologie; beschrijvende statistieken zijn te vinden in Tabel 1. De data voldoen niet aan de assumptie van sphericiteit ($\chi^2$ = `r Mauchly_W`, p < 0,0001), daarom is de Greenhouse-Geisser correctie gebruikt. Het aantal studieuren voor de drie vakken in de eerste onderwijsperiode verschilt significant van elkaar, *F* = `r GG_F`, p < 0,0001, *η^2^* = `r eta2`. De sterkte van het effect van het vak op het aantal studieuren is groot. Post-hoc toetsen - waarbij een Bonferroni correctie is toegepast om te corrigeren voor meerdere toetsen -  tonen aan dat elk van de drie de vakken significant verschilt van de andere twee vakken.


| Opleiding     | M          | SD          | N          |
| ------------- | ---------- | ---------- | ----------- |
| Lineaire Algebra      | `r vM_LA` | `r vSD_LA` | `r vN_LA` |
| Relativiteitstheorie  | `r vM_RT` | `r vSD_RT` | `r vN_RT` |
| Kosmologie            | `r vM_KL` | `r vSD_KL` | `r vN_KL` |
*Tabel 1. Het gemiddelde aantal studieuren, bijbehorende standaarddeviatie en groepsgrootte voor de vakken in de eerste onderwijsperiode van de bachelor Technische Natuurkunde.*
<!-- ## /TEKSTBLOK: rapportage.R -->



<!-- ## CLOSEDBLOK: Footer.R -->
```{r footer, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Footer.R"))}
```
<!-- ## /CLOSEDBLOK: Footer.R -->

[^1]: Van Geloven, N. (4 oktober 2019). *Friedman toets*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Friedman_toets). 
[^2]: Universiteit van Amsterdam (7 juli 2014). *Friedmans ANOVA*. [UvA Wiki Methodologiewinkel](https://wiki.uva.nl/methodologiewinkel/index.php/Friedmans_ANOVA). 
[^3]: Field, A. (2013). *Discovering statistics using IBM SPSS statistics*. Sage.
[^4]: Laerd statistics (2018). *Friedman Test in SPSS Statistics*. https://statistics.laerd.com/spss-tutorials/friedman-test-using-spss-statistics.php. 
[^5]: Field, A., Miles, J., & Field, Z. (2012). *Discovering statistics using R*. London: Sage publications.
[^6]: University of Sheffield. *Friedman test in SPSS*. [Mathematics and Statistics Help (MASH)](https://www.sheffield.ac.uk/polopoly_fs/1.714575!/file/stcp-marshall-FriedmanS.pdf). Bezocht op 13 maart 2020.
[^7]: Type I fout: Ten onrechte H~0~ verwerpen.



[^1]: Universiteit van Amsterdam (26 augustus 2014). *Repeated-Measures ANOVA*. [UvA Wiki Methodologiewinkel](https://wiki.uva.nl/methodologiewinkel/index.php/Repeated-Measures_ANOVA).
[^2]: Bereken de logaritme van de variabele en de inverse (1 gedeeld door de variabele), en bekijk of deze normaal verdeeld zijn. Als dat zo is, mag je die gebruiken voor de analyse.
[^3]: Allen, P. & Bennett, K. (2012). *SPSS A practical Guide version 20.0*. Cengage Learning Australia Pty Limited.
[^4]: Laerd statistics (2018). *Testing for Normality using SPSS Statistics*. https://statistics.laerd.com/spss-tutorials/testing-for-normality-using-spss-statistics.php. 
[^5]: Universiteit van Amsterdam (14 juli 2014). *Normaliteit*. [UvA Wiki Methodologiewinkel](https://wiki.uva.nl/methodologiewinkel/index.php/Normaliteit).
[^6]: Field, A., Miles, J., & Field, Z. (2012). *Discovering statistics using R*. London: Sage publications.
[^7]: Allen, P. & Bennett, K. (2012). *SPSS A practical Guide version 20.0*. Cengage Learning Australia Pty Limited.
[^8]: Type I fout: Ten onrechte H~0~ verwerpen.
[^9]: Outliers (13 augustus 2016). [UvA Wiki Methodologiewinkel](https://wiki.uva.nl/methodologiewinkel/index.php/Outliers).
[^10]: Uitbijters kunnen bepalend zijn voor de uitkomst van toetsen. Bekijk of de uitbijters valide uitbijters zijn en niet een meetfout of op een andere manier incorrect verkregen data. Het weghalen van uitbijters kan de uitkomst ook vertekenen, daarom is het belangrijk om verwijderde uitbijters te melden in een rapport. 
[^11]: In dit voorbeeld wordt uitgegaan van een waarschijnlijkheid van 95% c.q. een p-waardegrens van 0,05. De grens is naar eigen inzicht aan te passen; houd hierbij rekening met type I en type II fouten.

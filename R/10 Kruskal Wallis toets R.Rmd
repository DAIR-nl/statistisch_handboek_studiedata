---
title: "Kruskal Wallis toets"
author: "© `r format(Sys.time(), '%Y')`, SURF Versnellingsagenda Statistisch Handboek Hoger Onderwijs"
date: "`r format(Sys.time(), '%d-%m-%y')`"
output: 
  html_document:
    toc: TRUE
    toc_float:
      collapsed: FALSE
    number_sections: TRUE
    theme: lumen
---

<style>
`r htmltools::includeHTML(paste0(here::here(),"/01. Includes/css/Stylesheet_SHHO.css"))`
</style>

```{r header, include = FALSE, echo = TRUE, results='asis'} 
paste0(here::here(),"/01. Includes/code/Header.R")
```

<!-- ## OPENBLOK: Functiedefinities.R -->
```{r functiedefinities,include=FALSE, echo=TRUE}
library(stringr)
Round_and_format <- function(x, digits = 2) {
  x <- as.character(round(x, digits))
  x <- str_replace(x, "[.]", ",")
  return(x)
}
```
<!-- ## /OPENBLOK: Functiedefinities.R -->

<!-- ## OPENBLOK: Data-aanmaken.R -->
```{r aanmaken data, include=FALSE, echo=TRUE}
## H0 en H1 medianen of gemiddelden, ook in toepassing 
## is het wel interessant om gemiddelden te tonen? 
## link naar Mann W-U test 

RNGkind(sample.kind = "Rounding")
set.seed(8)
# 3
## 300 waarnemingen voor Vooropleiding
Seed <- sample(c(1, 2, 3, 4), 300, replace = TRUE)
Vooropleiding <-  ifelse(Seed == 1, "Rechtsgeleerdheid", 
                  ifelse(Seed == 2, "Notarieel Recht",
                  ifelse(Seed == 3, "Fiscaal Recht",
                  ifelse(Seed == 4, "Premaster",
                                 NA))))

## 300 waarnemingen voor puntenaantallen, random gesampled uit een lijst mogelijkheden
Punten_mogelijkheden <- c(6, 12, 18, 24, 30, 36, 36, 42, 42, 42, 48, 48, 48, 48, 54, 54, 54, 60, 60, 60, 60, 60, 60)
EC_Jaar1 <- sample(Punten_mogelijkheden, 300, replace = TRUE)

Studentnr <- sample(3000000:4000000, 300)
Resultaten_Arbeidsrecht <- data.frame(Studentnr, Vooropleiding, EC_Jaar1)

## puntencorrectie om Fiscaal en Notarieel +6 punten te geven en Rechtsgeleerdheid -6 punten
Resultaten_Arbeidsrecht$EC_Jaar1[Vooropleiding == "Fiscaal Recht" | Vooropleiding == "Notarieel Recht"] <-
  Resultaten_Arbeidsrecht$EC_Jaar1[Vooropleiding == "Fiscaal Recht" | Vooropleiding == "Notarieel Recht"] + 6
Resultaten_Arbeidsrecht$EC_Jaar1[Vooropleiding == "Rechtsgeleerdheid"] <-
  Resultaten_Arbeidsrecht$EC_Jaar1[Vooropleiding == "Rechtsgeleerdheid"] - 6
```
<!-- ## /OPENBLOK: Data-aanmaken.R -->

# Toepassing
Gebruik de *Kruskal Wallis toets* om te toetsen of 2 of meer groepen significant van elkaar verschillen.[^1] Een kenmerk van de data is dat deze numeriek en ongepaard is.  

De *Kruskal Wallis toets* kan een alternatief zijn voor de *one-way ANOVA*.[^2] De *Kruskal Wallis toets* stelt minder eisen aan de data en hoeft onder andere niet te voldoen aan de assumptie normaliteit. Bij de *Kruskal Wallis toets* hebben uitbijters hebben minder invloed op het eindresultaat dan bij de *one-way ANOVA*. Daarentegen, als de data wel normaal verdeeld zijn, heeft de *Kruskal Wallis toets* minder onderscheidend vermogen dan de *one way ANOVA*.[^3]<sup>, </sup>[^4] Vandaar dat ondanks de voordelen er toch minder vaak voor de *Kruskal Wallis toets* test gekozen wordt. 

# Onderwijscasus
<div id="casus">
De opleidingsdirecteur van de tweejarige Masteropleiding Arbeidsrecht is geïnteresseerd in de afstudeersnelheid van zijn studenten. Hij vraagt zich af of er een verschil zit in het type vooropleiding die de studenten hebben gehaald en de hoeveel studiepunten die de studenten behalen in het eerste jaar. Hij kijkt naar de vier meest gangbare vooropleidingen die de studenten doorlopen voordat ze met de Master Arbeidsrecht beginnen: de Bachelors Fiscaal Recht, Notarieel Recht en Rechtsgeleerdheid en de Premaster.  

*H~0~*: Er is geen significant verschil tussen de studenten van de Master Arbeidsrecht met als vooropleiding Bachelor Fiscaal Recht, Notarieel Recht of Rechtsgeleerdheid of de Premaster en het aantal studiepunten dat de studenten in het eerste jaar behalen.

*H~A~*: Er is een significant verschil tussen de studenten van de Master Arbeidsrecht met als vooropleiding Bachelor Fiscaal Recht en/of Notarieel Recht en/of Rechtsgeleerdheid en/of de Premaster en/of het aantal studiepunten dat de studenten in het eerste jaar behalen.
</div>

# Assumpties
Voor een valide resultaat moeten de data aan een aantal voorwaarden voldoen voordat de toets uitgevoerd kan worden: de data zijn (semi-)continu,[^5] de groepen zijn onafhankelijk van elkaar [^6] en het aantal groepen is groter dan 2. Gebruik bij 2 groepen de *Mann-Whitney U toets*.

# Post-hoc toets 
De *Kruskal Wallis toets* toetst of twee of meerdere groepen van elkaar verschillen. Een post-hoc toets specificeert welke groep significant van andere groepen verschillen. Gebruik de *Mann-Whitney U toets* als post-hoc toets. 

Gebruik de *Bonferroni correctie* om Type I fouten te voorkomen. Deze correctie past de p-waarde aan door de p-waarde te vermenigvuldigen met het aantal uitgevoerde toetsen en verlaagt hiermee de kans dat er bij toeval een verband wordt ontdekt dat er niet is.[^7]<sup>, </sup>[^8]

# Uitvoering
Er is een dataset ingeladen met studieresultaten van de master Arbeidsrecht per vooropleiding: Fiscaal Recht, Notarieel Recht, Rechtsgeleerdheid en de Premaster.

## De data bekijken
Gebruik `head()` en `tail()` om de structuur van de data te bekijken.
<!-- ## OPENBLOK: Data-bekijken.R -->
```{r data bekijken, collapse = TRUE}
## Eerste 6 observaties
head(Resultaten_Arbeidsrecht)

## Laatste 6 observaties
tail(Resultaten_Arbeidsrecht)
```
<!-- ## /OPENBLOK: Data-bekijken.R -->

De dataset bevat data van studenten van verschillende vooropleidingen. Gebruik `unique()` om te onderzoeken welke verschillende opleidingen er in de data aanwezig zijn. 

<!-- ## OPENBLOK: Data-bekijken-2.R -->
```{r data bekijken 2}
## Unieke opleidingen
unique(Resultaten_Arbeidsrecht$Vooropleiding)
```
<!-- ## /OPENBLOK: Data-bekijken-2.R -->

Om meer inzicht te krijgen in de data, inspecteer de groepen met `length()`, `median()` en `quantile()`. Groepeer hiervoor eerst met `group_by()`.

``` {r data beschrijven, warning=FALSE, message=FALSE}
## Aantallen en mediaan
library(dplyr)
group_by(Resultaten_Arbeidsrecht, Vooropleiding) %>%
  summarise(
    N = length(EC_Jaar1),
    Q1 = quantile(EC_Jaar1)[2], ## de eerste waarde is het minimum; Q1 is dus op de 2e positie
    Mediaan = median(EC_Jaar1),
    Q3 = quantile(EC_Jaar1)[4]
  )
```
<!-- ## /OPENBLOK: Data-beschrijven.R -->

``` {r data beschrijven als object, include=FALSE, echo=TRUE}
x <- group_by(Resultaten_Arbeidsrecht, Vooropleiding) %>%
  summarise(
    N = n(),
    Q1 = quantile(EC_Jaar1)[2],
    Mediaan = median(EC_Jaar1),
    Q3 = quantile(EC_Jaar1)[4]
  )

vN_FIS <- Round_and_format(x[1,2])
vN_NOT <- Round_and_format(x[2,2])
vN_RCH <- Round_and_format(x[4,2])
vN_PM <- Round_and_format(x[3,2])

vQ1_FIS <- Round_and_format(x[1,3])
vQ1_NOT <- Round_and_format(x[2,3])
vQ1_RCH <- Round_and_format(x[4,3])
vQ1_PM <- Round_and_format(x[3,3])

vMed_FIS <- Round_and_format(x[1,4])
vMed_NOT <- Round_and_format(x[2,4])
vMed_RCH <- Round_and_format(x[4,4])
vMed_PM <- Round_and_format(x[3,4])

vQ3_FIS <- Round_and_format(x[1,5])
vQ3_NOT <- Round_and_format(x[2,5])
vQ3_RCH <- Round_and_format(x[4,5])
vQ3_PM <- Round_and_format(x[3,5])
```
* Mediaan Fiscaal Recht: `r vMed_FIS`. *n* = `r vN_FIS`.
* Mediaan Notarieel Recht: `r vMed_NOT`. *n* = `r vN_NOT`.
* Mediaan Rechtsgeleerdheid: `r vMed_RCH`. *n* = `r vN_RCH`.
* Mediaan Premaster: `r vMed_PM`. *n* = `r vN_PM`.

### Boxplot
De box geeft de middelste 50% van het aantal studiepunten weer. De zwarte lijn binnen de box is de mediaan. In de staarten zitten de eerste 25% en de laatste 25%. Cirkels visualiseren mogelijke uitbijters. Hoe meer de boxen overlappen, hoe waarschijnlijker er geen significant verschil is tussen de groepen. 

<!-- ## OPENBLOK: Boxplot.R -->
``` {r Boxplot}
boxplot(EC_Jaar1 ~ Vooropleiding, Resultaten_Arbeidsrecht,
        main = "Aantal EC per vooropleiding van de Master Arbeidsrecht",
        ylab = "Aantal EC in jaar 1")
```
<!-- ## /OPENBLOK: Boxplot.R -->

De mediaan van studenten met een vooropleiding Rechtsgeleerdheid heeft duidelijk minder studiepunten dan studenten met een vooropleiding Fiscaal Recht en Notarieel Recht. De studenten met de Premaster als vooropleiding ligt er tussen in.[^9]

## Kruskal Wallis toets
Gebruik `kruskal.test()`. In het eerste argument gebruik je de afhankelijke variabele en de variabele die de groep definiëert. Het tweede argument is het dataframe. 
<!-- ## OPENBLOK: Kruskal-Wallis-test -->
```{r Kruskal Wallis test}
kruskal.test(EC_Jaar1 ~ Vooropleiding, Resultaten_Arbeidsrecht)
```
<!-- ## /OPENBLOK: Kruskal-Wallis-test -->
```{r Kruskal Wallis test als object, include= FALSE, echo= TRUE}
Ktest <- kruskal.test(EC_Jaar1 ~ Vooropleiding, Resultaten_Arbeidsrecht)
vK_DF <- Round_and_format(Ktest$parameter)
vK_Chi2 <- Round_and_format(Ktest$statistic)
vK_P <- Round_and_format(Ktest$p.value)
```
* *df*: het aantal groepen - 1 = `r vK_DF`  
* *H*~3~ = `r vK_Chi2`, p < 0,05  
* *H* volgt bij benadering de chi-kwadraat verdeling. Onder deze hypothese is *H* chi-kwadraat, vandaar dat dit in de output uitgedrukt wordt in chi-kwadraat    
* p-waarde < 0,05, dus de H~0~ wordt verworpen en de H~A~ wordt aangenomen[^10]

## Post-hoc toets: Mann-Whitney U toets
Gebruik de *Mann-Whitney U toets* als post-hoc toets om te bepalen wélke groepen significant verschillen. De *Mann-Whitney U toets* wordt ook wel de *Wilcoxon rank-sum toets* genoemd.[^11] Gebruik de functie `pairwise.wilcox.test()`. 

Pas de *Bonferroni correctie* toe met `p.adjust.method = "bonferroni"`.    

<!-- ## OPENBLOK: Mann-Whitney-U-test-->
``` {r pairwise wilcox test}
pairwise.wilcox.test(Resultaten_Arbeidsrecht$EC_Jaar1, Resultaten_Arbeidsrecht$Vooropleiding, p.adjust.method = "bonferroni")
```
<!-- ## /OPENBLOK: Mann-Whitney-U-test-->
* Er is geen statistisch significant verschil gevonden tussen Fiscaal Recht en Notarieel Recht.
* Er is ook geen statistisch significant verschil gevonden tussen Fiscaal Recht en de Premaster.
* Er is een statistisch significant verschil gevonden tussen de Premaster en Notarieel Recht.   
* De studenten met Rechtsgeleerdheid als vooropleiding scoren statistisch significant lager dan de studenten met één van de drie andere vooropleidingen.  

# Rapportage
De *Kruskal Wallis toets* is uitgevoerd om te toetsen of significante verschillen zijn tussen de studenten van de Master Arbeidsrecht met als vooropleiding Bachelor Fiscaal Recht, Notarieel Recht of Rechtsgeleerdheid of de Premaster en het aantal studiepunten dat de studenten in het eerste jaar behalen. Uit de resultaten kan afgelezen worden dat er een statistisch significant verschil is tussen het aantal studiepunten en het type vooropleiding dat de student heeft afgerond. *H*~`r vK_DF`~ ≈ `r vK_Chi2` < 0,05.   

| Vooropleiding     | N          | Q1         | M           | Q3          |
| ------------- | ---------- | ---------- | ----------- | ----------- |
| Fiscaal Recht      | `r vN_FIS` | `r vQ1_FIS` | `r vMed_FIS` | `r vQ3_FIS` |
| Notarieel Recht     | `r vN_NOT` | `r vQ1_NOT` | `r vMed_NOT` | `r vQ3_NOT` |
| Rechtsgeleerdheid  | `r vN_RCH` | `r vQ1_RCH` | `r vMed_RCH` | `r vQ3_RCH` |
| Premaster          | `r vN_PM`| `r vQ1_PM` | `r vMed_PM` | `r vQ3_PM` |
*Tabel 1. Groepsgrootte, 1e kwantiel, mediaan en 3e kwantiel per vooropleiding*

Met een post-hoc toets is het verschil tussen de vooropleidingen getoetst. De studenten met Rechtsgeleerdheid als vooropleiding behalen statistisch significant minder punten bij de Master Arbeidsrecht, dan de studenten met een andere vooropleiding, *p* < 0,05. Er is een statistisch significant verschil gevonden tussen de behaalde studiepunten van studenten met de vooropleiding Notarieel Recht en de Premaster, *p* < 0,05, waarbij de studenten van de Premaster minder punten behaalden dan de studenten van Notarieel Recht. De *Bonferroni correctie* is gebruikt om de Type I fout te voorkomen die gepaard gaat met het veelvuldig toetsen.  

Kortom, de resultaten ondersteunen de conclusie dat er een verschil is tussen de vooropleidingen die de studenten hebben afgerond en de hoeveelheid studiepunten die een student behaalt tijdens het eerste jaar van de master Arbeidsrecht. De studenten met Rechtsgeleerdheid als vooropleiding behalen statistisch significant minder studiepunten dan de drie andere vooropleidingen. 
Studenten met de vooropleiding Fiscaal Recht (mediaan = `r vMed_FIS`) en Notarieel Recht (mediaan = `r vMed_NOT`) behalen naar verhouding de meeste studiepunten.

[^1]: De toets rangschikt de datapunten van laag naar hoog en geeft elke datapunt een rangnummer. Vervolgens wordt per groep het gemiddelde berekend van de rangnummers. Dit gemiddelde wordt met elkaar vergeleken. Voor meer informatie lees: Field, A., Miles, J., & Field, Z. (2012). *Discovering statistics using R*. London: Sage publications.
[^2]: Van Geloven, N. (21 maart 2018). *Kruskal Wallis*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Kruskal_Wallis). 
[^3]: Universiteit van Amsterdam (7 juli 2014). *Kruskal-Wallis Test*. [UvA Wiki Methodologiewinkel](https://wiki.uva.nl/methodologiewinkel/index.php/Kruskal-Wallis_Test). 
[^4]: Onderscheidend vermogen: wordt in het Engels power genoemd, is de kans dat de nulhypothese verworpen wordt wanneer de alternatieve hypothese 'waar' is.  
[^5]: Semi-continue data: de data zijn discreet, bijvoorbeeld gehele getallen, met zoveel mogelijkheden dat de data geanalyseerd kunnen worden alsof ze continu zijn. Van Geloven, N. (21 November 2017). *KEUZE TOETS*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/KEUZE_TOETS).
[^6]: Elke groep heeft geen overlap met één van de andere groepen en de groepen kunnen elkaars deelname niet beïnvloeden. Deze stap wordt beredeneerd en wordt niet getoetst.  
[^7]: Type I fout: Ten onrechte H~0~ verwerpen en H~A~ aannemen.
[^8]: Universiteit van Amsterdam (7 juli 2014). *Kruskal-Wallis Test*. [UvA Wiki Methodologiewinkel](https://wiki.uva.nl/methodologiewinkel/index.php/Kruskal-Wallis_Test).
[^9]: Bij niet normaal verdeelde data wordt de mediaan berekend in plaats van een gemiddelde om het midden van de data aan te geven. 
[^10]: In dit voorbeeld wordt uitgegaan van een waarschijnlijkheid van 95% en c.q. een p-waardegrens van 0,05. De grens is naar eigen inzicht aan te passen; houd hierbij rekening met Type I en Type II fouten. 
[^11]: Van Geloven, N. (13 maart 2018).  *Mann-Whitney U toets*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Mann-Whitney_U_toets).


---
title: "Chi-kwadraat toets en Fisher's exact toets"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: 
      collapsed: FALSE 
    number_sections: true
    includes:
      in_header: ["../01. Includes/html/favicon.html", "../01. Includes/html/analytics.html"]
  keywords: [statistisch handboek, studiedata]
---

<!-- ## CLOSEDBLOK: Functies.R -->
```{r functies, include = TRUE, echo = FALSE, results='asis', warning=FALSE, message=FALSE}
library(here)
if (!exists("Substitute_var")) {
  ## Installeer packages en functies
  source(paste0(here::here(), "/99. Functies en Libraries/00. Voorbereidingen.R"), echo = FALSE)
}
```
<!-- ## /CLOSEDBLOK: Functies.R -->

<!-- ## CLOSEDBLOK: CSS -->
<style>
`r htmltools::includeHTML(paste0(here::here(),"/01. Includes/css/Stylesheet_SHHO.css"))`
</style>
<!-- ## /CLOSEDBLOK: CSS -->

<!-- ## CLOSEDBLOK: Header.R -->
```{r header, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Header.R"))} 
```
<!-- ## /CLOSEDBLOK: Header.R -->

<!-- ## CLOSEDBLOK: Status.R -->
```{r status, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Status.R"))} 
```
<!-- ## /CLOSEDBLOK: Status.R -->

<!-- ## CLOSEDBLOK: Reticulate.R -->

<!-- ## /CLOSEDBLOK: Reticulate.R -->

<!-- ## OPENBLOK: Data-aanmaken.R -->
```{r opmerking TODO, include=FALSE, eval=FALSE}
# TODO: Uitleg extra pagina: nominaal, ordinaal etc., afhankelijk en onafhankelijk  
# TODO: Uitleg transformeren data 
```
```{r aanmaken data, include=FALSE, echo=TRUE}
source(paste0(here::here(),"/01. Includes/data/13.R"))
```
<!-- ## /OPENBLOK: Data-aanmaken.R -->

# Toepassing
Gebruik de *Chi-kwadraat toets* of de *Fisher's exact toets* om te toetsen of er een afhankelijkheid bestaat tussen twee ongepaarde, binaire variabelen.[^1]<sup>, </sup>[^2]<sup>, </sup>[^3] In tegenstelling tot de *Chi-kwadraat toets* kan de *Fisher's exact toets* ook bij lage aantallen gebruikt worden.[^4] De *Fisher's exact toets* is terughoudender in het benoemen of er een significant verschil is in percentage tussen beide groepen dan de *Chi-kwadraat toets*.[^5]   

# Onderwijscasus
<div id = "casus">
De studentendecaan van een hogeschool vraagt zich af of studenten met een functiebeperking sinds het invoeren van het leenstelsel meer of minder uitvallen.

Dit onderzoek vertaalt zich in de volgende combinatie van hypothesen, waarbij de nulhypothese zo geformuleerd is dat er geen effect is en de alternatieve hypothese zo geformuleerd is dat er een effect is wat overeenkomt met de verwachting van de onderzoeker.

*H~0~*: Onder de studenten met een functiebeperking is het percentage uitval na de invoering van het leenstelsel gelijk gebleven.

*H~A~*: Onder de studenten met een functiebeperking is het percentage uitval na de invoering van het leenstelsel veranderd.
</div>

# Assumpties
Voor een valide resultaat moeten de data aan een aantal voorwaarden voldoen voordat de toets uitgevoerd kan worden. De groepen zijn op nominaal of ordinaal niveau gemeten[^6] en daarmee onafhankelijk van elkaar. 

## Groepsgrootte
Beide testen maken gebruik van een kruistabel; zie Tabel 1 voor de aantallen observaties van de casus.De *Chi-kwadraat toets* wordt onbetrouwbaar als er in een cel 10 of minder observaties zijn.[^7]  


|                      | uitval   | geen uitval | totaal | 
| -------------------- | ---------| ------------| -------------| 
| **geen leenstelsel** |`r Uitval_functiebeperking[1,1]`   | `r Uitval_functiebeperking[1,2]`          | **`r sum(Uitval_functiebeperking[1,1:2])`**|
| **wel leenstelsel**  |`r Uitval_functiebeperking[2,1]`   | `r Uitval_functiebeperking[2,2]`         | **`r sum(Uitval_functiebeperking[2,1:2])`**|
|**totaal**            |**`r sum(Uitval_functiebeperking[1:2,1])`**   | **`r sum(Uitval_functiebeperking[1:2,2])`**     | **`r sum(Uitval_functiebeperking)`** |
*Tabel 1. Geobserveerde aantallen casus uitval met of zonder leenstelsel*

Op basis van de aanname van onafhankelijkheid kunnen de verwachte aantallen observaties in elke cel berekend worden. In deze casus kan het verwachte aantal van de groep uitgevallen studenten zonder leenstelsel berekend worden door het aantal studenten zonder leenstelsel te vermenigvuldigen met het aantal studenten dat is uitgevallen en de uitkomst te delen door het totaal aantal studenten:

* aantal studenten zonder leenstelsel: 871   
* aantal studenten die uitgevallen zijn: 744  
* totaal aantal studenten: 1634  
* verwacht aantal uitgevallen studenten zonder leenstelsel: 871*744/1634 ≈ 397, zie Tabel 2. 

|                      | uitval | geen uitval |
| -------------------- | -------------| ------------| 
| **geen leenstelsel** | 397      | 474     |
| **wel leenstelsel**  | 347      | 416     |
*Tabel 2. Verwachte aantallen casus uitval met of zonder leenstelsel*

Naast onbetrouwbaarheid bij geobserveerde aantallen lager dan 10, wordt de *chi-kwadraat toets* ook onbetrouwbaar als één van de verwachte aantallen lager dan 5 is. Gebruik in die gevallen de *Fisher’s exact toets*.[^8]  

# Effectmaat

De p-waarde geeft aan of het verschil tussen twee groepen statistisch significant is. De grootte van het verschil of effect is echter ook relevant. Een effectmaat is een gestandaardiseerde maat die de grootte van een effect weergeeft, zodat effecten van verschillende onderzoeken met elkaar vergeleken kunnen worden.[^7] 
De *Chi-kwadraat toets* heeft als effectmaat *w*.[^9] Een indicatie om *w* te interpreteren is: rond 0,1 is het een klein effect, rond 0,3 is het een gemiddeld effect en rond 0,5 is het een groot effect.[^10]

De odds ratio is een effectmaat die voor zowel de *Chi-kwadraat toets* als de *Fisher's exact toets* kan worden gebruikt. Een voorwaarde is echter dat beide variabelen binair zijn. In andere woorden, er moet een 2x2 kruistabel gevormd kunnen worden. Odds is een Engelse term voor de verhouding van twee kansen, bijvoorbeeld de verhouding tussen het aantal studenten dat uitvalt en niet uitvalt. Een odds ratio is de verhouding tussen twee odds, dus de verhouding van de odds van studentenuitval voor de periode met leenstelsel en de periode zonder leenstelsel. De odds ratio geeft dus een interpretatie van het effect van een leenstelsel op het uitvallen van studenten.[^7]


# De data bekijken
<!-- ## TEKSTBLOK: Dataset-inladen.R -->
Er is een kruistabel `Uitval_functiebeperking` ingeladen over de uitval van studenten met een functiebeperking voor en na de invoering van het leenstelsel. Zowel de variabele voor uitval (wel of geen uitval) als voor functiebeperking (wel of geen functiebeperking) zijn binair. Deze tabel is gebaseerd op een dataset waarin uitval en functiebeperking voor studenten wordt bijgehouden. 
<!-- ## /TEKSTBLOK: Dataset-inladen.R -->
<!-- ## OPENBLOK: Data-bekijken.R -->
```{r data bekijken, collapse = TRUE}
print(Uitval_functiebeperking)
```
<!-- ## /OPENBLOK: Data-bekijken.R -->

# Chi-kwadraat toets
## Uitvoering
<!-- ## TEKSTBLOK: Chi2-toets-1.R -->
De *chi-kwadraat toets* wordt uitgevoerd om de vraag te beantwoorden of het percentage studenten met een functiebeperking dat is uitgevallen voor en na de invoering van het leenstelsel veranderd is. Gebruik `chisq.test()` op een kruistabel.  
<!-- ## /TEKSTBLOK: Chi2-toets-1.R -->

<!-- ## OPENBLOK: Chi2-toets-2.R -->
```{r chi2}
chisq.test(Uitval_functiebeperking)
```
<!-- ## /OPENBLOK: Chi2-toets-2.R -->

Bereken de effectmaat *w* vervolgens op basis van de $\chi^2$-waarde van de *Chi-kwadraat toets*.
<!-- ## OPENBLOK: Chi2-toets-3.R -->
```{r effectsize}
# Sla de teststatistiek op
Chi2_teststatistiek <- chisq.test(Uitval_functiebeperking)$statistic

# Bereken het totaal aantal observaties als som van de kruistabel
N <- sum(Uitval_functiebeperking)

# Bereken eta squared
w <- sqrt(Chi2_teststatistiek / N)

# Print de effectgrootte
paste("De effectgrootte is",w)


```
<!-- ## /OPENBLOK: Chi2-toets-3.R -->


<!-- ## CLOSEDBLOK: Chi2-toets-4.R -->
```{r chi2 als object, include=FALSE, echo=TRUE}
Chi2 <- chisq.test(Uitval_functiebeperking)
vChi2 <- Round_and_format(Chi2$statistic)
vP <- Round_and_format(Chi2$p.value)
vDF <- Chi2$parameter
```
<!-- ## /CLOSEDBLOK: Chi2-toets-4.R -->

<!-- ## TEKSTBLOK: Chi2-toets-5.R-->
* *χ^2^* ~1~ ≈ `r vChi2`, *p* ≈ `r vP`, *w* = `r Round_and_format(w)`  
* Vrijheidsgraden: *df* = (*k*-1)(*r*-1), waar k staat voor kolom en r voor rij. In dit geval geldt *df* = `r vDF`. De continuïteitscorrectie van Yates wordt automatisch toegepast wanneer het aantal vrijheidsgraden 1 is.[^7]   
* p-waarde < 0,05, dus de H~0~ wordt verworpen.[^11]
* Effectmaat is `r Round_and_format(w)`, dus een klein effect


<!-- ## /TEKSTBLOK: Chi2-toets-5.R-->

## Rapportage
<!-- ## TEKSTBLOK: Rapportage.R -->
De *Chi-kwadraat toets* is uitgevoerd om te toetsen of studenten met een functiebeperking meer of minder uitvallen sinds de invoering van het leenstelsel. De resultaten ondersteunen de alternatieve hypothese: het percentage uitval van het aantal studenten met een functiebeperking is na de invoering van het leenstelsel veranderd, *χ^2^* ~`r vDF`~ ≈ `r vChi2`, *p* = `r vP`, *w* = `r Round_and_format(w)`.

<!-- ## /TEKSTBLOK: Rapportage.R -->


# Fisher's exact toets
## Uitvoering 
<!-- ## TEKSTBLOK: Data-inladen-n43.R -->
De *Fisher's exact toets* wordt uitgevoerd om de vraag te beantwoorden of het percentage studenten met een functiebeperking dat is uitgevallen voor en na de invoering van het leenstelsel gelijk is gebleven. Deze toets is ook betrouwbaar bij een laag aantal observaties; hierbij een voorbeeld met lage aantallen. Er is een steekproef van `Uitval_functiebeperking` ingeladen genaamd `Uitval_functiebeperking_n43`. 
<!-- ## /TEKSTBLOK: Data-inladen-n43.R -->

<!-- ## OPENBLOK: data-bekijken-n43.R -->
```{r data bekijken n43}
print(Uitval_functiebeperking_n43)
```
<!-- ## /OPENBLOK: data-bekijken-n43.R -->

De groepen hebben een laag aantal geobserveerde aantallen variërend van 5 tot 16. Voer de *Fisher's exact toets* uit.

<!-- ## OPENBLOK: Fishers-Exact-toets.R -->
```{r fishers exact}
fisher.test(Uitval_functiebeperking_n43)
```
<!-- ## /OPENBLOK: Fishers-Exact-toets.R -->

<!-- ## CLOSEDBLOK: Fishers-Exact-toets.R -->
```{r fishers exact als object, include=FALSE, echo=TRUE}
fish <- fisher.test(Uitval_functiebeperking_n43)
vF_p <- Round_and_format(fish$p.value)
vConf.int1 <- Round_and_format(fish$conf.int[1])
vConf.int2 <- Round_and_format(fish$conf.int[2])
```
<!-- ## /CLOSEDBLOK: Fishers-Exact-toets.R -->
<!-- ## TEKSTBLOK: Fishers-Exact-toets.R -->
* *p* = `r vF_p`; p-waarde > 0,05, dus de H~0~ wordt niet verworpen.[^11]  
* 95% betrouwbaarheidsinterval is tussen `r vConf.int1` en `r vConf.int2`.  
* De odds ratio is 1,8 met een 95%-betrouwbaarheidsinterval van `r vConf.int1` tot `r vConf.int2`. De kans op uitval van studenten met een functiebeperking met leenstelsel is dus 1,8 keer zo groot is als de kans op uitval van studenten met een functiebeperking zonder het leenstelsel. Deze relatie is echter niet significant


<!-- ## /TEKSTBLOK: Fishers-Exact-toets.R -->

## Rapportage 
<!-- ## TEKSTBLOK: Rapportage Fishers-Exact-toets.R -->
De *Fisher's exact toets* is uitgevoerd om te toetsen of studenten met een functiebeperking meer of minder uitvallen sinds de invoering van het leenstelsel. De nulhypothese dat het percentage uitval van het aantal studenten met een functiebeperking gelijk is gebleven na de invoering van het leenstelsel kan niet worden verworpen, *p* = `r vF_p`. 
<!-- ## /TEKSTBLOK: Rapportage Fishers-Exact-toets.R -->

<!-- ## CLOSEDBLOK: Footer.R -->
```{r footer, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Footer.R"))}
```
<!-- ## /CLOSEDBLOK: Footer.R -->

[^1]: Binaire variabelen: twee elkaar uitsluitende waarden, zoals ja of nee, 0 of 1, aan of uit. 
[^2]: Prabhakaran, S. (2016-2017). *Statistical Tests*. http://r-statistics.co/Statistical-Tests-in-R.html.
[^3]: De *Chi-kwadraat toets* kan ook gebruikt worden wanneer de twee categorische variabelen meer dan twee categorieën bevatten. Deze casus illustreert de test echter voor twee ongepaarde binaire variabelen.*Fisher's exact toets* vereist wel dat beide variabelen binair zijn.
[^4]: Van Geloven, N., & Holman, R., (6 mei 2016). *Fisher's exact toets*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Fisher's_exact_toets).
[^5]: Universiteit van Amsterdam (13 november 2017). *Chi-square test*. [UvA Wiki Methodologiewinkel](https://wiki.uva.nl/methodologiewinkel/index.php/Chi-square_test#Assumpties). 
[^6]: Nominaal: variabelen die niet afhankelijk van elkaar zijn en niet op inhoudelijke basis geordend kunnen worden. Voorbeelden hiervan zijn geslacht of achternamen. Een binaire variabele is een voorbeeld van een nominale variabele. Binaire variabelen hebben twee mogelijkheden, ja of nee, terwijl nominale variabelen meerdere mogelijkheden kunnen hebben. 
[^7]: Field, A., Miles, J., & Field, Z. (2012). *Discovering statistics using R*. London: Sage publications.
[^8]: Van Geloven, N. (20 augustus 2015). *Chi-kwadraat toets*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Chi-kwadraat_toets).
[^9]: De effectmaat *w* wordt voor de *Chi-kwadraat toets* berekend door de wortel te nemen van de
$\chi^2$-waarde gedeeld door het totaal aantal observaties, i.e. $\sqrt{ \frac{\chi^2}{N} }$.
[^10]: Allen, P. & Bennett, K. (2012). *SPSS A practical Guide version 20.0*. Cengage Learning Australia Pty Limited.
[^11]: In dit voorbeeld wordt uitgegaan van een waarschijnlijkheid van 95% c.q. een p-waardegrens van 0,05. De grens is naar eigen inzicht aan te passen; houd hierbij rekening met type I en type II fouten.
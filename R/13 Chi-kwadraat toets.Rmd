---
title: "Chi-kwadraat toets en Fisher's exact toets"
author: "© 2019, SURF Versnellingsagenda - Statistisch Handboek Hoger Onderwijs"
date: "`r format(Sys.time(), '%d-%m-%Y')`"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: 
      collapsed: FALSE 
    number_sections: true
  keywords: [statistisch handboek, studiedata]
---

<style>
`r htmltools::includeHTML(paste0(here::here(),"/01. Includes/css/Stylesheet_SHHO.css"))`
</style>

```{r header, include = FALSE, echo = TRUE, results='asis'} 
paste0(here::here(),"/01. Includes/code/Header.R")
```

<!-- ## BLOK: Functiedefinities.R -->
```{r functiedefinities,include=FALSE, echo=TRUE}
library(stringr)
Round_and_format <- function(x, digits = 2) {
  x <- as.character(round(x, digits))
  x <- str_replace(x, "[.]", ",")
  return(x)
}
```
<!-- ## /BLOK: Functiedefinities.R -->

<!-- ## BLOK: Data-aanmaken.R -->
```{r opmerking TODO, include=FALSE, eval=FALSE}
# TODO: Uitleg extra pagina: nominaal, ordinaal etc., afhanjeklijk en onafhankelijk  
# TODO: Uitleg transformeren data 
```
```{r aanmaken data, include=FALSE, echo=TRUE}
Geen_leenstelsel <- c(375, 496)
Wel_leenstelsel <- c(369, 394)
Uitval_functiebeperking <- t(data.frame(Geen_leenstelsel, Wel_leenstelsel))
colnames(Uitval_functiebeperking) <- c("Wel uitval", "Geen uitval")

Geen_leenstelsel_n43 <- c(8, 14)
Wel_leenstelsel_n43 <- c(5, 16)
Uitval_functiebeperking_n43 <- t(data.frame(Geen_leenstelsel_n43, Wel_leenstelsel_n43))
colnames(Uitval_functiebeperking_n43) <- c("Wel uitval", "Geen uitval")
```
<!-- ## /BLOK: Data-aanmaken.R -->

# Toepassing
Gebruik de *Chi-kwadraat toets* of de *Fisher's exact toets* om te toetsen of er een afhankelijkheid bestaat tussen twee ongepaarde binaire variabelen.[^1][^2] In tegenstelling tot de *Chi-kwadraat toets* kan de *Fisher's exact toets* ook bij lage aantallen ingezet worden.[^3] De *Fisher's exact toets* is conservatiever dan de *Chi-kwadraat toets*. Dat wil zeggen dat de *Fisher's exact toets* terughoudender is in het benoemen of iets significant is, dan de *Chi-kwadraat toets*.[^4]   

# Onderwijscasus
<div id = "casus">
De studentendecaan vraagt zich af of studenten met een functiebeperking door het invoeren van het leenstelsel meer of minder uitvallen dan voor de invoer.

H~0~: Onder de studenten met een functiebeperking is het percentage uitval na de invoering van het leenstelsel gelijk gebleven.

H~A~: Onder de studenten met een functiebeperking is het percentage uitval na de invoering van het leenstelsel veranderd.
</div>

# Assumpties
Voor een valide resultaat moeten de data aan een aantal voorwaarden voldoen voordat de toets uitgevoerd kan worden. De groepen zijn op nominaal niveau gemeten[^5] en daarmee onafhankelijk van elkaar. De *Chi-kwadraat toets* heeft specifieke regels wat betreft de groepsgrootte per cel. 

## Celgrootte
Beide testen maken gebruik van een kruistabel; er zijn twee condities met vier mogelijke opties: zie tabel hieronder. Elke cel bevat de geobserveerde waarde per groep. 
 

|                      | Wel uitval   | Geen uitval |
| -------------------- | -------------| ------------| 
| **Geen leenstelsel** | groep A      | groep B     | 
| **Wel leenstelsel**  | groep C      | groep D     | 

De *chi-kwadraat toets* berekent een verwachte waarde en vergelijkt deze met de geobserveerde waarde. 
Stel dat er bekend is dat voor het leenstelsel er gemiddeld zo ongeveer 15% van de studenten uitvallen. En stel dat we zo'n 100 studenten hebben voor het leenstelsel en ook 100 met wel een leenstelsel. Dan zou de verwachte waarde in groep A 15 zijn, en 85 in groep B. Aangezien de nulhypothese geen verandering in percentage verwacht, zit in groep groep C 85 studenten en in groep D 15 studenten.   

De *chi-kwadraat toets* wordt onbetrouwbaar wanneer er niet wordt voldaan aan de volgende aantallen:  
* Elke cel van de verwachte waarde moet > 0.  
* Als in 20% van de cellen een verwachte waarde van 5 of lager staat, wordt de toets onbetrouwbaar.  
* In de cellen met de geobserveerde waarde is dat 10 of lager.[^6]  
Gebruik de *Fisher’s exact toets* wanneer de aantallen in de cellen lager zijn.[^7]  

# Uitvoering 
Er is een dataset ingeladen over de uitval van studenten met een functiebeperking voor en na de invoering van het leenstelsel. De data `Uitval_functiebeperking` zijn binair: wel of geen uitval. 

## De data bekijken
<!-- ## BLOK: Data-bekijken.R -->
```{r data bekijken, collapse = TRUE}
## Eerste 6 observaties
print(Uitval_functiebeperking)
```
<!-- ## /BLOK: Data-bekijken.R -->

## Chi-kwadraat toets
De *chi-kwadraat toets* wordt uitgevoerd om de vraag te beantwoorden of het percentage studenten met een functiebeperking dat is uitgevallen voor en na de invoering van het leenstelsel gelijk is gebleven.Gebruik `chisq.test()` op een kruistabel.  
<!-- ## BLOK: Chi2-toets -->
```{r chi2}
chisq.test(Uitval_functiebeperking)
```
<!-- ## /BLOK: Chi2-toets-->

```{r chi2 als object, include=FALSE, echo=TRUE}
Chi2 <- chisq.test(Uitval_functiebeperking)
vChi2 <- Round_and_format(Chi2$statistic)
vP <- Round_and_format(Chi2$p.value)
vDF <- Chi2$parameter
```

* *χ^2^* ~1~ ≈ `r vChi2`, *p* = `r vP`  
* Vrijheidsgraden: *df* = (*k*-1)(*r*-1), waar k staat voor kolom en r voor rij. In dit geval geldt *df* = `r vDF`. De continuïteitscorrectie van Yates wordt automatisch toegepast wanneer het aantal vrijheidsgraden 1 is.[^6]   
* p-waarde < 0,05, dus de H~0~ wordt verworpen en de H~A~ wordt aangenomen.[^6]  

## Fisher's exact toets
De *Fisher's exact toets* wordt uitgevoerd om de vraag te beantwoorden of het percentage studenten met een functiebeperking dat is uitgevallen voor en na de invoering van het leenstelsel gelijk is gebleven. Bij lage aantallen is de 

Er is een steekproef van `Uitval_functiebeperking` ingeladen genaamd `Uitval_functiebeperking_n43`.
<!-- ## BLOK: data-bekijken-n43 -->
```{r data bekijken n43}
print(Uitval_functiebeperking_n43)
```
<!-- ## /BLOK: data-bekijken-n43 -->

Alle groepen hebben een laag aantal per cel, variërend van 5 tot 16. De *Fisher's exact toets* kan uitgevoerd worden.

<!-- ## BLOK: Fishers-Exact-toets -->
```{r fishers exact}
fisher.test(Uitval_functiebeperking_n43)
```
<!-- ## /BLOK: Fishers-Exact-toets -->

```{r fishers exact als object, include=FALSE, echo=TRUE}
fish <- fisher.test(Uitval_functiebeperking_n43)
vF_p <- Round_and_format(fish$p.value)
vConf.int1 <- Round_and_format(fish$conf.int[1])
vConf.int2 <- Round_and_format(fish$conf.int[2])
```

* p-waarde > 0,05 , dus de H~0~ wordt niet verworpen.[^7]  
* De kans op het uitvallen van studenten met een functiebeperking onder het leenstelsel is 1,8 keer zo groot als de kans op het uitvallen van studenten met een functiebeperking voor het leenstelsel. Deze associatie blijkt niet significant te zijn: *p* = `r vF_p`  
* Het 95% betrouwbaarheidsinterval: `r vConf.int1` en de `r vConf.int2`.   

# Rapportage
De *Chi-kwadraat toets* is uitgevoerd om te toetsen of studenten met een functiebeperking meer of minder uitvallen sinds de invoering van het leenstelsel. De resultaten ondersteunen de alternatieve hypothese; de verhouding uitval van het aantal studenten met een functiebeperking is na de invoering van het leenstelsel veranderd, *χ^2^* ~`r vDF`~ ≈ `r vChi2`, *p* < 0,05.
 
[^1]: Binaire variabelen: twee elkaar uitsluitende waarden, zoals ja of nee, 0 of 1, aan of uit. 
[^2]: Prabhakaran, S. (2016-2017). *Statistical Tests*. http://r-statistics.co/Statistical-Tests-in-R.html.
[^3]: Van Geloven, N., & Holman, R., (6 mei 2016). *Fisher's exact toets*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Fisher's_exact_toets).
[^4]: Universiteit van Amsterdam (13 november 2017). *Chi-square test*. [UvA Wiki Methodologiewinkel](https://wiki.uva.nl/methodologiewinkel/index.php/Chi-square_test#Assumpties). 
[^5]: Nominaal: een variabele die niet afhankelijk van elkaar zijn en op inhoudelijke basis geordend kan worden. Voorbeelden hiervan zijn geslacht of achternamen. Een binaire variabel is een voorbeeld van een nominale variabel. Binaire variabelen hebben twee mogelijkheden, ja of nee, terwijl nominale variabelen meerdere mogelijkheden hebben. 
[^6]: Field, A., Miles, J., & Field, Z. (2012). *Discovering statistics using R*. London: Sage publications.
[^7]: van Geloven, N. (20 augustus 2015). *Chi-kwadraat toets*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Chi-kwadraat_toets).


[^7]: In dit voorbeeld wordt eruit gegaan van een waarschijnlijkheid van 95% en zodoende een p-waardegrens van 0,05. Dit is naar eigen inzicht aan te passen. Hou hierbij rekening met type I en type II fouten.
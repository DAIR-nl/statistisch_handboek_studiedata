---
title: "Fisher-Freeman-Halton exact toets"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_float: 
      collapsed: FALSE 
    number_sections: true
  keywords: [statistisch handboek, studiedata]
---

<!-- ## CLOSEDBLOK: Functies.R -->
```{r functies, include = TRUE, echo = FALSE, results='asis', warning=FALSE, message=FALSE}
library(here)
if (!exists("Substitute_var")) {
  ## Installeer packages en functies
  source(paste0(here::here(), "/99. Functies en Libraries/00. Voorbereidingen.R"), echo = FALSE)
}
```
<!-- ## /CLOSEDBLOK: Functies.R -->

<style>
`r htmltools::includeHTML(paste0(here::here(),"/01. Includes/css/Stylesheet_SHHO.css"))`
</style>

<!-- ## CLOSEDBLOK: Header.R -->
```{r header, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Header.R"))} 
```
<!-- ## /CLOSEDBLOK: Header.R -->

<!-- ## CLOSEDBLOK: Status.R -->
```{r status, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Status.R"))} 
```
<!-- ## /CLOSEDBLOK: Status.R -->

<!-- ## OPENBLOK: Data-aanmaken.R -->
```{r aanmaken data, include=FALSE, echo=TRUE}
source(paste0(here::here(),"/01. Includes/data/16.R"))
```
<!-- ## /OPENBLOK: Data-aanmaken.R -->

# Toepassing
Gebruik de *Chi-kwadraat toets*[^1] of de *Fisher-Freeman-Halton exact toets*[^2] om te toetsen of er een afhankelijkheid bestaat tussen twee ongepaarde variabelen, waarin één of beide variabelen meer dan twee categorieën hebben. De *Fisher-Freeman-Halton exact toets* is een uitbreiding van de *Fisher's exact toets* die gebruikt wordt om te toetsen of er een afhankelijkheid bestaat tussen twee ongepaarde binaire variabelen, oftewel een 2x2 tabel. Deze toets is een alternatief voor de *Chi-kwadraat toets* wanneer er kleine aantallen observaties zijn. [^2]<sup>,<sup>[^3]

# Onderwijscasus
<div id = "casus">
De opleidingsdirecteur van de Bachelor Antropologie vraagt zich af wat de invloed is van de instroom van internationale studenten op het behalen van een positief BSA. Krijgen studenten uit bepaalde landen vaker een positief BSA dan studenten uit andere landen? Internationale studenten zijn 'studenten met een buitenlandse vooropleiding of een opleiding van een Europese school’. 

H~0~: De verhouding wel/geen positief BSA is onder de studenten van de Bachelor Antropologie hetzelfde voor studenten uit elk land.  

H~A~: De verhouding wel/geen positief BSA is onder de studenten van de Bachelor Antropologie anders voor een groep voor studenten uit één of meerdere landen.  
</div>

# Assumpties
Voor een valide resultaat moeten de data aan een aantal voorwaarden voldoen voordat de toets uitgevoerd kan worden. De groepen zijn op nominaal of ordinaal [^4] niveau gemeten en daarmee onafhankelijk van elkaar. 

## Groepsgrootte
Beide testen maken gebruik van een kruistabel; zie tabel 1 voor de geoberveerde waarden van de casus. 

<!-- ## TEKSTBLOK: Groepsgrootte1.R -->

|                      | NL   | GE | IT | UK | BE | ES | US |   |
| ------------- | ---------| ------------| -------------| ---------|---------|---------|---------| ------------- |
| **Positief BSA** |`r Bsa_kt[1,1]` | `r Bsa_kt[1,2]`  | `r Bsa_kt[1,3]`  | `r Bsa_kt[1,4]`  | `r Bsa_kt[1,5]`  | `r Bsa_kt[1,6]`  | `r Bsa_kt[1,7]`  | **`r sum(Bsa_kt[1,1:7])`**|
| **Negatief BSA**  |`r Bsa_kt[2,1]`   | `r Bsa_kt[2,2]` | `r Bsa_kt[2,3]` | `r Bsa_kt[2,4]` | `r Bsa_kt[2,5]` | `r Bsa_kt[2,6]` | `r Bsa_kt[2,7]` | **`r sum(Bsa_kt[2,1:7])`**|
|**Totaal** |**`r sum(Bsa_kt[1:2,1])`**   | **`r sum(Bsa_kt[1:2,2])`** | **`r sum(Bsa_kt[1:2,3])`**   | **`r sum(Bsa_kt[1:2,4])`**   | **`r sum(Bsa_kt[1:2,5])`**   | **`r sum(Bsa_kt[1:2,6])`**   | **`r sum(Bsa_kt[1:2,7])`**   | **`r sum(Bsa_kt)`** |
*Tabel 1. Geobserveerde waarden casus BSA en instroomland*
<!-- ## TEKSTBLOK: Groepsgrootte1.R -->

Op basis van geobserveerde waarden kunnen de verwachte waarden berekend worden. In deze casus kan de verwachte waarde van de studenten uit Nederland met positief BSA berekend worden door het aantal studenten met positief BSA te vermenigvuldigen met het aantal studenten uit Nederland en de uitkomst te delen door het totaal aantal studenten:

<!-- ## TEKSTBLOK: Groepsgrootte2.R -->
* aantal studenten positief BSA: `r sum(Bsa_kt[1,1:7])`   
* aantal studenten uit Nederland: `r sum(Bsa_kt[1:2,1])`  
* totaal aantal studenten: `r sum(Bsa_kt)` 
* verwacht aantal studenten uit Nederland met positief BSA: `r sum(Bsa_kt[1,1:7])`*`r sum(Bsa_kt[1:2,1])`/`r sum(Bsa_kt)` ≈ `r round(sum(Bsa_kt[1,1:7])*sum(Bsa_kt[1:2,1])/sum(Bsa_kt)) `. Deze en overige waarden zijn berekend in tabel 2. 

|                      | NL   | GE | IT | UK | BE | ES | US |   |
| ------------- | ---------| ------------| -------------| ---------|---------|---------|---------| ------------- |
| **Positief BSA** |`r round(sum(Bsa_kt[1,1:7])*sum(Bsa_kt[1:2,1])/sum(Bsa_kt)) ` | `r round(sum(Bsa_kt[1,1:7])*sum(Bsa_kt[1:2,2])/sum(Bsa_kt)) `  | `r round(sum(Bsa_kt[1,1:7])*sum(Bsa_kt[1:2,3])/sum(Bsa_kt)) `  | `r round(sum(Bsa_kt[1,1:7])*sum(Bsa_kt[1:2,4])/sum(Bsa_kt)) `  | `r round(sum(Bsa_kt[1,1:7])*sum(Bsa_kt[1:2,5])/sum(Bsa_kt)) `  | `r round(sum(Bsa_kt[1,1:7])*sum(Bsa_kt[1:2,6])/sum(Bsa_kt)) `  | `r round(sum(Bsa_kt[1,1:7])*sum(Bsa_kt[1:2,7])/sum(Bsa_kt)) `  | **`r sum(Bsa_kt[1,1:7])`**|
| **Negatief BSA**  |`r round(sum(Bsa_kt[2,1:7])*sum(Bsa_kt[1:2,1])/sum(Bsa_kt)) `   | `r round(sum(Bsa_kt[2,1:7])*sum(Bsa_kt[1:2,2])/sum(Bsa_kt)) ` | `r round(sum(Bsa_kt[2,1:7])*sum(Bsa_kt[1:2,3])/sum(Bsa_kt)) ` | `r round(sum(Bsa_kt[2,1:7])*sum(Bsa_kt[1:2,4])/sum(Bsa_kt)) ` | `r round(sum(Bsa_kt[2,1:7])*sum(Bsa_kt[1:2,5])/sum(Bsa_kt)) ` | `r round(sum(Bsa_kt[2,1:7])*sum(Bsa_kt[1:2,6])/sum(Bsa_kt)) ` | `r round(sum(Bsa_kt[2,1:7])*sum(Bsa_kt[1:2,7])/sum(Bsa_kt)) ` | **`r sum(Bsa_kt[2,1:7])`**|
|**Totaal** |**`r sum(Bsa_kt[1:2,1])`**   | **`r sum(Bsa_kt[1:2,2])`** | **`r sum(Bsa_kt[1:2,3])`**   | **`r sum(Bsa_kt[1:2,4])`**   | **`r sum(Bsa_kt[1:2,5])`**   | **`r sum(Bsa_kt[1:2,6])`**   | **`r sum(Bsa_kt[1:2,7])`**   | **`r sum(Bsa_kt)`** |
*Tabel 2. Verwachte waarden casus BSA en instroomland*
<!-- ## TEKSTBLOK: Groepsgrootte2.R -->

De *Chi-kwadraat toets* wordt onbetrouwbaar als er in meer dan 20 % van de gevallen een verwachte waarde van 5 of lager is.[^5] Gebruik in die gevallen de *Fisher-Freeman-Halton exact toets*.  

# Post-hoc toetsen

De *Chi-kwadraat toets* en *Fisher-Freeman-Halton exact toets* worden gebruikt om een afhankelijkheid aan te tonen tussen twee ongepaarde categorische variabelen. Wanneer een of beide variabelen meer dan twee categorieën bevat, worden post-hoc toetsen uitgevoerd om te bepalen welke categorieën significant van elkaar verschillen.

Voor de *Chi-kwadraat toets* worden de gestandaardiseerde verschillen tussen de geobserveerde en verwachte waarde gebruikt. Vergelijkbaar met z-scores zijn deze residuen significant bij een waarde groter dan $\pm 1,96$.[^5]

Voor de *Fisher-Freeman-Halton exact toets* is er geen specifiek voorgeschreven post-hoc toets.[^3]<sup>,<sup>[^5] Een goede optie is het uitvoeren van losse *Fisher's exact toetsen* voor elke mogelijke combinatie van 2x2 tabellen met daarbij een correctie op de p-waarden vanwege meerdere testen tegelijkertijd. 


# De data bekijken
<!-- ## TEKSTBLOK: Data-bekijken.R -->
Er is een kruistabel ingeladen over de het BSA advies voor bachelorstudenten antropologie met verschillende instroomlanden. De variabele voor BSA advies is binair (positief of negatief) en de variabele voor instroomland bestaat uit zeven categorieën Deze kruistabel is gebaseerd op een dataset waarin BSA advies en instroomland voor studenten wordt bijgehouden. 
Print de kruistabel of geef deze grafisch weer met `barplot()`. 
<!-- ## /TEKSTBLOK: Data-bekijken.R -->
<!-- ## OPENBLOK: Data-bekijken.R -->
```{r data bekijken, collapse=TRUE}
print(Bsa_kt)
barplot(Bsa_kt, beside = TRUE, legend.text = TRUE)
```
<!-- ## /OPENBLOK: Data-bekijken.R -->

# Chi-kwadraat toets
## Uitvoering
<!-- ## TEKSTBLOK: Chi2-toets.R -->
De *chi-kwadraat toets* wordt uitgevoerd om de vraag te beantwoorden of het percentage studenten met positief BSA gelijk is voor de verschillende instroomlanden. Gebruik `chisq.test()` op de kruistabel `Bsa_kt`.  
<!-- ## /TEKSTBLOK: Chi2-toets.R -->
<!-- ## OPENBLOK: Chi2-toets-->
```{r collapse=TRUE}
chisq.test(Bsa_kt)
```
<!-- ## /OPENBLOK: Chi2-toets-->
<!-- ## CLOSEDBLOK: Chi2-toets.R-->
```{r chi2 als object, include=FALSE, echo=TRUE}
Chi2 <- chisq.test(Bsa_kt)
vChi2 <- Round_and_format(Chi2$statistic)
vP <- Round_and_format(Chi2$p.value)
vDF <- Chi2$parameter
```
<!-- ## /CLOSEDBLOK: Chi2-toets.R-->

<!-- ## TEKSTBLOK: Chi2-toets.R-->
* *χ^2^* ~6~ ≈ `r vChi2`, *p* ≈ `r vP`  
* Vrijheidsgraden: *df* = (*k*-1)(*r*-1), waar k staat voor kolom en r voor rij. In dit geval geldt *df* = `r vDF`. 
* p-waarde < 0,05, dus de H~0~ wordt verworpen.[^6]  

<!-- ## /TEKSTBLOK: Chi2-toets.R-->

## Post-hoc toets: gestandaardiseerde residuen


Voer post-hoc toetsen uit om te bepalen welke instroomlanden van elkaar verschillen wat betreft het percentage studenten met positief BSA. Inspecteer hiervoor de Pearson residuen van de *Chi-kwadraat toets* op waarden groter of kleiner dan 1,96 of -1,96 respectievelijke. Let op dat hier dus geen correctie voor meerdere testen plaatsvindt.

<!-- ## OPENBLOK: Chi2-toets post-hoc1-->
```{r collapse=TRUE}
resultaat <- chisq.test(Bsa_kt)
resultaat$residuals
```
<!-- ## /OPENBLOK: Chi2-toets post-hoc1-->

<!-- ## TEKSTBLOK: Chi2-toets post-hoc2.R-->
* Significant lagere geobserveerde waarde bij negatief BSA Nederland (NL), *z* = `r Round_and_format(resultaat$residuals["Neg_bsa","NL"])`
* Significant hogere geobserveerde waarde bij negatief BSA Italië (IT), *z* = `r Round_and_format(resultaat$residuals["Neg_bsa","IT"])`
* Significant lagere geobserveerde waarde bij negatief BSA Verenigd Koninkrijk (VK), *z* = `r Round_and_format(resultaat$residuals["Neg_bsa","UK"])`
* Significant hogere geobserveerde waarde bij negatief BSA Spanje (ES), *z* = `r Round_and_format(resultaat$residuals["Neg_bsa","ES"])`
* Significant hogere geobserveerde waarde bij negatief BSA verenigde Staten (US), *z* = `r Round_and_format(resultaat$residuals["Neg_bsa","US"])`

<!-- ## TEKSTBLOK: Chi2-toets post-hoc2.R-->



## Rapportage

<!-- ## TEKSTBLOK: RapportageChi2.R -->
De *Chi-kwadraat toets* is uitgevoerd om te onderzoeken of het percentage studenten met positief BSA verschilt per instroomland. De resultaten illustreren dat de nulthypothese verworpen kan worden, *χ^2^* ~`r vDF`~ ≈ `r vChi2`, *p* < 0,05. Er zijn dus verschillen tussen de instroomlanden.

De geobserveerde waarden voor de verschillende instroomlanden bij een positief BSA verschillen niet significant van de verwachte waarden. Bij een negatief BSA zijn er echter een aantal landen waarbij significante verschillen van de verwachte waarde zijn op te merken. Nederland (NL; *z* = `r Round_and_format(resultaat$residuals["Neg_bsa","NL"])`) en het Verenigd Koninkrijk (UK; *z* = `r Round_and_format(resultaat$residuals["Neg_bsa","UK"])`) hebben een lager aantal studenten met een negatief BSA dan verwacht; Italië (IT; *z* = `r Round_and_format(resultaat$residuals["Neg_bsa","IT"])`), Spanje (ES; *z* = `r Round_and_format(resultaat$residuals["Neg_bsa","ES"])`) en de Verenigde Staten (US; *z* = `r Round_and_format(resultaat$residuals["Neg_bsa","US"])`) een hoger aantal studenten met negatief BSA dan verwacht.
<!-- ## TEKSTBLOK: RapportageChi2.R -->


# Fisher-Freeman-Halton exact toets
## Uitvoering
<!-- ## TEKSTBLOK: UitvoeringFFH.R -->
De *Fisher-Freeman-Halton exact toets* wordt uitgevoerd om de vraag te beantwoorden of het percentage studenten met positief BSA verschilt per instroomland. Deze toets is ook betrouwbaar wanneer er in meer dan 20 % van de cellen een verwachte waarde van 5 of lager is. Er is een steekproef van `Bsa_kt` ingeladen genaamd `Bsa_kt_n10` met daarin een lager aantal observaties per cel.
<!-- ## TEKSTBLOK: UitvoeringFFH.R -->

<!-- ## OPENBLOK: data-bekijken-n10 -->
```{r data bekijken n10}
print(Bsa_kt_n10)
```
<!-- ## /OPENBLOK: data-bekijken-n10 -->

<!-- ## TEKSTBLOK: Fisher-Freeman-Halton-exact-toets-->
Gebruik `simulate.p.value = TRUE` bij `fisher.test()` om de p-waardes via een Monte Carlo simulatie te laten uitrekenen. Dit kost de computer minder rekentijd waardoor de resultaten sneller weergegeven kunnen worden.
<!-- ## /TEKSTBLOK: Fisher-Freeman-Halton-exact-toets-->
<!-- ## OPENBLOK: Fisher-Freeman-Halton-exact-toets-->
``` {r fisher toets}
fisher.test(Bsa_kt_n10, simulate.p.value = TRUE)
```
<!-- ## /OPENBLOK: Fisher-Freeman-Halton-exact-toets-->
* p-waarde > 0,05, dus de H~0~ kan niet worden verworpen [^6]

## Post-hoc toets: Fisher's exact toets

<!-- ## TEKSTBLOK: Fisher-Freeman-Halton-exact-toets post-hoc1 -->
Omdat er geen afhankelijkheid is tussen het wel of niet halen van een positief BSA en het instroomland, hoeven er geen post-hoc toetsen uitgevoerd te worden. Indien dit wel nodig is, voer deze dan uit met de functie `fisher.multcomp()` met als eerste argument de kruistabel `Bsa_kt_10` en als tweede argument de gebruikte methode om te corrigeren voor meerdere testen, in dit geval `p.method="bonferroni"`.
<!-- ## TEKSTBLOK: Fisher-Freeman-Halton-exact-toets post-hoc1 -->


<!-- ## OPENBLOK: Fisher-Freeman-Halton-exact-toets post-hoc2 -->
``` {r fisher toets post hoc, warning=FALSE, message=FALSE}
library(RVAideMemoire)
fisher.multcomp(Bsa_kt_n10,p.method="bonferroni")
```
<!-- ## OPENBLOK: Fisher-Freeman-Halton-exact-toets post-hoc2 -->

Geen van de post-hoc toetsen is significant, wat logisch is aangezien de *Fisher-Freeman-Halton exact toets* niet significant was. De resultaten laten de significantie zien van de *Fisher's exact toets* voor elk mogelijke combinatie van 2x2 tabellen. De eerste waarde is bijvoorbeeld de p-waarde van deze toets voor de kruistabel bestaande uit de aantallen positief en negatief BSA voor Nederland en Duitsland (NL:GE).


## Rapportage
<!-- ## TEKSTBLOK: Rapportage.R -->
De *Fisher-Freeman-Halton exact toets* is uitgevoerd om te toetsen of het percentage studenten met positief BSA verschilt per instroomland. De resultaten ondersteunen de nulhypothese: het percentage studenten met een positief BSA verschilt niet per instroomland, *p* > 0,05. 

<!-- ## /TEKSTBLOK: Rapportage.R -->

<!-- ## CLOSEDBLOK: Footer.R -->
```{r footer, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Footer.R"))}
```
<!-- ## /CLOSEDBLOK: Footer.R -->


[^1]: Van Geloven, N. (20 augustus 2015). *Chi-kwadraat toets*. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Chi-kwadraat_toets).
[^2]: Van Geloven, N. & Holman, R. (6 mei 2016). *Fisher's exact toets* Co-Auteur	dr. R. [Wiki Statistiek Academisch Medisch Centrum](https://wikistatistiek.amc.nl/index.php/Fisher%27s_exact_toets).
[^3]: Agresti, A. (2003). *Categorical data analysis*. Vol. 482, John Wiley & Sons.
[^4]: Nominaal: variabelen die niet afhankelijk van elkaar zijn en niet op inhoudelijke basis geordend kunnen worden; voorbeelden hiervan zijn geslacht of achternamen. Een binaire variabele is een voorbeeld van een nominale variabele. Binaire variabelen hebben twee mogelijkheden, ja of nee, terwijl nominale variabelen meerdere mogelijkheden kunnen hebben. 
[^5]: Field, A., Miles, J., & Field, Z. (2012). *Discovering statistics using R*. London: Sage publications.
[^6]: Dit voorbeeld gaat uit van een waarschijnlijkheid van 95% en zodoende een p-waardegrens van 0,05. Dit is naar eigen inzicht aan te passen. Hou hierbij rekening met type I en type II fouten.
---
title: "Bhapkar toets"
output:
  html_document:
    theme: lumen
    toc: yes
    toc_depth: 2
    toc_float: 
      collapsed: FALSE 
    number_sections: true
  keywords: [statistisch handboek, studiedata]
---

<!-- ## CLOSEDBLOK: Functies.R -->
```{r functies, include = TRUE, echo = FALSE, results='asis', warning=FALSE, message=FALSE}
library(here)
if (!exists("Substitute_var")) {
  ## Installeer packages en functies
  source(paste0(here::here(), "/99. Functies en Libraries/00. Voorbereidingen.R"), echo = FALSE)
}
```
<!-- ## /CLOSEDBLOK: Functies.R -->

<!-- ## CLOSEDBLOK: CSS -->
<style>
`r htmltools::includeHTML(paste0(here::here(),"/01. Includes/css/Stylesheet_SHHO.css"))`
</style>
<!-- ## /CLOSEDBLOK: CSS -->

<!-- ## CLOSEDBLOK: Header.R -->
```{r header, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Header.R"))} 
```
<!-- ## /CLOSEDBLOK: Header.R -->

<!-- ## CLOSEDBLOK: Status.R -->
```{r status, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Status.R"))} 
```
<!-- ## /CLOSEDBLOK: Status.R -->

<!-- ## CLOSEDBLOK: Reticulate.R -->

<!-- ## /CLOSEDBLOK: Reticulate.R -->

<!-- ## OPENBLOK: Data-aanmaken.R -->
```{r aanmaken data, include=FALSE, echo=TRUE}
source(paste0(here::here(),"/01. Includes/data/18.R"))
```
<!-- ## /OPENBLOK: Data-aanmaken.R -->

# Toepassing

Gebruik de *Bhapkar toets* om te toetsen of er verschillen zijn voor een nominale[^1] variabele tussen twee gepaarde groepen.[^2]<sup>, </sup>[^3] Als de nominale variabele twee categorieën heeft, kan ook de [McNemar toets](12-McNemar-toets-I-R.html) gebruikt worden.

# Onderwijscasus
<div id = "casus">

De studieadviseur van de bachelor Leisure & Events Management geeft halverwege het eerste studiejaar een voorlopig BSA-advies aan alle eerstejaars studenten. Studenten ontvangen een positief, negatief of uitgesteld BSA.  Daarnaast voert zij met alle studenten persoonlijke gesprekken om het advies toe te lichten en een plan voor de rest van het studiejaar te maken. De studieadviseur wil graag onderzoeken of er verschillen zijn tussen het voorlopige BSA-advies halverwege het jaar en het definitieve advies aan het einde van het jaar zodat ze de effectiviteit van de persoonlijke gesprekken kan beoordelen.

Dit onderzoek vertaalt zich in de volgende combinatie van hypothesen, waarbij de nulhypothese zo geformuleerd is dat er geen effect of verschil is en de alternatieve hypothese zo geformuleerd is dat er wel een effect of verschil is.

*H~0~*: Er is geen verschil tussen de verdeling van de voorlopige BSA adviezen en de definitieve BSA adviezen.

*H~A~*: Er is een verschil tussen de verdeling van de voorlopige BSA adviezen en de definitieve BSA adviezen.

</div>

# Assumpties

Om de *Bhapkar toets* uit te voeren, moeten de data aan een aantal voorwaarden voldoen. Er dient een categorische variabele te zijn met twee of meer categorieën en een binaire variabele die de twee gepaarde groepen weergeeft. Daarnaast mag er geen overlap zijn tussen de categorieën van de categorische variabele: elke observatie past slechts in een van beide categorieën.[^2]<sup>, </sup>[^3]

# Frequentiematrix

De *Bhapkar toets* gaat uit van een frequentiematrix, een matrix waarin de rijen de eerste meting van de steekproef bevat en de kolommen de tweede meting. Een voorbeeld bij de casus is weergegeven in Tabel 1.

<!-- ## OPENBLOK: Groepsgrootte1.R -->
```{r groepsgrootte, include=FALSE, echo=TRUE}
## Sla de voorlopige en definitieve BSA-adviezen op
Voorlopig <- BSA_LEM$BSA_advies[BSA_LEM$Soort_BSA == "Voorlopig"]
Definitief <- BSA_LEM$BSA_advies[BSA_LEM$Soort_BSA == "Definitief"]

## Maak een frequentiematrix
BSA_frequentiematrix <- table(Voorlopig, Definitief)
```
<!-- ## /OPENBLOK: Groepsgrootte1.R -->

<!-- ## TEKSTBLOK: Groepsgrootte2.R -->

||                      | Definitief    |  |  |
|-------------| -------------------- | -------------| ------------| ------------| 
||                      | Positief | Negatief| Uitgesteld |
|**Voorlopig**| Positief      | `r BSA_frequentiematrix["Positief","Positief"]` | `r BSA_frequentiematrix["Positief","Negatief"]`     | `r BSA_frequentiematrix["Positief","Uitgesteld"]` |
|            | Negatief | `r BSA_frequentiematrix["Negatief","Positief"]` | `r BSA_frequentiematrix["Negatief","Negatief"]`     | `r BSA_frequentiematrix["Negatief","Uitgesteld"]` |
|            | Uitgesteld | `r BSA_frequentiematrix["Uitgesteld","Positief"]` | `r BSA_frequentiematrix["Uitgesteld","Negatief"]`     | `r BSA_frequentiematrix["Uitgesteld","Uitgesteld"]` |
*Tabel 1. Frequentiematrix van de voorlopige en definitieve BSA-adviezen voor studenten van de bachelor Leisure & Event Management.*

De cel linksboven bevat het aantal studenten dat zowel bij het voorlopige BSA als het definitieve BSA advies een positief advies heeft ontvangen; dit zijn `r BSA_frequentiematrix["Positief","Positief"]` studenten. De cel in het midden van de frequentiematrix laat het aantal studenten zien dat zowel bij het voorlopige BSA als het definitieve BSA advies een negatief advies heeft ontvangen; dit zijn `r BSA_frequentiematrix["Negatief","Negatief"]` studenten. De cel rechtsonder bevat het aantal studenten dat zowel bij het voorlopige BSA als het definitieve BSA advies een uitgesteld advies heeft ontvangen; dit is `r BSA_frequentiematrix["Uitgesteld","Uitgesteld"]` student. Beide cellen staan op de diagonaal van de tabel en worden daarom de *diagonale elementen* genoemd.

Er zijn ook cellen die niet onder de diagonale elementen van de frequentiematrix vallen. Deze cellen bevatten studenten waarbij het voorlopige BSA advies verschilt van het definitieve advies. In de cel rechtsboven bijvoorbeeld staat het aantal studenten dat een positief voorlopig BSA advies en een uitgesteld definitief BSA advies heeft ontvangen; dit zijn `r BSA_frequentiematrix["Positief","Uitgesteld"]` studenten. De cel linksonder bevat het aantal studenten dat een uitgesteld voorlopig BSA advies en een positief definitief BSA advies heeft ontvangen; dit zijn `r BSA_frequentiematrix["Uitgesteld","Positief"]` studenten.
<!-- ## /TEKSTBLOK: Groepsgrootte2.R -->

# Post-hoc toetsen

Met de *Bhapkar toets* wordt getoetst of er een verschil is tussen de verdelingen van de voorlopige en definitieve BSA-adviezen. Voer een post-hoc toets uit om daarna te bepalen welke BSA-adviezen verschillen bij het voorlopige en definitieve BSA-advies. Gebruik hiervoor de [McNemar toets](12-McNemar-toets-R.html) of de exacte [McNemar toets](12-McNemar-toets-R.html) als post-hoc toets.[^9] De exacte versie van de [McNemar toets](12-McNemar-toets-R.html) is nuttig om te gebruiken als het aantal observaties in de niet-diagonale elementen van de confusiematrix kleiner dan 11 is. Omdat er bij post-hoc toetsen vaak meerdere vergelijkingen gemaakt worden, is het tijdrovend om voor elke individuele vergelijking de confusiematrix te inspecteren. Voer daarom de [McNemar toets](12-McNemar-toets-R.html) en de exacte [McNemar toets](12-McNemar-toets-R.html) beide uit en vergelijk de significantie op beide toetsen. Als een vergelijking op de ene toets significant is en op de andere toets niet significant, bepaal dan aan de hand van de confusiematrix welk toetsresultaat gebruikt moet worden.[^2]<sup>, </sup>[^3]

Gebruik een correctie voor de p-waarden, omdat er meerdere toetsen tegelijkertijd worden gebruikt. Meerdere toetsen tegelijkertijd uitvoeren verhoogt de kans dat een van de nulhypotheses onterecht wordt verworpen en er bij toeval een verband wordt ontdekt dat er niet is (type I fout). In deze toetspagina wordt de *Benjamini-Hochberg correctie* gebruikt. Deze correctie zorgt ervoor dat de proportie type I fouten (*false discovery rate*) in het aantal significante toetsen gereduceerd wordt. Deze correctie is minder strict dan de *Bonferroni correctie* die ervoor zorgt dat de kans op ten minste één type I fout in alle toetsen gereduceerd wordt.[^7]<sup>,</sup>[^8] Er zijn ook nog andere opties voor een correctie op de p-waarden. De keuze voor een correctie is afhankelijk van het onderzoek.[^5]

# De data bekijken
<!-- ## TEKSTBLOK: Data-bekijken1.R -->
Er is een dataset ingeladen genaamd `BSA_LEM`. In deze dataset is voor elke student aangegeven wat het voorlopige en definitieve BSA advies is.

<!-- ## /TEKSTBLOK: Data-bekijken1.R -->

<!-- ## OPENBLOK: Data-bekijken2.R -->
```{r data bekijken}
## Eerste 6 observaties
head(BSA_LEM)

## Laatste 6 observaties
tail(BSA_LEM)
```
<!-- ## /OPENBLOK: Data-bekijken2.R -->

<!-- ## TEKSTBLOK: Data-kruistabel1.R -->
Een kruistabel geeft de aantallen observaties weer voor de combinaties van de categorieën van de variabelen `Soort_BSA` en `BSA_advies`. In feite laat deze tabel de frequentie van het positieve, negatieve en uitgestelde BSA-advies zien voor de voorlopige en definitieve BSA. Maak de kruistabel met de functie `table()` met als argumenten de variabele `BSA_LEM$Soort_BSA`, die weergeeft of het om het voorlopige of definitieve advies gaat, en de variabele `BSA_LEM$BSA_advies`, die het BSA-advies aangeeft.
<!-- ## /TEKSTBLOK: Data-kruistabel1.R -->

<!-- ## OPENBLOK: Data-kruistabel2.R -->
```{r kruistabel}
## Maak een kruistabel
BSA_kruistabel <- table(BSA_LEM$Soort_BSA, BSA_LEM$BSA_advies)

## Print de kruistabel 
print(BSA_kruistabel)

## Print een tabel met proporties, tweede argument 1 zorgt ervoor dat de 
## proporties per rij berekend worden
prop.table(BSA_kruistabel, 1)
```
<!-- ## /OPENBLOK: Data-kruistabel2.R -->

De kruistabel en de kruistabel met proporties laten zien dat het aantal positieve BSA-adviezen hoger is bij het definitieve advies en het aantal negatieve BSA-adviezen juist lager. Het aantal uitgestelde BSA-adviezen is iets lager bij het definitieve advies.

# Uitvoering

## Bhapkar toets

<!-- ## TEKSTBLOK: McNemar-toets1.R -->
Voer de *Bhapkar toets* uit om te onderzoeken of er een verschil is tussen de verdeling van de voorlopige en definitieve BSA-adviezen voor studenten van de bachelor Leisure & Events Management. Gebruik de functie `bhapkar()` van het package `irr` met als argument een matrix met daarin de voorlopige BSA-adviezen `Voorlopig` en de definitieve BSA-adviezen `Definitief`.
<!-- ## /TEKSTBLOK: McNemar-toets1.R -->

<!-- ## OPENBLOK: McNemar-toets2.R -->
```{r}
## Laad het package van de Bhapkar toets in
library(irr)

## Sla de voorlopige en definitieve BSA-adviezen op in een vector
Voorlopig <- BSA_LEM$BSA_advies[BSA_LEM$Soort_BSA == "Voorlopig"]
Definitief <- BSA_LEM$BSA_advies[BSA_LEM$Soort_BSA == "Definitief"]

## Voer de Bhapkar toets uit
bhapkar(cbind(Voorlopig, Definitief))

```
<!-- ## /OPENBLOK: McNemar-toets2.R -->

<!-- ## CLOSEDBLOK: McNemar-toets3.R -->
```{r mcnemar object, include=FALSE, echo=TRUE}
bhapkar <- bhapkar(cbind(Voorlopig, Definitief))
vChi2 <- Round_and_format(bhapkar$statistic)
```
<!-- ## /CLOSEDBLOK: McNemar-toets3.R -->

<!-- ## TEKSTBLOK: McNemar-toets5.R -->
* *&chi;^2^* = `r vChi2`, *p* < 0,0001  
* De p-waarde is kleiner dan 0,05, dus de H~0~ wordt verworpen.[^6]
* De verdelingen van de voorlopige en definitieve BSA-adviezen zijn verschillend.

<!-- ## /TEKSTBLOK: McNemar-toets5.R -->

## Post-hoc toets: McNemar toets

<!-- ## TEKSTBLOK: posthoc1.R -->
Voer post-hoc toetsen uit om te onderzoeken welke BSA-adviezen verschillen bij het voorlopige en definitieve BSA-advies van studenten van de bachelor Leisure & Events Management. Gebruik de [McNemar toets](12-McNemar-toets-R.html) of exacte [McNemar toets](12-McNemar-toets-R.html) als post-hoc toets. 
Voer de post-hoc toetsen uit met de functie `pairwiseMcnemar()` van het package `rcompanion` met als eerste argument `Soort_BSA ~ BSA_advies | Studentnummer` waarin `Soort_BSA` aangeeft of het een voorlopig of definitief BSA-advies is, `BSA_advies` de variabele is die aangeeft wat het BSA-advies is en `Studentnummer` de variabele is die de observatie-eenheden aangeeft. Het tweede argument is de dataset `data = BSA_LEM`. Het derde argument `test = "mcnemar"` geeft aan dat de [McNemar toets](12-McNemar-toets-R.html) gebruikt moet worden; gebruik het argument `test = "exact"` om een exacte [McNemar toets](12-McNemar-toets-R.html) uit te voeren. Het vierde argument `method = "BH"` geeft de correctie voor meerdere toetsen weer (Benjamini-Hochberg [BH] in dit geval). Het significantieniveau is 0,05 voor beide toetsen.[^6]
<!-- ## /TEKSTBLOK: posthoc1.R -->


<!-- ## OPENBLOK: posthoc2.R -->
```{r}
## Laad het benodigde package in
library(rcompanion)

# Voer post-hoc toetsen met de McNemar toets uit
pairwiseMcnemar(Soort_BSA ~ BSA_advies | Studentnummer,
                data   = BSA_LEM,
                test   = "mcnemar",
                method = "BH")

# Voer post-hoc toetsen met de exacte McNemar toets uit
pairwiseMcnemar(Soort_BSA ~ BSA_advies | Studentnummer,
                data   = BSA_LEM,
                test   = "exact",
                method = "BH")

```
<!-- ## /OPENBLOK: posthoc2.R -->

<!-- ## CLOSEDBLOK: posthoc3.R -->
```{r, include=FALSE, echo=TRUE}
posthoc <- pairwiseMcnemar(Soort_BSA ~ BSA_advies | Studentnummer,
                data   = BSA_LEM,
                test   = "mcnemar",
                method = "BH")
```
<!-- ## /CLOSEDBLOK: posthoc3.R -->

Er zijn tien vergelijkingen tussen de onderwijsperiodes getoets bij deze post-hoc toetsen. De significantie van de tien vergelijkingen verschilt niet tussen de [McNemar toets](12-McNemar-toets-R.html) en de exacte [McNemar toets](12-McNemar-toets-R.html). Beide toetsen kunnen gerapporteerd worden, in deze toetspagina wordt de [McNemar toets](12-McNemar-toets-R.html) gerapporteerd.

Tussen alle combinaties van de drie BSA-adviezen zijn significante verschillen gevonden tussen het voorlopige en definitieve BSA-advies. Van alle BSA-adviezen zijn de frequenties dus verschillend bij het voorlopige en definitieve BSA-advies.

# Rapportage

<!-- ## CLOSEDBLOK: posthoc3.R -->
```{r, include=FALSE, echo=TRUE}
## Maak een kruistabel
BSA_kruistabel <- table(BSA_LEM$Soort_BSA, BSA_LEM$BSA_advies)

## Print de kruistabel 
print(BSA_kruistabel)

## Print een tabel met proporties, tweede argument 1 zorgt ervoor dat de 
## proporties per rij berekend worden
propBSA_kruistabel <- prop.table(BSA_kruistabel, 1)

```
<!-- ## /CLOSEDBLOK: posthoc3.R -->


<!-- ## TEKSTBLOK: McNemar-toets5.R -->
De *Bhapkar toets* is uitgevoerd om uit te vinden of er een verschil tussen de verdeling van de voorlopige en definitieve BSA-adviezen van de studenten van de bachelor Leisure & Events Management. Uit de *Bhapkar toets* blijkt dat er een significant verschil is tussen de verdelingen van de voorlopige en definitieve BSA-adviezen, *&chi;^2^* = `r vChi2`, *p* < 0,0001. Uit de post-hoc toetsen blijkt dat er tussen alle combinaties van BSA-adviezen significante verschillen zijn. De frequenties en bijbehorende percentages voor de voorlopige en definitieve BSA-adviezen zijn te vinden in Tabel 2. Op basis van de resultaten en deze tabel is te zien dat er bij de definitieve BSA-adviezen meer positieve en minder negatieve BSA-adviezen zijn dan bij de voorlopige adviezen. Daarnaast is het aantal uitgestelde BSA-adviezen iets lager bij de definitieve adviezen. De persoonlijke gesprekken met de studieadviseur lijken er dus voor te zorgen dat er meer positieve en minder negatieve en uitgestelde BSA-adviezen zijn.

||                      | BSA-advies    | | |
|-------------| -------------------- | -------------| ------------| 
||                      | Positief | Negatief| Uitgesteld |
|**Voorlopig**|  `r BSA_kruistabel["Voorlopig","Positief"]` (`r Round_and_format(100*propBSA_kruistabel["Voorlopig","Positief"])`%) | `r BSA_kruistabel["Voorlopig","Negatief"]` (`r Round_and_format(100*propBSA_kruistabel["Voorlopig","Negatief"])`%) | `r BSA_kruistabel["Voorlopig","Uitgesteld"]` (`r Round_and_format(100*propBSA_kruistabel["Voorlopig","Uitgesteld"])`%) |
|**Definitief**|  `r BSA_kruistabel["Definitief","Positief"]` (`r Round_and_format(100*propBSA_kruistabel["Definitief","Positief"])`%) | `r BSA_kruistabel["Definitief","Negatief"]` (`r Round_and_format(100*propBSA_kruistabel["Definitief","Negatief"])`%) | `r BSA_kruistabel["Definitief","Uitgesteld"]` (`r Round_and_format(100*propBSA_kruistabel["Definitief","Uitgesteld"])`%) |
*Tabel 2. Kruistabel en rijpercentages voor de voorlopige en definitieve BSA-adviezen van studenten van de bachelor Leisure & Events Management.*

<!-- ## /TEKSTBLOK: McNemar-toets5.R -->

<!-- ## CLOSEDBLOK: Footer.R -->
```{r footer, include = TRUE, echo = FALSE, results='asis', code =  readLines(paste0(here::here(),"/01. Includes/code/Footer.R"))}
```
<!-- ## /CLOSEDBLOK: Footer.R -->

[^1]: Een nominale variabele is een categorische variabele waarbij de categorieën niet geordend kunnen worden. Een voorbeeld is de variabele windstreek (noord, oost, zuid, west) en geslacht (man of vrouw).
[^2]: Sun, X., & Yang, Z., (2008) *Generalized McNemar’s Test for Homogeneity of the Marginal Distributions*. [SAS Global Forum 2008](https://support.sas.com/resources/papers/proceedings/pdfs/sgf2008/382-2008.pdf)
[^3]: Uebersax, J. (30 augustus 2006). [*McNemar Tests of Marginal Homogeneity*](https://www.john-uebersax.com/stat/mcnemar.htm)
[^5]: Field, A., Miles, J., & Field, Z. (2012). *Discovering statistics using R*. London: Sage publications.
[^6]: In dit voorbeeld wordt uitgegaan van een waarschijnlijkheid van 95% c.q. een p-waardegrens van 0,05. De grens is naar eigen inzicht aan te passen; houd hierbij rekening met type I en type II fouten.
[^7]: Statistics How To (29 oktober 2017). *False Discovery Rate: Simple Definition, Adjusting for FDR*. [Statistics How to](https://www.statisticshowto.datasciencecentral.com/false-discovery-rate/). 
[^8]: Statistics How To (12 oktober 2015). *Benjamini-Hochberg Procedure*. [Statistics How to](https://www.statisticshowto.datasciencecentral.com/benjamini-hochberg-procedure/). 
[^9]: De exacte [McNemar toets](12-McNemar-toets-R.html) wordt gebruikt als het aantal observaties in de niet-diagonale elementen van de confusiematrix kleiner dan 11 is. Voor meer informatie, zie de toetspagina van de [McNemar toets](12 McNemar toets R.Rmd).